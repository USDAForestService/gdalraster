<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Class to calculate mean and variance in one pass — RunningStats-class • gdalraster</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Class to calculate mean and variance in one pass — RunningStats-class"><meta name="description" content="RunningStats computes summary statistics on a data stream efficiently.
Mean and variance are calculated with Welford's online algorithm
(https://en.wikipedia.org/wiki/Algorithms_for_calculating_variance).
The min, max, sum and count are also tracked. The input data values are not
stored in memory, so this class can be used to compute statistics for very
large data streams."><meta property="og:description" content="RunningStats computes summary statistics on a data stream efficiently.
Mean and variance are calculated with Welford's online algorithm
(https://en.wikipedia.org/wiki/Algorithms_for_calculating_variance).
The min, max, sum and count are also tracked. The input data values are not
stored in memory, so this class can be used to compute statistics for very
large data streams."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gdalraster</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.12.0.9100</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/gdal-block-cache.html">GDAL Block Cache</a></li>
    <li><a class="dropdown-item" href="../articles/gdal-config-quick-ref.html">GDAL Config Quick Reference</a></li>
    <li><a class="dropdown-item" href="../articles/gdalvector-draft.html">Draft Bindings to the GDAL/OGR Vector API</a></li>
    <li><a class="dropdown-item" href="../articles/raster-api-tutorial.html">Raster API Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/raster-attribute-tables.html">Raster Attribute Tables</a></li>
    <li><a class="dropdown-item" href="../articles/raster-display.html">Raster Display</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/USDAForestService/gdalraster/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Class to calculate mean and variance in one pass</h1>
      <small class="dont-index">Source: <a href="https://github.com/USDAForestService/gdalraster/blob/main/R/running_stats.R" class="external-link"><code>R/running_stats.R</code></a></small>
      <div class="d-none name"><code>RunningStats-class.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>RunningStats</code> computes summary statistics on a data stream efficiently.
Mean and variance are calculated with Welford's online algorithm
(<a href="https://en.wikipedia.org/wiki/Algorithms_for_calculating_variance" class="external-link">https://en.wikipedia.org/wiki/Algorithms_for_calculating_variance</a>).
The min, max, sum and count are also tracked. The input data values are not
stored in memory, so this class can be used to compute statistics for very
large data streams.</p>
    </div>


    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-na-rm">na_rm<a class="anchor" aria-label="anchor" href="#arg-na-rm"></a></dt>
<dd><p>Logical scalar. <code>TRUE</code> to remove <code>NA</code> from the input data (the
default) or <code>FALSE</code> to retain <code>NA</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>RunningStats</code>. A <code>RunningStats</code> object
maintains the current minimum, maximum, mean, variance, sum and count of
values that have been read from the stream. It can be updated repeatedly
with new values (i.e., chunks of data read from the input stream), but its
memory footprint is negligible. Class methods for updating with new values
and retrieving current values of statistics are described in Details.
<code>RunningStats</code> is a C++ class exposed directly to R (via
<code>RCPP_EXPOSED_CLASS</code>). Methods of the class are accessed in R using the <code>$</code>
operator.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The intended use is computing summary statistics for specific subsets or
zones of a raster that could be defined in various ways and are generally
not contiguous. The algorithm as implemented here incurs the cost of
floating point division for each new value updated (i.e., per pixel), but is
reasonably efficient for the use case. Note that GDAL internally uses an
optimized version of Welford's algorithm to compute raster statistics as
described in detail by Rouault, 2016
(<a href="https://github.com/OSGeo/gdal/blob/master/gcore/statistics.txt" class="external-link">https://github.com/OSGeo/gdal/blob/master/gcore/statistics.txt</a>).
The class method <code>GDALRaster$getStatistics()</code> is a GDAL API wrapper that
computes statistics for a whole raster band.</p>
    </div>
    <div class="section level2">
    <h2 id="usage-see-details-">Usage (see Details)<a class="anchor" aria-label="anchor" href="#usage-see-details-"></a></h2>


<div class="sourceCode"><pre><code><span></span>
<span><span class="co">## Constructor</span></span>
<span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">RunningStats</span>, <span class="va">na_rm</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Methods</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="va">newvalues</span><span class="op">)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">get_count</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">get_mean</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">get_min</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">get_max</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">get_sum</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">get_var</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">get_sd</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">reset</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>

    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>


<div class="section">
<h3 id="constructor">Constructor<a class="anchor" aria-label="anchor" href="#constructor"></a></h3>


<p><code>new(RunningStats, na_rm)</code><br>
Returns an object of class <code>RunningStats</code>. The <code>na_rm</code> argument
defaults to <code>TRUE</code> if omitted.</p>
</div>

<div class="section">
<h3 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a></h3>


<p><code>$update(newvalues)</code><br>
Updates the <code>RunningStats</code> object with a numeric vector of <code>newvalues</code>
(i.e., a chunk of values from the data stream). No return value, called
for side effects.</p>
<p><code>$get_count()</code><br>
Returns the count of values received from the data stream.</p>
<p><code>$get_mean()</code><br>
Returns the mean of values received from the data stream.</p>
<p><code>$get_min()</code><br>
Returns the minimum value received from the data stream.</p>
<p><code>$get_max()</code><br>
Returns the maximum value received from the data stream.</p>
<p><code>$get_sum()</code><br>
Returns the sum of values received from the data stream.</p>
<p><code>$get_var()</code><br>
Returns the variance of values from the data stream
(denominator n - 1).</p>
<p><code>$get_sd()</code><br>
Returns the standard deviation of values from the data stream
(denominator n - 1).</p>
<p><code>$reset()</code><br>
Clears the <code>RunningStats</code> object to its initialized state (count = 0).
No return value, called for side effects.</p>
</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">RunningStats</span>, na_rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">chunk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">rs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 704 bytes</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_count</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1000</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1000</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_mean</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.4882555</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.4882555</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_min</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.0002388966</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.0002388966</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_max</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9984908</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9984908</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_var</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.08493159</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.08493159</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_sd</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.2914302</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.2914302</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co">## 10^9 values read in 10,000 chunks</span></span></span>
<span class="r-in"><span><span class="co">## should take under 1 minute on most PC hardware</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1e4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">chunk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1e5</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">rs</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_count</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1000001000</span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_mean</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.5000044</span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_var</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.08333479</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">rs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 704 bytes</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/ctoney" class="external-link">Chris Toney</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

