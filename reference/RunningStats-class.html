<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="RunningStats computes summary statistics on a data stream efficiently.
Mean and variance are calculated with Welford's online algorithm
(https://en.wikipedia.org/wiki/Algorithms_for_calculating_variance).
The min, max, sum and count are also tracked. The input data values are not
stored in memory, so this class can be used to compute statistics for very
large data streams."><title>Class to calculate mean and variance in one pass — RunningStats-class • gdalraster</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Class to calculate mean and variance in one pass — RunningStats-class"><meta property="og:description" content="RunningStats computes summary statistics on a data stream efficiently.
Mean and variance are calculated with Welford's online algorithm
(https://en.wikipedia.org/wiki/Algorithms_for_calculating_variance).
The min, max, sum and count are also tracked. The input data values are not
stored in memory, so this class can be used to compute statistics for very
large data streams."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gdalraster</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/gdal-block-cache.html">GDAL Block Cache</a>
    <a class="dropdown-item" href="../articles/raster-display.html">Raster Display</a>
    <a class="dropdown-item" href="../articles/gdal-config-quick-ref.html">GDAL Config Quick Reference</a>
    <a class="dropdown-item" href="../articles/raster-api-tutorial.html">Raster API Tutorial</a>
    <a class="dropdown-item" href="../articles/raster-attribute-tables.html">Raster Attribute Tables</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/USDAForestService/gdalraster/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Class to calculate mean and variance in one pass</h1>
      <small class="dont-index">Source: <a href="https://github.com/USDAForestService/gdalraster/blob/HEAD/R/running_stats.R" class="external-link"><code>R/running_stats.R</code></a></small>
      <div class="d-none name"><code>RunningStats-class.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>RunningStats</code> computes summary statistics on a data stream efficiently.
Mean and variance are calculated with Welford's online algorithm
(<a href="https://en.wikipedia.org/wiki/Algorithms_for_calculating_variance" class="external-link">https://en.wikipedia.org/wiki/Algorithms_for_calculating_variance</a>).
The min, max, sum and count are also tracked. The input data values are not
stored in memory, so this class can be used to compute statistics for very
large data streams.</p>
    </div>


    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>na_rm</dt>
<dd><p>Logical scalar. <code>TRUE</code> to remove <code>NA</code> from the input data or
<code>FALSE</code> to retain <code>NA</code> (defaults to <code>TRUE</code>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An object of class <code>RunningStats</code>. A <code>RunningStats</code> object
maintains the current minimum, maximum, mean, variance, sum and count of
values that have been read from the stream. It can be updated repeatedly
with new values (i.e., chunks of data read from the input stream), but its
memory footprint is negligible. Class methods for updating with new values
and retrieving current values of statistics are described in Details.
<code>RunningStats</code> is a C++ class exposed directly to R (via
<code>RCPP_EXPOSED_CLASS</code>). Methods of the class are accessed in R using the <code>$</code></p>


<p>operator.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The intended use is computing summary statistics for specific subsets or
zones of a raster that could be defined in various ways and are generally
not contiguous. The algorithm as implemented here incurs the cost of
floating point division for each new value updated (i.e., per pixel), but is
reasonably efficient for the use case. Note that GDAL internally uses an
optimized version of Welford's algorithm to compute raster statistics as
described in detail by Rouault, 2016
(<a href="https://github.com/OSGeo/gdal/blob/master/gcore/statistics.txt" class="external-link">https://github.com/OSGeo/gdal/blob/master/gcore/statistics.txt</a>).
The class method <code>GDALRaster$getStatistics()</code> is a GDAL API wrapper that
computes statistics for a whole raster band.</p>
    </div>
    <div class="section level2">
    <h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h2>
    

<div class="sourceCode"><pre><code><span></span>
<span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">RunningStats</span>, <span class="va">na_rm</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Methods (see Details)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="va">newvalues</span><span class="op">)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">get_count</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">get_mean</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">get_min</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">get_max</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">get_sum</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">get_var</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">get_sd</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="fu">reset</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>

    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    


<p><code>new(RunningStats, na_rm)</code>
Constructor. Returns an object of class <code>RunningStats</code>.</p>
<p><code>$update(newvalues)</code>
Updates the <code>RunningStats</code> object with a numeric vector of <code>newvalues</code>
(i.e., a chunk of values from the data stream). No return value, called
for side effects.</p>
<p><code>$get_count()</code>
Returns the count of values received from the data stream.</p>
<p><code>$get_mean()</code>
Returns the mean of values received from the data stream.</p>
<p><code>$get_min()</code>
Returns the minimum value received from the data stream.</p>
<p><code>$get_max()</code>
Returns the maximum value received from the data stream.</p>
<p><code>$get_sum()</code>
Returns the sum of values received from the data stream.</p>
<p><code>$get_var()</code>
Returns the variance of values from the data stream
(denominator n - 1).</p>
<p><code>$get_sd()</code>
Returns the standard deviation of values from the data stream
(denominator n - 1).</p>
<p><code>$reset()</code>
Clears the <code>RunningStats</code> object to its initialized state (count = 0).
No return value, called for side effects.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">RunningStats</span>, na_rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">chunk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">rs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 704 bytes</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_count</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1000</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1000</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_mean</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.4882555</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.4882555</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_min</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.0002388966</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.0002388966</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_max</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9984908</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9984908</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_var</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.08493159</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.08493159</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_sd</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.2914302</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.2914302</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co">## 10^9 values read in 10,000 chunks</span></span></span>
<span class="r-in"><span><span class="co">## should take under 1 minute on most PC hardware</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1e4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">chunk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1e5</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">rs</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="va">chunk</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_count</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1000001000</span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_mean</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.5000044</span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_var</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.08333479</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">rs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 704 bytes</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://github.com/ctoney" class="external-link">Chris Toney</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

