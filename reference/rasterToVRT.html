<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="rasterToVRT() creates a virtual raster dataset (VRT format) derived from
one source dataset with options for virtual subsetting, virtually resampling
the source data at a different pixel resolution, or applying a virtual
kernel filter. (See buildVRT() for virtual mosaicing.)"><title>Create a GDAL virtual raster derived from one source dataset — rasterToVRT • gdalraster</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a GDAL virtual raster derived from one source dataset — rasterToVRT"><meta property="og:description" content="rasterToVRT() creates a virtual raster dataset (VRT format) derived from
one source dataset with options for virtual subsetting, virtually resampling
the source data at a different pixel resolution, or applying a virtual
kernel filter. (See buildVRT() for virtual mosaicing.)"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gdalraster</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.10.9010</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/gdal-block-cache.html">GDAL Block Cache</a>
    <a class="dropdown-item" href="../articles/gdalvector-draft.html">Draft Bindings to the GDAL/OGR Vector API</a>
    <a class="dropdown-item" href="../articles/raster-display.html">Raster Display</a>
    <a class="dropdown-item" href="../articles/gdal-config-quick-ref.html">GDAL Config Quick Reference</a>
    <a class="dropdown-item" href="../articles/raster-api-tutorial.html">Raster API Tutorial</a>
    <a class="dropdown-item" href="../articles/raster-attribute-tables.html">Raster Attribute Tables</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/USDAForestService/gdalraster/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Create a GDAL virtual raster derived from one source dataset</h1>
      <small class="dont-index">Source: <a href="https://github.com/USDAForestService/gdalraster/blob/HEAD/R/gdalraster_proc.R" class="external-link"><code>R/gdalraster_proc.R</code></a></small>
      <div class="d-none name"><code>rasterToVRT.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>rasterToVRT()</code> creates a virtual raster dataset (VRT format) derived from
one source dataset with options for virtual subsetting, virtually resampling
the source data at a different pixel resolution, or applying a virtual
kernel filter. (See <code><a href="buildVRT.html">buildVRT()</a></code> for virtual mosaicing.)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">rasterToVRT</span><span class="op">(</span></span>
<span>  <span class="va">srcfile</span>,</span>
<span>  relativeToVRT <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  vrtfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"tmprast"</span>, fileext <span class="op">=</span> <span class="st">".vrt"</span><span class="op">)</span>,</span>
<span>  resolution <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  subwindow <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  src_align <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  resampling <span class="op">=</span> <span class="st">"nearest"</span>,</span>
<span>  krnl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  normalized <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>srcfile</dt>
<dd><p>Source raster filename.</p></dd>


<dt>relativeToVRT</dt>
<dd><p>Logical. Indicates whether the source filename should
be interpreted as relative to the .vrt file (<code>TRUE</code>) or not relative
to the .vrt file (<code>FALSE</code>, the default). If <code>TRUE</code>, the .vrt
file is assumed to be in the same directory as <code>srcfile</code> and
<code>basename(srcfile)</code> is used in the .vrt file. Use <code>TRUE</code> if the .vrt file
will always be stored in the same directory with <code>srcfile</code>.</p></dd>


<dt>vrtfile</dt>
<dd><p>Output VRT filename.</p></dd>


<dt>resolution</dt>
<dd><p>A numeric vector of length two (xres, yres). The pixel
size must be expressed in georeferenced units. Both must be positive values.
The source pixel size is used if <code>resolution</code> is not specified.</p></dd>


<dt>subwindow</dt>
<dd><p>A numeric vector of length four (xmin, ymin, xmax, ymax).
Selects <code>subwindow</code> of the source raster with corners given in
georeferenced coordinates (in the source CRS).
If not given, the upper left corner of the VRT will be the
same as source, and the VRT extent will be the same or larger than source
depending on <code>resolution</code>.</p></dd>


<dt>src_align</dt>
<dd><p>Logical.</p><ul><li><p><code>TRUE</code>: the upper left corner of the VRT extent will be set to the
upper left corner of the source pixel that contains <code>subwindow</code> xmin, ymax.
The VRT will be pixel-aligned with source if the VRT <code>resolution</code> is the
same as the source pixel size, otherwise VRT extent will be the minimum
rectangle that contains <code>subwindow</code> for the given pixel size.
Often, <code>src_align=TRUE</code> when selecting a raster minimum bounding box
for a vector polygon.</p></li>
<li><p><code>FALSE</code>: the VRT upper left corner will be exactly <code>subwindow</code>
xmin, ymax, and the VRT extent will be the minimum rectangle that contains
<code>subwindow</code> for the given pixel size. If <code>subwindow</code> is not given, the
source raster extent is used in which case <code>src_align=FALSE</code> has no effect.
Use <code>src_align=FALSE</code> to pixel-align two rasters of different sizes, i.e.,
when the intent is target alignment.</p></li>
</ul></dd>


<dt>resampling</dt>
<dd><p>The resampling method to use if xsize, ysize of the VRT is
different than the size of the underlying source rectangle (in number of
pixels). The values allowed are nearest, bilinear, cubic, cubicspline,
lanczos, average and mode (as character).</p></dd>


<dt>krnl</dt>
<dd><p>A filtering kernel specified as pixel coefficients.
<code>krnl</code> is a array with dimensions (size, size), where
size must be an odd number. <code>krnl</code> can also be given as a vector with
length size x size. For example, a 3x3 average filter is given by:</p><div class="sourceCode"><pre><code><span></span>
<span><span class="va">krnl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span><span class="fl">0.11111</span>, <span class="fl">0.11111</span>, <span class="fl">0.11111</span>,</span>
<span><span class="fl">0.11111</span>, <span class="fl">0.11111</span>, <span class="fl">0.11111</span>,</span>
<span><span class="fl">0.11111</span>, <span class="fl">0.11111</span>, <span class="fl">0.11111</span><span class="op">)</span></span></code></pre></div><p>A kernel cannot be applied to sub-sampled or over-sampled data.</p></dd>


<dt>normalized</dt>
<dd><p>Logical. Indicates whether the kernel is normalized.
Defaults to <code>TRUE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Returns the VRT filename invisibly.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>rasterToVRT()</code> can be used to virtually clip and pixel-align
various raster layers with each other or in relation to vector
polygon boundaries. It also supports VRT kernel filtering.</p>
<p>A VRT dataset is saved as a plain-text file with extension .vrt. This file
contains a description of the dataset in an XML format. The description
includes the source raster filename which can be a full path
(<code>relativeToVRT = FALSE</code>) or relative path (<code>relativeToVRT = TRUE</code>).
For relative path, <code>rasterToVRT()</code> assumes that the .vrt file will be in
the same directory as the source file and uses <code>basename(srcfile)</code>. The
elements of the XML schema describe how the source data will be read, along
with algorithms potentially applied and so forth. Documentation of the XML
format for .vrt is at:
<a href="https://gdal.org/drivers/raster/vrt.html" class="external-link">https://gdal.org/drivers/raster/vrt.html</a>.</p>
<p>Since .vrt is a small plain-text file it is fast to write and requires
little storage space. Read performance is not degraded for certain simple
operations (e.g., virtual clip without resampling). Reading will be
slower for virtual resampling to a different pixel resolution or virtual
kernel filtering since the operations are performed on-the-fly (but .vrt
does not require the up front writing of a resampled or kernel-filtered
raster to a regular format). VRT is sometimes useful as an intermediate
raster in a series of processing steps, e.g., as a <code>tempfile</code> (the
default).</p>
<p>GDAL VRT format has several capabilities and uses beyond those
covered by <code>rasterToVRT()</code>. See the URL above for a full discussion.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Pixel alignment is specified in terms of the source raster pixels (i.e.,
<code>srcfile</code> of the virtual raster). The use case in mind is virtually
clipping a raster to the bounding box of a vector polygon and keeping
pixels aligned with <code>srcfile</code> (<code>src_align = TRUE</code>). <code>src_align</code> would be
set to <code>FALSE</code> if the intent is "target alignment". For example, if
<code>subwindow</code> is the bounding box of another raster with a different layout,
then also setting <code>resolution</code> to the pixel resolution of the target raster
and <code>src_align = FALSE</code> will result in a virtual raster pixel-aligned with
the target (i.e., pixels in the virtual raster are no longer aligned with
its <code>srcfile</code>). Resampling defaults to <code>nearest</code> if not specified.
Examples for both cases of <code>src_align</code> are given below.</p>
<p><code>rasterToVRT()</code> assumes <code>srcfile</code> is a north-up raster.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="GDALRaster-class.html">GDALRaster-class</a></code>, <code><a href="bbox_from_wkt.html">bbox_from_wkt()</a></code>, <code><a href="buildVRT.html">buildVRT()</a></code></p>
<p><code><a href="warp.html">warp()</a></code> can write VRT for virtual reprojection</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## resample</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">evt_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/storml_evt.tif"</span>, package<span class="op">=</span><span class="st">"gdalraster"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALRaster</span>, <span class="va">evt_file</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ds</span><span class="op">$</span><span class="fu">res</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 30 30</span>
<span class="r-in"><span><span class="va">ds</span><span class="op">$</span><span class="fu">bbox</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  323476.1 5101872.0  327766.1 5105082.0</span>
<span class="r-in"><span><span class="va">ds</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># table of the unique pixel values and their counts</span></span></span>
<span class="r-in"><span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="buildRAT.html">buildRAT</a></span><span class="op">(</span><span class="va">evt_file</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scanning raster...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0...10...20...30...40...50...60...70...80...90...100 - done.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    VALUE COUNT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   7011    28</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   7046  4564</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   7050   570</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   7055   889</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   7056   304</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6   7057    11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7   7070   267</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8   7106     3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9   7125     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10  7126  1082</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11  7140   679</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12  7143   199</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13  7144   765</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14  7145   681</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15  7166    32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16  7169    60</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17  7292   397</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18  7901     2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19  9016  2486</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20  9017    13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21  9018  1280</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22  9021    14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23  9022    98</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24    NA   876</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">$</span><span class="va">COUNT</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 15301</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># resample at 90-m resolution</span></span></span>
<span class="r-in"><span><span class="co"># EVT is thematic vegetation type so use a majority value</span></span></span>
<span class="r-in"><span><span class="va">vrt_file</span> <span class="op">&lt;-</span> <span class="fu">rasterToVRT</span><span class="op">(</span><span class="va">evt_file</span>,</span></span>
<span class="r-in"><span>                        resolution<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">90</span>,<span class="fl">90</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        resampling<span class="op">=</span><span class="st">"mode"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># .vrt is a small xml file pointing to the source raster</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.size</a></span><span class="op">(</span><span class="va">vrt_file</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1635</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tbl90m</span> <span class="op">&lt;-</span> <span class="fu"><a href="buildRAT.html">buildRAT</a></span><span class="op">(</span><span class="va">vrt_file</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scanning raster...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0...10...20...30...40...50...60...70...80...90...100 - done.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tbl90m</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    VALUE COUNT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   7011     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   7046   614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   7050    59</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   7055    75</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   7056    27</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6   7057     2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7   7070    27</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8   7126   119</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9   7140    59</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10  7143    13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11  7144    75</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12  7145    64</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13  7166     2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14  7169     4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15  7292    48</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16  9016   322</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17  9017     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18  9018   152</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19  9021     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20  9022     9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21    NA    54</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tbl90m</span><span class="op">$</span><span class="va">COUNT</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1728</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALRaster</span>, <span class="va">vrt_file</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ds</span><span class="op">$</span><span class="fu">res</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 90 90</span>
<span class="r-in"><span><span class="va">ds</span><span class="op">$</span><span class="fu">bbox</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  323476.1 5101842.0  327796.1 5105082.0</span>
<span class="r-in"><span><span class="va">ds</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="vsi_unlink.html">vsi_unlink</a></span><span class="op">(</span><span class="va">vrt_file</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## clip</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">evt_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/storml_evt.tif"</span>, package<span class="op">=</span><span class="st">"gdalraster"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ds_evt</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALRaster</span>, <span class="va">evt_file</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ds_evt</span><span class="op">$</span><span class="fu">bbox</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  323476.1 5101872.0  327766.1 5105082.0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># WKT string for a boundary within the EVT extent</span></span></span>
<span class="r-in"><span><span class="va">bnd</span> <span class="op">=</span> <span class="st">"POLYGON ((324467.3 5104814.2, 323909.4 5104365.4, 323794.2</span></span></span>
<span class="r-in"><span><span class="st">5103455.8, 324970.7 5102885.8, 326420.0 5103595.3, 326389.6 5104747.5,</span></span></span>
<span class="r-in"><span><span class="st">325298.1 5104929.4, 325298.1 5104929.4, 324467.3 5104814.2))"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># src_align = TRUE</span></span></span>
<span class="r-in"><span><span class="va">vrt_file</span> <span class="op">&lt;-</span> <span class="fu">rasterToVRT</span><span class="op">(</span><span class="va">evt_file</span>,</span></span>
<span class="r-in"><span>                        subwindow <span class="op">=</span> <span class="fu"><a href="bbox_from_wkt.html">bbox_from_wkt</a></span><span class="op">(</span><span class="va">bnd</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        src_align<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ds_vrt</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALRaster</span>, <span class="va">vrt_file</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># VRT is a virtual clip, pixel-aligned with the EVT raster</span></span></span>
<span class="r-in"><span><span class="fu"><a href="bbox_from_wkt.html">bbox_from_wkt</a></span><span class="op">(</span><span class="va">bnd</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  323794.2 5102885.8  326420.0 5104929.4</span>
<span class="r-in"><span><span class="va">ds_vrt</span><span class="op">$</span><span class="fu">bbox</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  323776.1 5102862.0  326446.1 5104932.0</span>
<span class="r-in"><span><span class="va">ds_vrt</span><span class="op">$</span><span class="fu">res</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 30 30</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ds_vrt</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="vsi_unlink.html">vsi_unlink</a></span><span class="op">(</span><span class="va">vrt_file</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># src_align = FALSE</span></span></span>
<span class="r-in"><span><span class="va">vrt_file</span> <span class="op">&lt;-</span> <span class="fu">rasterToVRT</span><span class="op">(</span><span class="va">evt_file</span>,</span></span>
<span class="r-in"><span>                        subwindow <span class="op">=</span> <span class="fu"><a href="bbox_from_wkt.html">bbox_from_wkt</a></span><span class="op">(</span><span class="va">bnd</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        src_align<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ds_vrt_noalign</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALRaster</span>, <span class="va">vrt_file</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># VRT upper left corner (xmin, ymax) is exactly bnd xmin, ymax</span></span></span>
<span class="r-in"><span><span class="va">ds_vrt_noalign</span><span class="op">$</span><span class="fu">bbox</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  323794.2 5102859.4  326434.2 5104929.4</span>
<span class="r-in"><span><span class="va">ds_vrt_noalign</span><span class="op">$</span><span class="fu">res</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 30 30</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ds_vrt_noalign</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="vsi_unlink.html">vsi_unlink</a></span><span class="op">(</span><span class="va">vrt_file</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ds_evt</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## subset and pixel align two rasters</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># FARSITE landscape file for the Storm Lake area</span></span></span>
<span class="r-in"><span><span class="va">lcp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/storm_lake.lcp"</span>, package<span class="op">=</span><span class="st">"gdalraster"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ds_lcp</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALRaster</span>, <span class="va">lcp_file</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Landsat band 5 file covering the Storm Lake area</span></span></span>
<span class="r-in"><span><span class="va">b5_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/sr_b5_20200829.tif"</span>, package<span class="op">=</span><span class="st">"gdalraster"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ds_b5</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALRaster</span>, <span class="va">b5_file</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ds_lcp</span><span class="op">$</span><span class="fu">bbox</span><span class="op">(</span><span class="op">)</span>  <span class="co"># 323476.1 5101872.0  327766.1 5105082.0</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  323476.1 5101872.0  327766.1 5105082.0</span>
<span class="r-in"><span><span class="va">ds_lcp</span><span class="op">$</span><span class="fu">res</span><span class="op">(</span><span class="op">)</span>   <span class="co"># 30 30</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 30 30</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ds_b5</span><span class="op">$</span><span class="fu">bbox</span><span class="op">(</span><span class="op">)</span>   <span class="co"># 323400.9 5101815.8  327870.9 5105175.8</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  323400.9 5101815.8  327870.9 5105175.8</span>
<span class="r-in"><span><span class="va">ds_b5</span><span class="op">$</span><span class="fu">res</span><span class="op">(</span><span class="op">)</span>    <span class="co"># 30 30</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 30 30</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># src_align = FALSE because we need target alignment in this case:</span></span></span>
<span class="r-in"><span><span class="va">vrt_file</span> <span class="op">&lt;-</span> <span class="fu">rasterToVRT</span><span class="op">(</span><span class="va">b5_file</span>,</span></span>
<span class="r-in"><span>                        resolution <span class="op">=</span> <span class="va">ds_lcp</span><span class="op">$</span><span class="fu">res</span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        subwindow <span class="op">=</span> <span class="va">ds_lcp</span><span class="op">$</span><span class="fu">bbox</span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        src_align <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ds_b5vrt</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALRaster</span>, <span class="va">vrt_file</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ds_b5vrt</span><span class="op">$</span><span class="fu">bbox</span><span class="op">(</span><span class="op">)</span> <span class="co"># 323476.1 5101872.0  327766.1 5105082.0</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  323476.1 5101872.0  327766.1 5105082.0</span>
<span class="r-in"><span><span class="va">ds_b5vrt</span><span class="op">$</span><span class="fu">res</span><span class="op">(</span><span class="op">)</span>  <span class="co"># 30 30</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 30 30</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># read the the Landsat file pixel-aligned with the LCP file</span></span></span>
<span class="r-in"><span><span class="co"># summarize band 5 reflectance where FBFM = 165</span></span></span>
<span class="r-in"><span><span class="co"># LCP band 4 contains FBFM (a classification of fuel beds):</span></span></span>
<span class="r-in"><span><span class="va">ds_lcp</span><span class="op">$</span><span class="fu">getMetadata</span><span class="op">(</span>band<span class="op">=</span><span class="fl">4</span>, domain<span class="op">=</span><span class="st">""</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "FUEL_MODEL_FILE=/netapp/sharedwebfs1/shared/landfire/public/temp_q8dTbIJ4w6Qi36Omkzk0/LCP_LF2022_FBFM40_220_CONUS/temp/merged_modified.tif"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2] "FUEL_MODEL_MAX=183"                                                                                                                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3] "FUEL_MODEL_MIN=-9999"                                                                                                                      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4] "FUEL_MODEL_NUM_CLASSES=12"                                                                                                                 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5] "FUEL_MODEL_OPTION=0"                                                                                                                       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6] "FUEL_MODEL_OPTION_DESC=no custom models AND no conversion file needed"                                                                     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [7] "FUEL_MODEL_VALUES=0,98,99,101,102,121,122,123,142,162,165,181,183"                                                                         </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># verify Landsat nodata (0):</span></span></span>
<span class="r-in"><span><span class="va">ds_b5vrt</span><span class="op">$</span><span class="fu">getNoDataValue</span><span class="op">(</span>band<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-in"><span><span class="co"># will be read as NA and omitted from stats</span></span></span>
<span class="r-in"><span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">RunningStats</span>, na_rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ncols</span> <span class="op">&lt;-</span> <span class="va">ds_lcp</span><span class="op">$</span><span class="fu">getRasterXSize</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nrows</span> <span class="op">&lt;-</span> <span class="va">ds_lcp</span><span class="op">$</span><span class="fu">getRasterYSize</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">row</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">nrows</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">row_fbfm</span> <span class="op">&lt;-</span> <span class="va">ds_lcp</span><span class="op">$</span><span class="fu">read</span><span class="op">(</span>band<span class="op">=</span><span class="fl">4</span>, xoff<span class="op">=</span><span class="fl">0</span>, yoff<span class="op">=</span><span class="va">row</span>,</span></span>
<span class="r-in"><span>                            xsize<span class="op">=</span><span class="va">ncols</span>, ysize<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                            out_xsize<span class="op">=</span><span class="va">ncols</span>, out_ysize<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">row_b5</span> <span class="op">&lt;-</span> <span class="va">ds_b5vrt</span><span class="op">$</span><span class="fu">read</span><span class="op">(</span>band<span class="op">=</span><span class="fl">1</span>, xoff<span class="op">=</span><span class="fl">0</span>, yoff<span class="op">=</span><span class="va">row</span>,</span></span>
<span class="r-in"><span>                            xsize<span class="op">=</span><span class="va">ncols</span>, ysize<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                            out_xsize<span class="op">=</span><span class="va">ncols</span>, out_ysize<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>     <span class="va">rs</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="va">row_b5</span><span class="op">[</span><span class="va">row_fbfm</span> <span class="op">==</span> <span class="fl">165</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_count</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2498</span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_mean</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 12992.35</span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_min</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 7635</span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_max</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 17866</span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_sum</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 32454886</span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_var</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1214912</span>
<span class="r-in"><span><span class="va">rs</span><span class="op">$</span><span class="fu">get_sd</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1102.23</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ds_b5vrt</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="vsi_unlink.html">vsi_unlink</a></span><span class="op">(</span><span class="va">vrt_file</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ds_lcp</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ds_b5</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://github.com/ctoney" class="external-link">Chris Toney</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

