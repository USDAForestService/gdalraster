<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Vector API Overview • gdalraster</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Vector API Overview">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gdalraster</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.12.0.9300</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/gdal-block-cache.html">GDAL Block Cache</a></li>
    <li><a class="dropdown-item" href="../articles/gdal-config-quick-ref.html">GDAL Config Quick Reference</a></li>
    <li><a class="dropdown-item" href="../articles/gdalvector-draft.html">Draft Bindings to the GDAL/OGR Vector API</a></li>
    <li><a class="dropdown-item" href="../articles/raster-api-tutorial.html">Raster API Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/raster-attribute-tables.html">Raster Attribute Tables</a></li>
    <li><a class="dropdown-item" href="../articles/raster-display.html">Raster Display</a></li>
    <li><a class="dropdown-item" href="../articles/vector-api-overview.html">Vector API Overview</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/USDAForestService/gdalraster/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Vector API Overview</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/USDAForestService/gdalraster/blob/main/vignettes/vector-api-overview.Rmd" class="external-link"><code>vignettes/vector-api-overview.Rmd</code></a></small>
      <div class="d-none name"><code>vector-api-overview.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>Beginning at version 2.0, <strong>gdalraster</strong> includes
bindings to a substantial subset of the GDAL Vector API. The vector
bindings provide an R implementation of the <a href="https://gdal.org/en/stable/user/vector_data_model.html" class="external-link">GDAL
Vector Data Model</a>. Readers are encouraged to review that document
for background on the underlying object model and how it relates to
usage of the API in <strong>gdalraster</strong>.</p>
<p>The prefix <a href="https://gdal.org/en/stable/faq.html#what-is-this-ogr-stuff" class="external-link">OGR</a>
is used in GDAL with class names, command-line utilities, etc., that
refer to vector-specific components of the library. In
<strong>gdalraster</strong>, “ogr” will be used throughout the
documentation and as a prefix on function names, consistent with the
style of the source library. There is also a certain amount of
unification of the raster and vector APIs in GDAL. In
<strong>gdalraster</strong>, we will also refer to the “GDAL Vector API”
and use <code>GDALVector</code> as a class name. To support the vector
API, <strong>gdalraster</strong> 2.0 builds on its already existing
bindings to portions of GDAL’s Spatial Reference System and Geometry
APIs.</p>
</div>
<div class="section level2">
<h2 id="rationale">Rationale<a class="anchor" aria-label="anchor" href="#rationale"></a>
</h2>
<p>As an implementation of GDAL’s Raster and Vector Data Models,
<strong>gdalraster</strong> is not intended as a direct alternative to
existing R packages such as <strong>sf</strong> and
<strong>terra</strong> that primarily implement higher-level analytical
data models. <strong>gdalraster</strong> is primarily focused on
API-level bindings, attempting to expose most of the underlying C++
library in R. More direct access to GDAL’s I/O capabilities may benefit
workflows that deal with source data provided on a continuum ranging
from local storage and in-memory formats to database servers and cloud
systems, often involving various compression formats, SQL dialects, etc.
Modularized, low-level access to GDAL/OGR functionality should be of
interest to R developers creating higher-level interfaces, where the
analytical data models may not have been designed with their use cases
in mind. API bindings facilitate code translation and reuse which can
benefit hybrid environments where GDAL is used from multiple languages.
Long-term stability of bindings at the library level is desirable in
production scenarios, and is a major goal for the package. It is
intended that <strong>gdalraster</strong> should complement and
interoperate within R’s extensive and evolving spatial ecosystem.</p>
</div>
<div class="section level2">
<h2 id="vector-api-components">Vector API components<a class="anchor" aria-label="anchor" href="#vector-api-components"></a>
</h2>
<p>This section describes the organization of the vector components in
<strong>gdalraster</strong>, linking to package documentation for
extended text on specific topics.</p>
<div class="section level3">
<h3 id="core-bindings">Core bindings<a class="anchor" aria-label="anchor" href="#core-bindings"></a>
</h3>
<p>Core functionality for vector is provided by the exposed C++ class
<code>GDALVector</code>, along with a set of stand-along functions with
<code>ogr_</code> prefix.</p>
<div class="section level4">
<h4 id="class-gdalvector">Class <code>GDALVector</code><a class="anchor" aria-label="anchor" href="#class-gdalvector"></a>
</h4>
<p><code>GDALVector</code> is a C++ class exposed in R via <a href="https://cran.r-project.org/web/packages/Rcpp/vignettes/Rcpp-modules.pdf" class="external-link"><strong>Rcpp</strong>
modules</a>. It encapsulates a single OGRLayer and the GDALDataset that
contains it. An object of class <code>GDALVector</code> persists an open
connection to the dataset, and exposes methods to:</p>
<ul>
<li>retrieve layer information</li>
<li>set attribute and spatial filters</li>
<li>set ignored fields/selected fields</li>
<li>traverse and read feature data by traditional row-based cursor</li>
<li>fetch the full feature set and return as a data frame</li>
<li>fetch progressively in batches of <code>n</code> features at a
time</li>
<li>read via column-oriented ArrowArrayStream</li>
<li>write new features in a layer</li>
<li>upsert</li>
<li>edit/overwrite existing features</li>
<li>delete</li>
<li>perform operations within transactions</li>
</ul>
<p>A <code>GDALVector</code> object is typically generated with a call
to <code>new()</code> but is also returned from certain
<code>ogr_*()</code> functions. The documentation for
<code><a href="../reference/GDALVector-class.html">?GDALVector</a></code> gives a full list of available methods in the
Usage section, along with their descriptions under Details. Methods of
the class are accessed using the <code>$</code> operator.</p>
</div>
<div class="section level4">
<h4 id="ogr-stand-alone-functions">OGR stand-alone functions<a class="anchor" aria-label="anchor" href="#ogr-stand-alone-functions"></a>
</h4>
<p>Several of the stand-alone <code>ogr_*()</code> functions are grouped
under the documentation topics <code><a href="../reference/ogr_manage.html">?ogr_manage</a></code> and
<code><a href="../reference/ogr_define.html">?ogr_define</a></code>. The <code>ogr_manage</code> functions can be
used to:</p>
<ul>
<li>create new vector datasets from scratch</li>
<li>test for existence of datasets, layers and fields</li>
<li>test dataset and layer capabilities</li>
<li>create new layers in an existing dataset</li>
<li>delete layers</li>
<li>create new attribute and geometry fields on an existing layer</li>
<li>rename and delete fields</li>
<li>edit data with SQL statements</li>
</ul>
<p><code>ogr_define</code> provides documentation and helper functions
for defining feature classes. An OGR feature class definition (a.k.a.
layer definition) is modeled in R as a named list containing zero or
more attribute field definitions, along with one or more geometry field
definitions. Specifications of the the list structures for these
definitions are given in <code><a href="../reference/ogr_define.html">?ogr_define</a></code>. The associated helper
functions make it easy to create new layer definitions from scratch or
modify an existing definition. A layer definition is convenient but not
required for creating a new vector dataset, or a new layer within an
existing dataset, using <code><a href="../reference/ogr_manage.html">ogr_ds_create()</a></code> /
<code><a href="../reference/ogr_manage.html">ogr_layer_create()</a></code>.</p>
<p>OGR facilities for vector geoprocessing are available in
<code><a href="../reference/ogr_proc.html">ogr_proc()</a></code>. This function can perform the following GIS
overlay operations: Intersection, Union, SymDifference, Identity,
Update, Clip and Erase (<a href="https://en.wikipedia.org/wiki/Vector_overlay" class="external-link uri">https://en.wikipedia.org/wiki/Vector_overlay</a>).
<code><a href="../reference/ogr_proc.html">ogr_proc()</a></code> is basically an R port of the command-line
utility <a href="https://gdal.org/en/stable/programs/ogr_layer_algebra.html#ogr-layer-algebra" class="external-link"><code>ogr_layer_algebra</code></a>
included in the GDAL Python bindings. In both cases, these are
interfaces to library functions in the OGR C++ API.</p>
<p><code><a href="../reference/ogrinfo.html">ogrinfo()</a></code> and <code><a href="../reference/ogr2ogr.html">ogr2ogr()</a></code>, provide R wrappers
of the GDAL command-line utilities <a href="https://gdal.org/en/stable/programs/ogrinfo.html" class="external-link"><code>ogrinfo</code></a>
and <a href="https://gdal.org/en/stable/programs/ogr2ogr.html" class="external-link"><code>ogr2ogr</code></a>.
These functions support all of the command-line arguments described in
the GDAL documentation, providing a powerful set of capabilities for
obtaining information about an OGR-supported data source, converting
vector data between file formats, and potentially editing data with SQL
statements. <code><a href="../reference/ogr_reproject.html">ogr_reproject()</a></code> is a convenience wrapper around
<code><a href="../reference/ogr2ogr.html">ogr2ogr()</a></code> for reprojecting vector layers with a user
friendly interface.</p>
</div>
</div>
<div class="section level3">
<h3 id="supporting-apis">Supporting APIs<a class="anchor" aria-label="anchor" href="#supporting-apis"></a>
</h3>
<div class="section level4">
<h4 id="spatial-reference-systems">Spatial Reference Systems<a class="anchor" aria-label="anchor" href="#spatial-reference-systems"></a>
</h4>
<p>Bindings to a subset of GDAL’s Spatial Reference System API are
provided by a set of stand-alone <code>srs_*()</code> functions. These
support conversion of spatial reference definitions in various formats
to OGC Well Known Text (WKT) representation (e.g., from EPSG codes, well
known names such as NAD27, NAD83, WGS84, etc., PROJ.4 definitions,
PROJJSON, and others, as well as between different versions of OGC WKT,
see <code><a href="../reference/srs_convert.html">?srs_convert</a></code>). Functions under the
<code><a href="../reference/srs_query.html">?srs_query</a></code> topic provide various information about a given
SRS definition, and support testing definitions for equality.</p>
</div>
<div class="section level4">
<h4 id="geometry">Geometry<a class="anchor" aria-label="anchor" href="#geometry"></a>
</h4>
<p>Bindings to a significant subset of GDAL’s Geometry API are
implemented in a set of functions prefixed <code>g_*()</code>. Many of
these functions are built on the <a href="https://libgeos.org/" class="external-link">GEOS
library</a> (i.e., use GEOS via GDAL headers).</p>
<p>The geometry functions offer flexibility by allowing input geometries
to be given as either a single <a href="https://libgeos.org/specifications/wkt/" class="external-link">WKT string</a>, a
character vector of WKT strings, a single <code>raw</code> vector
containing <a href="https://libgeos.org/specifications/wkb/" class="external-link">WKB</a>, or
a list of WKB <code>raw</code> vectors. Output geometries are in WKB
format by default, but WKT can also be requested. The convenience
function <code><a href="../reference/g_wk2wk.html">g_wk2wk()</a></code> will convert its input from one to the
other accordingly.</p>
<p>The factory functions <code><a href="../reference/g_factory.html">g_create()</a></code> and
<code><a href="../reference/g_factory.html">g_add_geom()</a></code> support creating basic geometry types from
point data (vertices), and building container geometry types from
sub-geometries. Other capabilities of the geometry bindings include:</p>
<ul>
<li>inspection (see <code><a href="../reference/g_query.html">?g_query</a></code>)</li>
<li>binary predicates (see <code><a href="../reference/g_binary_pred.html">?g_binary_pred</a></code>)</li>
<li>binary operations (see <code><a href="../reference/g_binary_op.html">?g_binary_op</a></code>)</li>
<li>unary operations (e.g., <code><a href="../reference/g_buffer.html">g_buffer()</a></code>,
<code><a href="../reference/g_simplify.html">g_simplify()</a></code>)</li>
<li>measurements (see <code><a href="../reference/g_measures.html">?g_measures</a></code>)</li>
<li>miscellaneous utilities (e.g., <code><a href="../reference/g_coords.html">g_coords()</a></code>,
<code><a href="../reference/g_make_valid.html">g_make_valid()</a></code>, <code><a href="../reference/g_swap_xy.html">g_swap_xy()</a></code>,
<code><a href="../reference/g_transform.html">g_transform()</a></code>)</li>
</ul>
<p>Convenience functions for working with bounding boxes are also
provided (e.g., convert to/from WKT, intersection/union, and
<code><a href="../reference/bbox_transform.html">bbox_transform()</a></code>).</p>
</div>
<div class="section level4">
<h4 id="virtual-systems-interface">Virtual Systems Interface<a class="anchor" aria-label="anchor" href="#virtual-systems-interface"></a>
</h4>
<p>Bindings to the GDAL’s Virtual Systems Interface (VSI) implement
standard file system operations abstracted for URLs, cloud storage
services, Zip/GZip/7z/RAR, in-memory files, as well as “regular” local
file systems. This provides a single interface for operating on file
system objects, that works the same for any storage backend. The
<code>vsi_*()</code> functions have general utility not limited to
operating on spatial data sources.</p>
<p>Class <code>VSIFile</code> implements bindings to the GDAL
VSIVirtualHandle API, providing analogs of Standard C file I/O functions
that operate on VSI file systems (<code><a href="https://rdrr.io/r/base/seek.html" class="external-link">seek()</a></code>,
<code>tell()</code>, <code>read()</code>, <code><a href="https://rdrr.io/r/base/write.html" class="external-link">write()</a></code>,
etc.)</p>
</div>
<div class="section level4">
<h4 id="general-data-management">General data management<a class="anchor" aria-label="anchor" href="#general-data-management"></a>
</h4>
<p>Existing data management functions that operate on both raster and
vector data sources include <code><a href="../reference/addFilesInZip.html">addFilesInZip()</a></code> (supporting
create/append to a potentially <a href="https://github.com/sozip/sozip-spec" class="external-link">Seek-Optimized ZIP</a> file),
<code><a href="../reference/deleteDataset.html">deleteDataset()</a></code>, <code><a href="../reference/identifyDriver.html">identifyDriver()</a></code> and
<code><a href="../reference/inspectDataset.html">inspectDataset()</a></code>.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="workflow-considerations">Workflow considerations<a class="anchor" aria-label="anchor" href="#workflow-considerations"></a>
</h2>
<p>Creation of new vector datasets, and schema modification in existing
datasets, are performed with the <code>ogr_*()</code> stand-alone
functions. These are “one-off” operations that attempt to open the
dataset with update access, perform modifications, and then close the
dataset.</p>
<p>Objects of class <code>GDALVector</code> are used for obtaining layer
information and reading/writing feature data. A <code>GDALVector</code>
object provides a persistent connection to a layer and the vector
dataset that contains it. That is, once instantiated, a
<code>GDALVector</code> object represents a live connection to the
dataset until its <code>$close()</code> method is called. The connection
may be read-only (by default), or may be with update access allowing
insert of new features, modifying exiting features and deleting
features. Currently, class <code>GDALVector</code> does not provide
methods for modifying the layer schema.</p>
<p>It is not recommended to instantiate a new <code>GDALVector</code>
object on a layer that is already open for update access (i.e., with
<code>read_only = FALSE</code>). Likewise, potential modifications to a
layer schema using the <code>ogr_*()</code> management functions should
be done prior to instantiating a <code>GDALVector</code> object on the
layer.</p>
<p>Relational database management systems (RDBMSs, e.g., GPKG / SQLite,
PostgreSQL / PostGIS) generally support multiple connections including
concurrent reads (e.g., multiple instances of <code>GDALVector</code>
reading from different layers). It is also possible to have one or more
<code>GDALVector</code> objects instantiated on RDBMS-based layers for
read access, while another <code>GDALVector</code> object performs write
operations on a different layer in the same database. Database locking
mechanisms for write operations are specific to the driver and
underlying RDBMS (see, e.g., SQLite <a href="https://gdal.org/en/stable/drivers/vector/sqlite.html#configuration-options" class="external-link">Configuration
Options</a> and <a href="https://gdal.org/en/stable/drivers/vector/sqlite.html#performance-hints" class="external-link">Performance
Hints</a>).</p>
<div class="section level3">
<h3 id="data-retrieval">Data retrieval<a class="anchor" aria-label="anchor" href="#data-retrieval"></a>
</h3>
<p>A <code>GDALVector</code> object supports traditional <a href="https://en.wikipedia.org/wiki/Cursor_(databases)" class="external-link">cursor-based</a>
traversal over the features (rows) in a layer, and optionally,
column-oriented retrieval via <a href="https://arrow.apache.org/docs/format/CStreamInterface.html" class="external-link">Apache
Arrow C stream interface</a> (with GDAL &gt;= 3.6). Data retrieval may
be performed against a vector layer in full, a layer with attribute
and/or spatial filters applied, or a layer defined as the result set of
an SQL statement executed on the underlying data source.</p>
<p>OGR methods that retrieve a single feature (i.e.,
<code>$getFeature()</code>, <code>$getNextFeature()</code>) return data
in a named list of fields and their values. <code>GDALVector</code> also
provides the <code>$fetch()</code> method to retrieve a batch of
<code>n</code> features from the current cursor position and return them
in a data frame. The <code>$fetch()</code> method is an analog of <a href="https://dbi.r-dbi.org/reference/dbFetch.html" class="external-link"><code>DBI::dbFetch()</code></a>
with essentially identical calling semantics. Specifying
<code>n = -1</code> or <code>n = Inf</code> will retrieve all features
from the beginning (honoring any spatial or attribute filters that may
be in effect).</p>
<p>Currently, <strong>gdalraster</strong> implements only minimal S3
class interfaces for R objects containing the returned feature data. A
single feature as returned by
<code>$getFeature()</code>/<code>$getNextFeature()</code> is a list
object carrying the <code>"OGRFeature"</code> class attribute. A data
frame returned by <code>$fetch()</code> carries the
<code>"OGRFeatureSet"</code> class attribute. S3 methods are provided
for the <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> and <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> generics as a
convenience for examining output. Otherwise, there are currently no S3
classes for geometries or geometry columns, no concept of “sticky”
geometry as implemented in package <strong>sf</strong>, and no automatic
propagation of coordinate reference systems. S3 interfaces may expand in
future versions, but <strong>gdalraster</strong> leans toward minimalism
and the use of simple, lightweight objects for holding raw data.</p>
</div>
<div class="section level3">
<h3 id="interoperability">Interoperability<a class="anchor" aria-label="anchor" href="#interoperability"></a>
</h3>
<p>The <code>$fetch()</code> method of a <code>GDALVector</code> object
returns geometries in a list column of WKB raw vectors by default. The
Geometry API functions (<code>g_*()</code>) also operate by default on
lists of WKB raw vectors. Representation of geometries as WKB is compact
and performant, and seamlessly integrates with the parsing, conversion,
manipulation and plotting functions in <a href="https://paleolimbot.github.io/wk/" class="external-link">package <strong>wk</strong></a>
(a <strong>gdalraster</strong> dependency for vector plotting, and
currently used for <code><a href="../reference/g_coords.html">g_coords()</a></code>).</p>
<p>The <code>$getArrowStream()</code> method of a
<code>GDALVector</code> object allows retrieving data in a
column-oriented memory format. It exposes an ArrowArrayStream on a layer
as a <code>nanoarrow_array_stream</code> object. The <a href="https://arrow.apache.org/nanoarrow/latest/getting-started/r.html" class="external-link"><strong>nanoarrow</strong>
package</a> provides functionality to consume the array stream and
import to R data structures (which are generally column oriented).
<strong>nanoarrow</strong> provides helpers to facilitate zero-copy data
transfer among R bindings to libraries implementing the Arrow C data
interface. It is possible to pass <strong>nanoarrow</strong> objects to
many functions in the <strong>arrow</strong> package.
<strong>nanoarrow</strong> objects also integrate with the extension
types implemented in the <strong>geoarrow</strong> package.</p>
<p>A data frame returned by the <code>$fetch()</code> method of a
<code>GDALVector</code> object (i.e., an <code>"OGRFeatureSet"</code>)
can be converted to an <strong>sf</strong> data frame with
<code>sf::st_sf()</code>. A value for the <code>crs</code> argument can
be obtained from method <code>$getSpatialRef()</code> of the
<code>GDALVector</code> object from which the data were read (assuming
no subsequent transformation of geometries has been performed).</p>
</div>
</div>
<div class="section level2">
<h2 id="data-type-specifications">Data type specifications<a class="anchor" aria-label="anchor" href="#data-type-specifications"></a>
</h2>
<p>OGR field types are returned as the following R data types. R
currently lacks a native 64-bit integer type. Support for 64-bit integer
values in R is provided by the <a href="https://CRAN.R-project.org/package=bit64" class="external-link"><strong>bit64</strong>
package</a> (represented as <code>numeric</code> values carrying the
<code>"integer64"</code> class attribute). OGR NULL values are returned
as type-specific <code>NA</code> (i.e., <code>NA</code>,
<code>NA_integer_</code>, <code>NA_integer64_</code>,
<code>NA_real_</code>, <code>NA_character_</code>). When retrieving a
batch of features as a data frame (<code>"OGRFeatureSet"</code>), some
field types will be contained in a data frame list column as
indicated:</p>
<ul>
<li>
<strong>OFTInteger</strong>: <code>integer</code> value</li>
<li>
<strong>OFTInteger subtype OFSTBoolean</strong>:
<code>logical</code> value</li>
<li>
<strong>OFTIntegerList</strong>: vector of <code>integer</code>
(list column)</li>
<li>
<strong>OFTInteger64</strong>: <code>numeric</code> value carrying
the <code>"integer64"</code> class attribute</li>
<li>
<strong>OFTInteger64 subtype OFSTBoolean</strong>:
<code>logical</code> value</li>
<li>
<strong>OFTInteger64List</strong>: vector of
<code><a href="https://rdrr.io/pkg/bit64/man/bit64-package.html" class="external-link">bit64::integer64</a></code> (list column)</li>
<li>
<strong>OFTReal</strong>: <code>numeric</code> value</li>
<li>
<strong>OFTRealList</strong>: vector of <code>numeric</code> (list
column)</li>
<li>
<strong>OFTString</strong>: <code>character</code> string</li>
<li>
<strong>OFTStringList</strong>: vector of <code>character</code>
strings (list column)</li>
<li>
<strong>OFTDate</strong>: <code>numeric</code> value of class
<code>"Date"</code>
</li>
<li>
<strong>OFTDateTime</strong>: <code>numeric</code> value of class
<code>"POSIXct"</code> (millisecond accuracy)</li>
<li>
<strong>OFTTime</strong>: <code>character</code> string
(<code>"HH:MM:SS"</code>)</li>
<li>
<strong>OFTBinary</strong>: <code>raw</code> vector (list column,
<code>NULL</code> entries for OGR NULL values)</li>
</ul>
<p>By default, geometries are returned as WKB <code>raw</code> vectors
in a data frame list column (with <code>NULL</code> entries for OGR NULL
geometries). The per-object setting <code>$returnGeomAs</code> can also
be set to one of <code>"WKB_ISO"</code>, <code>"WKT"</code>,
<code>"WKT_ISO"</code>, or <code>"NONE"</code>. Omitting the geometries
(e.g., by setting <code>lyr$returnGeomAs &lt;- "NONE"</code>) may be
beneficial for performance and memory usage when access only to feature
attributes is required.</p>
<p>For more information on 64-bit integer support using the
<strong>bit64</strong> package, see <code><a href="https://rdrr.io/pkg/bit64/man/bit64-package.html" class="external-link">?bit64::integer64</a></code> or
the web version at <a href="https://bit64.r-lib.org/reference/bit64-package.html" class="external-link uri">https://bit64.r-lib.org/reference/bit64-package.html</a>.</p>
</div>
<div class="section level2">
<h2 id="code-examples">Code examples<a class="anchor" aria-label="anchor" href="#code-examples"></a>
</h2>
<p>Parentheses around statements are used throughout the examples only
as a shortcut to display the assigned values. The
<code><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file()</a></code> command is only used to obtain the path to
the package sample files; it would not be needed in typical usage.</p>
<div class="section level3">
<h3 id="inspect-data-sources">Inspect data sources<a class="anchor" aria-label="anchor" href="#inspect-data-sources"></a>
</h3>
<p>Data sources can be files, relational database management systems,
directories of many files, or even remote web services depending on the
format driver being used. However, the data source name (DSN) is always
a single string which might be the file path, database connection
string, URL, etc.</p>
<p>The following examples use a GeoPackage file included in
<strong>gdalraster</strong>. The file ynp_features.gpkg is compressed
using SOZip and will be read directly from the .zip archive without
decompressing first. A prefix is added to the file path (<a href="https://gdal.org/en/stable/user/virtual_file_systems.html#vsizip-zip-archives" class="external-link">/vsizip/</a>
in this case) which specifies a GDAL Virtual File System handler. A file
system handler provides access to less standard file types such as
in-memory, compressed (.zip, .gz, .tar, .tar.gz), encrypted, standard
input and output (STDIN, STDOUT), files stored on network (publicly
accessible, or in private buckets of commercial cloud services),
etc.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usdaforestservice.github.io/gdalraster/">gdalraster</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get path to the Yellowstone National Park sample dataset</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/ynp_features.zip"</span>, package <span class="op">=</span> <span class="st">"gdalraster"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add the VSI prefix </span></span>
<span><span class="op">(</span><span class="va">zf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"/vsizip"</span>, <span class="va">f</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/vsizip//home/runner/work/_temp/Library/gdalraster/extdata/ynp_features.zip"</span></span>
<span></span>
<span><span class="co"># list files in the zip archive</span></span>
<span><span class="fu"><a href="../reference/vsi_read_dir.html">vsi_read_dir</a></span><span class="op">(</span><span class="va">zf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "readme_lf_forest_canopy_cover.txt" "readme_lf_operational_roads.txt"  </span></span>
<span><span class="co">#&gt; [3] "readme_ynp_vector_features.txt"    "ynp_bnd_metadata.html"            </span></span>
<span><span class="co">#&gt; [5] "ynp_features.gpkg"</span></span>
<span></span>
<span><span class="co"># VSI path to the GPKG file</span></span>
<span><span class="op">(</span><span class="va">zf_gpkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">zf</span>, <span class="st">"ynp_features.gpkg"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/vsizip//home/runner/work/_temp/Library/gdalraster/extdata/ynp_features.zip/ynp_features.gpkg"</span></span></code></pre></div>
<p>It is possible to chain multiple file system handlers. The <a href="https://gdal.org/en/stable/user/virtual_file_systems.html#vsicurl-http-https-ftp-files-random-access" class="external-link">/vsicurl/</a>
prefix specifies a file system handler that allows on-the-fly random
reading of files available through web protocols, without prior download
of the entire file. For example, a zip file residing on a web server
instead of the local file system could be accessed with a path like:</p>
<pre><code>/vsizip//vsicurl/https://www.example.com/path/to/file.zip</code></pre>
<p>Support for SOZip is available with GDAL &gt;= 3.7. The function
<code><a href="../reference/vsi_get_file_metadata.html">vsi_get_file_metadata()</a></code> can be used to validate an SOZip
file and obtain compression information. Otherwise, SOZip is fully
backward compatible and works as a regular .zip file.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/gdal_version.html">gdal_version_num</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fu"><a href="../reference/gdal_compute_version.html">gdal_compute_version</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">7</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"SOZip metadata for ynp_features.gpkg:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/vsi_get_file_metadata.html">vsi_get_file_metadata</a></span><span class="op">(</span><span class="va">zf_gpkg</span>, domain <span class="op">=</span> <span class="st">"ZIP"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"SOZip support requires GDAL &gt;= 3.7\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; SOZip metadata for ynp_features.gpkg:</span></span>
<span><span class="co">#&gt; $START_DATA_OFFSET</span></span>
<span><span class="co">#&gt; [1] "5188"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $COMPRESSION_METHOD</span></span>
<span><span class="co">#&gt; [1] "8 (DEFLATE)"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $COMPRESSED_SIZE</span></span>
<span><span class="co">#&gt; [1] "532555"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $UNCOMPRESSED_SIZE</span></span>
<span><span class="co">#&gt; [1] "1220608"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $SOZIP_FOUND</span></span>
<span><span class="co">#&gt; [1] "YES"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $SOZIP_VERSION</span></span>
<span><span class="co">#&gt; [1] "1"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $SOZIP_OFFSET_SIZE</span></span>
<span><span class="co">#&gt; [1] "8"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $SOZIP_CHUNK_SIZE</span></span>
<span><span class="co">#&gt; [1] "32768"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $SOZIP_START_DATA_OFFSET</span></span>
<span><span class="co">#&gt; [1] "537801"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $SOZIP_VALID</span></span>
<span><span class="co">#&gt; [1] "YES"</span></span></code></pre></div>
<p><code><a href="../reference/inspectDataset.html">inspectDataset()</a></code> returns information about the format
and content of a data source that may contain raster and/or vector
data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/inspectDataset.html">inspectDataset</a></span><span class="op">(</span><span class="va">zf_gpkg</span><span class="op">)</span></span>
<span><span class="co">#&gt; $format</span></span>
<span><span class="co">#&gt; [1] "GPKG"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $supports_raster</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $contains_raster</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $supports_subdatasets</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $contains_subdatasets</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $subdataset_names</span></span>
<span><span class="co">#&gt; [1] "GPKG:/vsizip//home/runner/work/_temp/Library/gdalraster/extdata/ynp_features.zip/ynp_features.gpkg:operational_roads"  </span></span>
<span><span class="co">#&gt; [2] "GPKG:/vsizip//home/runner/work/_temp/Library/gdalraster/extdata/ynp_features.zip/ynp_features.gpkg:forest_canopy_cover"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $supports_vector</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $contains_vector</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $layer_names</span></span>
<span><span class="co">#&gt; [1] "ynp_bnd"            "roads"              "points_of_interest"</span></span></code></pre></div>
<p>OGR functions can be also be used to inspect a vector data
source.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># test for existence of a vector data source with at least read access</span></span>
<span><span class="fu"><a href="../reference/ogr_manage.html">ogr_ds_exists</a></span><span class="op">(</span><span class="va">zf_gpkg</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co"># note that update of an existing zipped .gpkg file is not supported</span></span>
<span><span class="fu"><a href="../reference/ogr_manage.html">ogr_ds_exists</a></span><span class="op">(</span><span class="va">zf_gpkg</span>, with_update <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span></span>
<span><span class="co"># list the vector layers</span></span>
<span><span class="fu"><a href="../reference/ogr_manage.html">ogr_ds_layer_names</a></span><span class="op">(</span><span class="va">zf_gpkg</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ynp_bnd"            "roads"              "points_of_interest"</span></span></code></pre></div>
<p><code><a href="../reference/ogrinfo.html">ogrinfo()</a></code> requires GDAL &gt;= 3.7. It accepts an
optional character vector containing any of the arguments supported by
the <a href="https://gdal.org/en/stable/programs/ogrinfo.html" class="external-link"><code>ogrinfo</code></a>
command-line utility included with GDAL.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># list the layers in a data source</span></span>
<span><span class="fu"><a href="../reference/ogrinfo.html">ogrinfo</a></span><span class="op">(</span><span class="va">zf_gpkg</span><span class="op">)</span></span>
<span><span class="co">#&gt; INFO: Open of `/vsizip//home/runner/work/_temp/Library/gdalraster/extdata/ynp_features.zip/ynp_features.gpkg'</span></span>
<span><span class="co">#&gt;       using driver `GPKG' successful.</span></span>
<span><span class="co">#&gt; 1: ynp_bnd (Polygon)</span></span>
<span><span class="co">#&gt; 2: roads (Line String)</span></span>
<span><span class="co">#&gt; 3: points_of_interest (Point)</span></span>
<span></span>
<span><span class="co"># detailed information about a specific layer</span></span>
<span><span class="fu"><a href="../reference/ogrinfo.html">ogrinfo</a></span><span class="op">(</span><span class="va">zf_gpkg</span>, <span class="st">"ynp_bnd"</span>, cl_arg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-geom=SUMMARY"</span>, <span class="st">"-wkt_format"</span>, <span class="st">"WKT2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; INFO: Open of `/vsizip//home/runner/work/_temp/Library/gdalraster/extdata/ynp_features.zip/ynp_features.gpkg'</span></span>
<span><span class="co">#&gt;       using driver `GPKG' successful.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Layer name: ynp_bnd</span></span>
<span><span class="co">#&gt; Metadata:</span></span>
<span><span class="co">#&gt;   DBF_DATE_LAST_UPDATE=1998-01-25</span></span>
<span><span class="co">#&gt;   DESCRIPTION=Yellowstone National Park boundary, 1:2,000,000</span></span>
<span><span class="co">#&gt; Geometry: Polygon</span></span>
<span><span class="co">#&gt; Feature Count: 1</span></span>
<span><span class="co">#&gt; Extent: (-111.154305, 44.132448) - (-109.833929, 45.107849)</span></span>
<span><span class="co">#&gt; Layer SRS WKT:</span></span>
<span><span class="co">#&gt; GEOGCRS["NAD83",</span></span>
<span><span class="co">#&gt;     DATUM["North American Datum 1983",</span></span>
<span><span class="co">#&gt;         ELLIPSOID["GRS 1980",6378137,298.257222101,</span></span>
<span><span class="co">#&gt;             LENGTHUNIT["metre",1]]],</span></span>
<span><span class="co">#&gt;     PRIMEM["Greenwich",0,</span></span>
<span><span class="co">#&gt;         ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span><span class="co">#&gt;     CS[ellipsoidal,2],</span></span>
<span><span class="co">#&gt;         AXIS["geodetic latitude (Lat)",north,</span></span>
<span><span class="co">#&gt;             ORDER[1],</span></span>
<span><span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span><span class="co">#&gt;         AXIS["geodetic longitude (Lon)",east,</span></span>
<span><span class="co">#&gt;             ORDER[2],</span></span>
<span><span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span><span class="co">#&gt;     USAGE[</span></span>
<span><span class="co">#&gt;         SCOPE["Geodesy."],</span></span>
<span><span class="co">#&gt;         AREA["North America - onshore and offshore: Canada - Alberta; British Columbia; Manitoba; New Brunswick; Newfoundland and Labrador; Northwest Territories; Nova Scotia; Nunavut; Ontario; Prince Edward Island; Quebec; Saskatchewan; Yukon. Puerto Rico. United States (USA) - Alabama; Alaska; Arizona; Arkansas; California; Colorado; Connecticut; Delaware; Florida; Georgia; Hawaii; Idaho; Illinois; Indiana; Iowa; Kansas; Kentucky; Louisiana; Maine; Maryland; Massachusetts; Michigan; Minnesota; Mississippi; Missouri; Montana; Nebraska; Nevada; New Hampshire; New Jersey; New Mexico; New York; North Carolina; North Dakota; Ohio; Oklahoma; Oregon; Pennsylvania; Rhode Island; South Carolina; South Dakota; Tennessee; Texas; Utah; Vermont; Virginia; Washington; West Virginia; Wisconsin; Wyoming. US Virgin Islands. British Virgin Islands."],</span></span>
<span><span class="co">#&gt;         BBOX[14.92,167.65,86.45,-40.73]],</span></span>
<span><span class="co">#&gt;     ID["EPSG",4269]]</span></span>
<span><span class="co">#&gt; Data axis to CRS axis mapping: 2,1</span></span>
<span><span class="co">#&gt; FID Column = fid</span></span>
<span><span class="co">#&gt; Geometry Column = geom</span></span>
<span><span class="co">#&gt; admn_type: String (28.0)</span></span>
<span><span class="co">#&gt; state_fips: Integer (0.0)</span></span>
<span><span class="co">#&gt; state_name: String (20.0)</span></span>
<span><span class="co">#&gt; sub_region: String (7.0)</span></span>
<span><span class="co">#&gt; OGRFeature(ynp_bnd):1</span></span>
<span><span class="co">#&gt;   admn_type (String) = Park, monument, etc.</span></span>
<span><span class="co">#&gt;   state_fips (Integer) = 56</span></span>
<span><span class="co">#&gt;   state_name (String) = Wyoming</span></span>
<span><span class="co">#&gt;   sub_region (String) = Mtn</span></span>
<span><span class="co">#&gt;   POLYGON : 296 points</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="manage-data-sources-and-schemas">Manage data sources and schemas<a class="anchor" aria-label="anchor" href="#manage-data-sources-and-schemas"></a>
</h3>
<p>Here we copy the .gpkg file from the zip archive to an in-memory file
that is writable, and make several modifications. The <a href="https://gdal.org/en/stable/user/virtual_file_systems.html#vsimem-in-memory-files" class="external-link">/vsimem/</a>
file handler allows a block of memory to be treated as files. It is
useful for temporary storage and is generally fast to access. The code
below also demonstrates testing certain defined capabilities of the
dataset or layer before attempting to perform modifications. This will
not be needed in all cases but might be used in code that is required to
handle input datasets in a general way.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># copy ynp_features.gpkg from the zip file to an in-memory file</span></span>
<span><span class="va">mem_gpkg</span> <span class="op">&lt;-</span> <span class="st">"/vsimem/tmp/ynp_features.gpkg"</span></span>
<span><span class="fu"><a href="../reference/ogr2ogr.html">ogr2ogr</a></span><span class="op">(</span><span class="va">zf_gpkg</span>, <span class="va">mem_gpkg</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/vsi_read_dir.html">vsi_read_dir</a></span><span class="op">(</span><span class="st">"/vsimem/tmp"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ynp_features.gpkg"</span></span>
<span></span>
<span><span class="co"># confirm it's writable</span></span>
<span><span class="fu"><a href="../reference/ogr_manage.html">ogr_ds_exists</a></span><span class="op">(</span><span class="va">mem_gpkg</span>, with_update <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="va">rd_layer</span> <span class="op">&lt;-</span> <span class="st">"roads"</span></span>
<span></span>
<span><span class="co"># rename a layer (requires GDAL &gt;= 3.5)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/gdal_version.html">gdal_version_num</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu"><a href="../reference/gdal_compute_version.html">gdal_compute_version</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"ogr_layer_rename() requires GDAL &gt;= 3.5"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/ogr_manage.html">ogr_layer_test_cap</a></span><span class="op">(</span><span class="va">mem_gpkg</span>, <span class="va">rd_layer</span><span class="op">)</span><span class="op">$</span><span class="va">Rename</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/ogr_manage.html">ogr_layer_rename</a></span><span class="op">(</span><span class="va">mem_gpkg</span>, <span class="va">rd_layer</span>, <span class="st">"roads2"</span><span class="op">)</span></span>
<span>  <span class="va">rd_layer</span> <span class="op">&lt;-</span> <span class="st">"roads2"</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"layer does not have 'Rename' capability"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ogr_manage.html">ogr_ds_layer_names</a></span><span class="op">(</span><span class="va">mem_gpkg</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ynp_bnd"            "roads2"             "points_of_interest"</span></span>
<span></span>
<span><span class="co"># delete a layer</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/ogr_manage.html">ogr_ds_test_cap</a></span><span class="op">(</span><span class="va">mem_gpkg</span><span class="op">)</span><span class="op">$</span><span class="va">DeleteLayer</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/ogr_manage.html">ogr_layer_delete</a></span><span class="op">(</span><span class="va">mem_gpkg</span>, <span class="va">rd_layer</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"dataset does not have 'DeleteLayer' capability"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ogr_manage.html">ogr_ds_layer_names</a></span><span class="op">(</span><span class="va">mem_gpkg</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ynp_bnd"            "points_of_interest"</span></span>
<span></span>
<span><span class="co"># manage fields on a layer</span></span>
<span><span class="fu"><a href="../reference/ogr_manage.html">ogr_layer_field_names</a></span><span class="op">(</span><span class="va">mem_gpkg</span>, <span class="st">"points_of_interest"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "poiname"    "poitype"    "createdate" "editdate"   "geom"</span></span>
<span></span>
<span><span class="co"># delete a field</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/ogr_manage.html">ogr_layer_test_cap</a></span><span class="op">(</span><span class="va">mem_gpkg</span>, <span class="st">"points_of_interest"</span><span class="op">)</span><span class="op">$</span><span class="va">DeleteField</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/ogr_manage.html">ogr_field_delete</a></span><span class="op">(</span><span class="va">mem_gpkg</span>, <span class="st">"points_of_interest"</span>, <span class="st">"createdate"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"layer does not have 'DeleteField' capability"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># rename fields</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/ogr_manage.html">ogr_layer_test_cap</a></span><span class="op">(</span><span class="va">mem_gpkg</span>, <span class="st">"points_of_interest"</span><span class="op">)</span><span class="op">$</span><span class="va">AlterFieldDefn</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/ogr_manage.html">ogr_field_rename</a></span><span class="op">(</span><span class="va">mem_gpkg</span>, <span class="st">"points_of_interest"</span>, <span class="st">"poiname"</span>, <span class="st">"poi_name"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/ogr_manage.html">ogr_field_rename</a></span><span class="op">(</span><span class="va">mem_gpkg</span>, <span class="st">"points_of_interest"</span>, <span class="st">"poitype"</span>, <span class="st">"poi_type"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"layer does not have 'AlterFieldDefn' capability"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>As a simple example for illustration, we populate a new field to flag
geothermal features.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a new field</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/ogr_manage.html">ogr_layer_test_cap</a></span><span class="op">(</span><span class="va">mem_gpkg</span>, <span class="st">"points_of_interest"</span><span class="op">)</span><span class="op">$</span><span class="va">CreateField</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/ogr_manage.html">ogr_field_create</a></span><span class="op">(</span><span class="va">mem_gpkg</span>, <span class="st">"points_of_interest"</span>,</span>
<span>                   fld_name <span class="op">=</span> <span class="st">"is_geothermal"</span>,</span>
<span>                   fld_type <span class="op">=</span> <span class="st">"OFTInteger"</span>,</span>
<span>                   fld_subtype <span class="op">=</span> <span class="st">"OFSTBoolean"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"layer does not have 'CreateField' capability"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># edit data with SQL</span></span>
<span><span class="va">sql</span> <span class="op">&lt;-</span> <span class="st">"UPDATE points_of_interest SET is_geothermal = </span></span>
<span><span class="st">          CASE</span></span>
<span><span class="st">            WHEN poi_type IN ('Basin', 'Geyser') THEN TRUE</span></span>
<span><span class="st">            ELSE FALSE</span></span>
<span><span class="st">          END"</span></span>
<span><span class="fu"><a href="../reference/ogr_manage.html">ogr_execute_sql</a></span><span class="op">(</span><span class="va">mem_gpkg</span>, <span class="va">sql</span><span class="op">)</span></span>
<span><span class="co">#&gt; info: open dataset successful on DSN:</span></span>
<span><span class="co">#&gt;   '/vsimem/tmp/ynp_features.gpkg'</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ogr_manage.html">ogr_layer_field_names</a></span><span class="op">(</span><span class="va">mem_gpkg</span>, <span class="st">"points_of_interest"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "poi_name"      "poi_type"      "editdate"      "is_geothermal"</span></span>
<span><span class="co">#&gt; [5] "geom"</span></span></code></pre></div>
<p>To read back from the modified data source we need to instantiate
objects of class <code>GDALVector</code>. More detail on working with
<code>GDALVector</code> objects is given in the examples further below
for data retrieval. For now, note that the function
<code><a href="../reference/ogr_manage.html">ogr_execute_sql()</a></code> returns an object of class
<code>GDALVector</code> for SQL statements that return a result set.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read and display the geothermal features</span></span>
<span><span class="va">sql</span> <span class="op">&lt;-</span> <span class="st">"SELECT poi_name, geom</span></span>
<span><span class="st">          FROM points_of_interest</span></span>
<span><span class="st">            WHERE is_geothermal = TRUE"</span></span>
<span><span class="op">(</span><span class="va">lyr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ogr_manage.html">ogr_execute_sql</a></span><span class="op">(</span><span class="va">mem_gpkg</span>, <span class="va">sql</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; C++ object of class GDALVector</span></span>
<span><span class="co">#&gt;  Driver : GeoPackage (GPKG)</span></span>
<span><span class="co">#&gt;  DSN    : /vsimem/tmp/ynp_features.gpkg</span></span>
<span><span class="co">#&gt;  Layer  : SELECT poi_name, geom</span></span>
<span><span class="co">#&gt;           FROM points_of_interest</span></span>
<span><span class="co">#&gt;             WHERE is_geothermal = TRUE</span></span>
<span><span class="co">#&gt;  CRS    : NAD83 (EPSG:4269)</span></span>
<span><span class="co">#&gt;  Geom   : POINT</span></span>
<span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 187</span></span>
<span></span>
<span><span class="co"># retrieve all features in the result set (cf. DBI::dbFetch())</span></span>
<span><span class="va">feat_set</span> <span class="op">&lt;-</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">fetch</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">feat_set</span><span class="op">)</span></span>
<span><span class="co">#&gt; OGR feature set</span></span>
<span><span class="co">#&gt;   FID              poi_name                           geom</span></span>
<span><span class="co">#&gt; 1   0              Big Cone WKB POINT: raw 01 01 00 00 ...</span></span>
<span><span class="co">#&gt; 2   1         Surprise Pool WKB POINT: raw 01 01 00 00 ...</span></span>
<span><span class="co">#&gt; 3   2        The Mudkettles WKB POINT: raw 01 01 00 00 ...</span></span>
<span><span class="co">#&gt; 4   3      Churning Caldron WKB POINT: raw 01 01 00 00 ...</span></span>
<span><span class="co">#&gt; 5   4         Mortar Geyser WKB POINT: raw 01 01 00 00 ...</span></span>
<span><span class="co">#&gt; 6   5 Black Dragons Caldron WKB POINT: raw 01 01 00 00 ...</span></span>
<span></span>
<span><span class="co"># plot the park boundary</span></span>
<span><span class="co"># the layer contains a single polygon feature which is piped directly to plot()</span></span>
<span><span class="va"><a href="../reference/GDALVector-class.html">GDALVector</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">mem_gpkg</span>, <span class="st">"ynp_bnd"</span><span class="op">)</span><span class="op">$</span><span class="fu">getNextFeature</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"wheat"</span>, xlab <span class="op">=</span> <span class="st">"longitude"</span>, ylab <span class="op">=</span> <span class="st">"latitude"</span>,</span>
<span>       main <span class="op">=</span> <span class="st">"YNP Geothermal Features"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add point locations of the geothermal features</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">feat_set</span>, pch <span class="op">=</span> <span class="fl">19</span>, col <span class="op">=</span> <span class="st">"steelblue1"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="vector-api-overview_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>For clean up, the <code>$close()</code> method should be called on
the layer object opened with <code><a href="../reference/ogr_manage.html">ogr_execute_sql()</a></code>. We also
delete the temporary in-memory file.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lyr</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># delete a data source</span></span>
<span><span class="fu"><a href="../reference/vsi_unlink.html">vsi_unlink</a></span><span class="op">(</span><span class="va">mem_gpkg</span><span class="op">)</span>  <span class="co"># delete a single file</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co"># or, deleteDataset(mem_gpkg)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="traditional-row-based-data-retrieval">Traditional row-based data retrieval<a class="anchor" aria-label="anchor" href="#traditional-row-based-data-retrieval"></a>
</h3>
<p>These examples will use the original sample dataset for YNP features.
The DSN is formed with the /viszip/ prefix, and full path to the file
ynp_features.gpkg contained in the zip archive. An object of class
<code>GDALVector</code> is generated with a call to <code>new()</code>.
From the examples above, we know that the GeoPackage contains three
vector layers, so we also pass a layer name argument to the class
constructor.</p>
<p>Note that if the layer argument is omitted, the constructor will
attempt to open the first layer by index. The abbreviated form of the
constructor would generally be used for convenience only with
single-layer file formats (e.g., ESRI Shapefile, FlatGeoBuf), or with a
GeoPackage file known to contain only a single layer.</p>
<p>A SQL SELECT statement that returns a result set can also be used for
the <code>layer</code> argument in the constructor.</p>
<p>Here we instantiate a <code>GDALVector</code> object for the park
boundary layer and retrieve information about it.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/ynp_features.zip"</span>, package <span class="op">=</span> <span class="st">"gdalraster"</span><span class="op">)</span></span>
<span><span class="va">ynp_dsn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"/vsizip"</span>, <span class="va">f</span>, <span class="st">"ynp_features.gpkg"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the park boundary layer containing a single feature</span></span>
<span><span class="op">(</span><span class="va">bnd</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALVector</span>, <span class="va">ynp_dsn</span>, <span class="st">"ynp_bnd"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; C++ object of class GDALVector</span></span>
<span><span class="co">#&gt;  Driver : GeoPackage (GPKG)</span></span>
<span><span class="co">#&gt;  DSN    : /vsizip//home/runner/work/_temp/Library/gdalraster/extdata/ynp_features.zip/ynp_features.gpkg</span></span>
<span><span class="co">#&gt;  Layer  : ynp_bnd</span></span>
<span><span class="co">#&gt;  CRS    : NAD83 (EPSG:4269)</span></span>
<span><span class="co">#&gt;  Geom   : POLYGON</span></span>
<span></span>
<span><span class="va">bnd</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="co"># spatial reference definition as WKT string</span></span>
<span><span class="va">bnd</span><span class="op">$</span><span class="fu">getSpatialRef</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "GEOGCS[\"NAD83\",DATUM[\"North_American_Datum_1983\",SPHEROID[\"GRS 1980\",6378137,298.257222101,AUTHORITY[\"EPSG\",\"7019\"]],AUTHORITY[\"EPSG\",\"6269\"]],PRIMEM[\"Greenwich\",0,AUTHORITY[\"EPSG\",\"8901\"]],UNIT[\"degree\",0.0174532925199433,AUTHORITY[\"EPSG\",\"9122\"]],AXIS[\"Latitude\",NORTH],AXIS[\"Longitude\",EAST],AUTHORITY[\"EPSG\",\"4269\"]]"</span></span>
<span></span>
<span><span class="co"># xmin, ymin, xmax, ymax</span></span>
<span><span class="va">bnd</span><span class="op">$</span><span class="fu">bbox</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -111.15430   44.13245 -109.83393   45.10785</span></span>
<span></span>
<span><span class="co"># structure of the layer definition (a.k.a. feature class definition)</span></span>
<span><span class="va">bnd</span><span class="op">$</span><span class="fu">getLayerDefn</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ admn_type :List of 9</span></span>
<span><span class="co">#&gt;   ..$ type       : chr "OFTString"</span></span>
<span><span class="co">#&gt;   ..$ subtype    : chr "OFSTNone"</span></span>
<span><span class="co">#&gt;   ..$ width      : int 28</span></span>
<span><span class="co">#&gt;   ..$ precision  : int 0</span></span>
<span><span class="co">#&gt;   ..$ is_nullable: logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ is_unique  : logi FALSE</span></span>
<span><span class="co">#&gt;   ..$ default    : chr ""</span></span>
<span><span class="co">#&gt;   ..$ domain     : chr ""</span></span>
<span><span class="co">#&gt;   ..$ is_geom    : logi FALSE</span></span>
<span><span class="co">#&gt;  $ state_fips:List of 9</span></span>
<span><span class="co">#&gt;   ..$ type       : chr "OFTInteger"</span></span>
<span><span class="co">#&gt;   ..$ subtype    : chr "OFSTNone"</span></span>
<span><span class="co">#&gt;   ..$ width      : int 0</span></span>
<span><span class="co">#&gt;   ..$ precision  : int 0</span></span>
<span><span class="co">#&gt;   ..$ is_nullable: logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ is_unique  : logi FALSE</span></span>
<span><span class="co">#&gt;   ..$ default    : chr ""</span></span>
<span><span class="co">#&gt;   ..$ domain     : chr ""</span></span>
<span><span class="co">#&gt;   ..$ is_geom    : logi FALSE</span></span>
<span><span class="co">#&gt;  $ state_name:List of 9</span></span>
<span><span class="co">#&gt;   ..$ type       : chr "OFTString"</span></span>
<span><span class="co">#&gt;   ..$ subtype    : chr "OFSTNone"</span></span>
<span><span class="co">#&gt;   ..$ width      : int 20</span></span>
<span><span class="co">#&gt;   ..$ precision  : int 0</span></span>
<span><span class="co">#&gt;   ..$ is_nullable: logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ is_unique  : logi FALSE</span></span>
<span><span class="co">#&gt;   ..$ default    : chr ""</span></span>
<span><span class="co">#&gt;   ..$ domain     : chr ""</span></span>
<span><span class="co">#&gt;   ..$ is_geom    : logi FALSE</span></span>
<span><span class="co">#&gt;  $ sub_region:List of 9</span></span>
<span><span class="co">#&gt;   ..$ type       : chr "OFTString"</span></span>
<span><span class="co">#&gt;   ..$ subtype    : chr "OFSTNone"</span></span>
<span><span class="co">#&gt;   ..$ width      : int 7</span></span>
<span><span class="co">#&gt;   ..$ precision  : int 0</span></span>
<span><span class="co">#&gt;   ..$ is_nullable: logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ is_unique  : logi FALSE</span></span>
<span><span class="co">#&gt;   ..$ default    : chr ""</span></span>
<span><span class="co">#&gt;   ..$ domain     : chr ""</span></span>
<span><span class="co">#&gt;   ..$ is_geom    : logi FALSE</span></span>
<span><span class="co">#&gt;  $ geom      :List of 4</span></span>
<span><span class="co">#&gt;   ..$ type       : chr "POLYGON"</span></span>
<span><span class="co">#&gt;   ..$ srs        : chr "GEOGCS[\"NAD83\",DATUM[\"North_American_Datum_1983\",SPHEROID[\"GRS 1980\",6378137,298.257222101,AUTHORITY[\"EP"| __truncated__</span></span>
<span><span class="co">#&gt;   ..$ is_nullable: logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ is_geom    : logi TRUE</span></span></code></pre></div>
<p>Traditional row-level access to feature data with OGR is
cursor-based, reading one feature at a time. When starting with a new
layer object, the cursor is positioned at the beginning and we can
iterate through features with calls to <code>$getNextFeature()</code>.
This method returns an individual feature as a named list of fields and
their values, and moves the cursor forward one row. It will return
<code>NULL</code> when no features are left.</p>
<p>The park boundary layer contains a single polygon feature. The list
object returned for an individual feature carries the
<code>"OGRFeature"</code> class attribute.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bnd_feat</span> <span class="op">&lt;-</span> <span class="va">bnd</span><span class="op">$</span><span class="fu">getNextFeature</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">bnd_feat</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 6</span></span>
<span><span class="co">#&gt;  $ FID       :integer64 1 </span></span>
<span><span class="co">#&gt;  $ admn_type : chr "Park, monument, etc."</span></span>
<span><span class="co">#&gt;  $ state_fips: int 56</span></span>
<span><span class="co">#&gt;  $ state_name: chr "Wyoming"</span></span>
<span><span class="co">#&gt;  $ sub_region: chr "Mtn"</span></span>
<span><span class="co">#&gt;  $ geom      : raw [1:4749] 01 03 00 00 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "gis")=List of 5</span></span>
<span><span class="co">#&gt;   ..$ type         : chr "vector"</span></span>
<span><span class="co">#&gt;   ..$ geom_column  : chr "geom"</span></span>
<span><span class="co">#&gt;   ..$ geom_col_type: chr "POLYGON"</span></span>
<span><span class="co">#&gt;   ..$ geom_col_srs : chr "GEOGCS[\"NAD83\",DATUM[\"North_American_Datum_1983\",SPHEROID[\"GRS 1980\",6378137,298.257222101,AUTHORITY[\"EP"| __truncated__</span></span>
<span><span class="co">#&gt;   ..$ geom_format  : chr "WKB"</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr [1:2] "OGRFeature" "list"</span></span>
<span></span>
<span><span class="co"># no more features</span></span>
<span><span class="va">bnd</span><span class="op">$</span><span class="fu">getNextFeature</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span></span>
<span><span class="va">bnd</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The cursor can be reset to the beginning of the layer at any time
with a call to <code>$resetReading()</code>.</p>
</div>
<div class="section level3">
<h3 id="fetch-all-features-or-progressively-in-batches">Fetch all features or progressively in batches<a class="anchor" aria-label="anchor" href="#fetch-all-features-or-progressively-in-batches"></a>
</h3>
<p>Class <code>GDALVector</code> also provides the <code>$fetch()</code>
method to retrieve the next <code>n</code> features from the layer and
return them as a data frame (analog of <code>DBI::dbFetch()</code>).
<code>$fetch()</code> can be used to get the entire feature set for a
layer, one batch of features at a time, or the remaining features from
the current cursor position. Fetching zero features is also possible to
retrieve the structure of the layer as a 0-row data frame with fully
typed columns. As with <code>$getNextFeature()</code>, only forward
paging is supported.</p>
<p>Passing <code>n = -1</code> or <code>n = Inf</code> will retrieve all
features from the beginning (with an automatic call to
<code>$resetReading()</code>). Passing <code>n = NA</code> is supported
and will retrieve the remaining features from the current cursor
position. Otherwise, features can be fetched progressively by passing a
whole number (<code>integer</code> or <code>numeric</code>) as the
<code>n</code> argument. If more features than available are requested,
the result is returned in full without warning. If fewer features than
requested are returned, further fetches will return a data frame with
zero rows.</p>
<p>Note that it is possible to set an attribute filter and/or spatial
filter prior to retrieving data to restrict the returned feature set. It
is also possible to set specific fields as ignored (or to specify the
list of desired fields). This includes potentially omitting the geometry
column when access only to feature attributes is needed. Limiting the
number of fields returned may save some processing time and/or
bandwidth.</p>
<p>The <code>layer</code> argument in the constructor for
<code>GDALVector</code> can also be given as a SQL SELECT statement.
Here we read from the roads layer selecting only the publicly accessible
roads. We call <code>$fetch()</code> with <code>n = -1</code> to read
from the beginning and retrieve all available features. The data frame
returned by <code>$fetch()</code> carries the
<code>"OGRFeatureSet"</code> class attribute providing S3 methods for
<code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> and <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># SQL layer for public roads</span></span>
<span><span class="va">sql</span> <span class="op">&lt;-</span> <span class="st">"SELECT rdname, opentopubl, geom FROM roads WHERE opentopubl = 'Yes'"</span></span>
<span><span class="op">(</span><span class="va">roads</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALVector</span>, <span class="va">ynp_dsn</span>, <span class="va">sql</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; C++ object of class GDALVector</span></span>
<span><span class="co">#&gt;  Driver : GeoPackage (GPKG)</span></span>
<span><span class="co">#&gt;  DSN    : /vsizip//home/runner/work/_temp/Library/gdalraster/extdata/ynp_features.zip/ynp_features.gpkg</span></span>
<span><span class="co">#&gt;  Layer  : SELECT rdname, opentopubl, geom FROM roads WHERE opentopubl = 'Yes'</span></span>
<span><span class="co">#&gt;  CRS    : NAD83 (EPSG:4269)</span></span>
<span><span class="co">#&gt;  Geom   : LINESTRING</span></span>
<span></span>
<span><span class="va">roads</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1475</span></span>
<span></span>
<span><span class="va">roads</span><span class="op">$</span><span class="fu">getFieldNames</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "rdname"     "opentopubl" "geom"</span></span>
<span></span>
<span><span class="va">roads_featset</span> <span class="op">&lt;-</span> <span class="va">roads</span><span class="op">$</span><span class="fu">fetch</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">roads_featset</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1475</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">roads_featset</span><span class="op">)</span></span>
<span><span class="co">#&gt; OGR feature set</span></span>
<span><span class="co">#&gt;   FID               rdname opentopubl                                geom</span></span>
<span><span class="co">#&gt; 1   0          Park Street        Yes WKB LINESTRING: raw 01 02 00 00 ...</span></span>
<span><span class="co">#&gt; 2   1   North Entrance Rd.        Yes WKB LINESTRING: raw 01 02 00 00 ...</span></span>
<span><span class="co">#&gt; 3   2 Robert Reamer Avenue        Yes WKB LINESTRING: raw 01 02 00 00 ...</span></span>
<span><span class="co">#&gt; 4   3          Park Street        Yes WKB LINESTRING: raw 01 02 00 00 ...</span></span>
<span><span class="co">#&gt; 5   4                 &lt;NA&gt;        Yes WKB LINESTRING: raw 01 02 00 00 ...</span></span>
<span><span class="co">#&gt; 6   5 Robert Reamer Avenue        Yes WKB LINESTRING: raw 01 02 00 00 ...</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bnd_feat</span>, col <span class="op">=</span> <span class="st">"wheat"</span>, xlab <span class="op">=</span> <span class="st">"longitude"</span>, ylab <span class="op">=</span> <span class="st">"latitude"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"YNP Public Roads"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">roads_featset</span>, col <span class="op">=</span> <span class="st">"slategray"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="vector-api-overview_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">roads</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Fetching in batches may be advantageous when dealing with large
datasets, especially when reading over a network. Also, note that
<code>$getFeatureCount()</code> is called internally when fetching the
full feature set but not for a batch of <code>n</code> features. Some
vector drivers will actually scan the entire layer once to count
features. The <code>FastFeatureCount</code> element in the list returned
by the <code>$testCapability()</code> method can be checked if this
might be a concern.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poi</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALVector</span>, <span class="va">ynp_dsn</span>, <span class="st">"points_of_interest"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">poi</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1399</span></span>
<span></span>
<span><span class="co"># read progressively in batches</span></span>
<span><span class="va">batch_size</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">batch</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">while</span> <span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">poi_featset</span> <span class="op">&lt;-</span> <span class="va">poi</span><span class="op">$</span><span class="fu">fetch</span><span class="op">(</span><span class="va">batch_size</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">poi_featset</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="kw">break</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"batch"</span>, <span class="va">batch</span> <span class="op">&lt;-</span> <span class="va">batch</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">":"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">poi_featset</span><span class="op">)</span>, <span class="st">"features\n"</span><span class="op">)</span></span>
<span>    <span class="co"># process batch</span></span>
<span>    <span class="co"># ...</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; batch 1 : 500 features</span></span>
<span><span class="co">#&gt; batch 2 : 500 features</span></span>
<span><span class="co">#&gt; batch 3 : 399 features</span></span>
<span></span>
<span><span class="va">poi</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="read-using-arrowarraystream">Read using ArrowArrayStream<a class="anchor" aria-label="anchor" href="#read-using-arrowarraystream"></a>
</h3>
<p>It is also possible to retrieve features in a column-oriented memory
layout using the Arrow C Stream interface in OGR (requires GDAL &gt;=
3.6). Performance advantages can be substantial with vector format
drivers that provide specialized implementations (e.g., Parquet,
FlatGeoBuf, GeoPackage). Drivers with specialized implementations
advertise the <code>FastGetArrowStream</code> layer capability.</p>
<p>The <code>$getArrowStream()</code> method of class
<code>GDALVector</code> exposes an ArrowArrayStream on the layer as a
<code>nanoarrow_array_stream</code> object. Note that the
<code>nanoarrow_array_stream</code> object has a
<code>$get_next()</code> method which allows accessing features in the
stream by batch (returning a <code>nanoarrow_array</code> object). The
default batch size for an OGR array stream is 65,536 features, but can
be configured on a per-object basis by assigning a value to the
<code>GDALVector</code> writeable field <code>$arrowStreamOptions</code>
(as a character vector of “NAME=VALUE” pairs).
<strong>nanoarrow</strong> provides S3 methods for
<code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> to import a <code>nanoarrow_array</code>
(one batch at a time), or the <code>nanoarrow_array_stream</code> itself
(pulling all batches in the stream).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Expose an ArrowArrayStream (requires GDAL &gt;= 3.6)</span></span>
<span></span>
<span><span class="co"># re-open the roads layer with the required argument for type of access</span></span>
<span><span class="va">roads</span><span class="op">$</span><span class="fu">open</span><span class="op">(</span>read_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">roads</span><span class="op">$</span><span class="fu">resetReading</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># does the layer have a specialized implementation</span></span>
<span><span class="va">roads</span><span class="op">$</span><span class="fu">testCapability</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">FastGetArrowStream</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># optionally set ArrowStream options as character vector of "NAME=VALUE", e.g.,</span></span>
<span><span class="va">roads</span><span class="op">$</span><span class="va">arrowStreamOptions</span> <span class="op">&lt;-</span> <span class="st">"INCLUDE_FID=NO"</span></span>
<span><span class="co"># the default batch size of 65,536 could also be configured with</span></span>
<span><span class="co"># MAX_FEATURES_IN_BATCH=num</span></span>
<span></span>
<span><span class="op">(</span><span class="va">stream</span> <span class="op">&lt;-</span> <span class="va">roads</span><span class="op">$</span><span class="fu">getArrowStream</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;nanoarrow_array_stream struct&lt;rdname: string, opentopubl: string, geom: ogc.wkb{binary}&gt;&gt;</span></span>
<span><span class="co">#&gt;  $ get_schema:function ()  </span></span>
<span><span class="co">#&gt;  $ get_next  :function (schema = x$get_schema(), validate = TRUE)  </span></span>
<span><span class="co">#&gt;  $ release   :function ()</span></span>
<span></span>
<span><span class="co"># get the array schema if needed</span></span>
<span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="va">stream</span><span class="op">$</span><span class="fu">get_schema</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># optionally read by batch, NULL is returned when no more features are available</span></span>
<span><span class="co"># batch &lt;- stream$get_next()</span></span>
<span><span class="co"># if (!is.null(batch))</span></span>
<span><span class="co">#   d_batch &lt;- as.data.frame(batch)</span></span>
<span></span>
<span><span class="co"># or, pull all the batches into a data frame</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">stream</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1475</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 rdname opentopubl</span></span>
<span><span class="co">#&gt; 1          Park Street        Yes</span></span>
<span><span class="co">#&gt; 2   North Entrance Rd.        Yes</span></span>
<span><span class="co">#&gt; 3 Robert Reamer Avenue        Yes</span></span>
<span><span class="co">#&gt; 4          Park Street        Yes</span></span>
<span><span class="co">#&gt; 5                 &lt;NA&gt;        Yes</span></span>
<span><span class="co">#&gt; 6 Robert Reamer Avenue        Yes</span></span>
<span><span class="co">#&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 geom</span></span>
<span><span class="co">#&gt; 1 01, 02, 00, 00, 00, 10, 00, 00, 00, 4c, 4c, 4c, 54, 45, ad, 5b, c0, 60, c7, eb, d3, c7, 83, 46, 40, 44, 6e, 01, 2c, 48, ad, 5b, c0, d8, f7, 4d, 73, c8, 83, 46, 40, 88, 98, a0, f3, 4b, ad, 5b, c0, 88, e3, 19, d1, c9, 83, 46, 40, 90, 37, 4e, 77, 4f, ad, 5b, c0, 60, 2b, 0d, 0e, cc, 83, 46, 40, 28, 7b, 10, d7, 51, ad, 5b, c0, 68, 5d, c5, aa, cd, 83, 46, 40, b8, 88, 48, 7d, 54, ad, 5b, c0, 28, 20, 48, a6, cf, 83, 46, 40, 74, 7c, 79, d6, 55, ad, 5b, c0, 90, 8d, 60, 80, d0, 83, 46, 40, c8, 5d, 93, 54, 57, ad, 5b, c0, d0, ec, 7f, c2, d1, 83, 46, 40, a8, df, ef, 91, 59, ad, 5b, c0, 40, 9d, 3a, e2, d2, 83, 46, 40, c4, 39, e4, 78, 5b, ad, 5b, c0, b8, a4, 79, 53, d3, 83, 46, 40, d4, ca, 49, fd, 5c, ad, 5b, c0, a0, d8, 74, eb, d2, 83, 46, 40, 00, d1, 91, 31, 5e, ad, 5b, c0, d0, fc, 20, ee, d1, 83, 46, 40, 30, 26, e6, 21, 5f, ad, 5b, c0, 90, 8d, 60, 80, d0, 83, 46, 40, 4c, 53, fe, c7, 5f, ad, 5b, c0, 90, 19, 03, b3, ce, 83, 46, 40, 44, 04, f2, 0b, 60, ad, 5b, c0, b8, b8, 8d, 73, cc, 83, 46, 40, 08, 03, 4a, ce, 5f, ad, 5b, c0, 88, 6d, 50, 3d, ca, 83, 46, 40</span></span>
<span><span class="co">#&gt; 2                                                                                                                                                                                                                                                                                                                                 01, 02, 00, 00, 00, 0b, 00, 00, 00, 08, 03, 4a, ce, 5f, ad, 5b, c0, 88, 6d, 50, 3d, ca, 83, 46, 40, c8, 47, 06, 44, 5e, ad, 5b, c0, 88, 3b, 72, 6c, c9, 83, 46, 40, 88, a3, cb, cb, 5c, ad, 5b, c0, 48, cc, b1, fe, c7, 83, 46, 40, 64, a8, aa, 00, 5a, ad, 5b, c0, e8, fd, fa, 19, c5, 83, 46, 40, 1c, 41, 13, 29, 59, ad, 5b, c0, f8, 21, 7e, 51, c4, 83, 46, 40, 28, 55, fb, a4, 55, ad, 5b, c0, 70, d0, 4d, be, c0, 83, 46, 40, 20, 8d, 3d, 8d, 51, ad, 5b, c0, 90, b8, d8, 6b, bc, 83, 46, 40, 24, e7, 89, bc, 4c, ad, 5b, c0, 88, da, 47, 25, b7, 83, 46, 40, b4, 96, d8, 9b, 49, ad, 5b, c0, 00, ee, 1c, b1, b3, 83, 46, 40, f8, b9, b0, 54, 48, ad, 5b, c0, 68, 62, 90, 47, b2, 83, 46, 40, 4c, 4c, 4c, 54, 45, ad, 5b, c0, 40, 37, 0a, 9c, ae, 83, 46, 40</span></span>
<span><span class="co">#&gt; 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 01, 02, 00, 00, 00, 03, 00, 00, 00, 18, ae, f9, e4, ed, ac, 5b, c0, d0, f7, 53, 50, 82, 83, 46, 40, b4, 78, f7, 4e, ec, ac, 5b, c0, d0, f8, 37, 35, 7e, 83, 46, 40, a0, ad, c9, a1, e5, ac, 5b, c0, 40, 59, 8c, 82, 6c, 83, 46, 40</span></span>
<span><span class="co">#&gt; 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 01, 02, 00, 00, 00, 06, 00, 00, 00, 4c, 4c, 4c, 54, 45, ad, 5b, c0, 60, c7, eb, d3, c7, 83, 46, 40, cc, 2a, 31, a4, 2a, ad, 5b, c0, e8, f1, 8a, 33, c8, 83, 46, 40, b0, 76, 7e, cb, 28, ad, 5b, c0, 48, b2, 0c, b3, c8, 83, 46, 40, 24, 7d, a0, 63, 27, ad, 5b, c0, d0, 33, bb, 30, ca, 83, 46, 40, 5c, af, 09, 99, 26, ad, 5b, c0, 20, b6, 14, 2d, cc, 83, 46, 40, 9c, 9c, 31, 64, 26, ad, 5b, c0, 50, 48, e6, 89, ce, 83, 46, 40</span></span>
<span><span class="co">#&gt; 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 01, 02, 00, 00, 00, 02, 00, 00, 00, 4c, 4c, 4c, 54, 45, ad, 5b, c0, 60, c7, eb, d3, c7, 83, 46, 40, 4c, 4c, 4c, 54, 45, ad, 5b, c0, 40, 37, 0a, 9c, ae, 83, 46, 40</span></span>
<span><span class="co">#&gt; 6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 01, 02, 00, 00, 00, 03, 00, 00, 00, a0, ad, c9, a1, e5, ac, 5b, c0, 40, 59, 8c, 82, 6c, 83, 46, 40, 3c, a6, d9, 2f, e4, ac, 5b, c0, c0, be, f6, 69, 68, 83, 46, 40, 80, 42, 17, b6, e1, ac, 5b, c0, 78, b7, fc, 3e, 5e, 83, 46, 40</span></span>
<span></span>
<span><span class="co"># release the stream when finished</span></span>
<span><span class="va">stream</span><span class="op">$</span><span class="fu">release</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 'geom' is a list column of WKB raw vectors which can be passed to the</span></span>
<span><span class="co"># Geometry API functions</span></span>
<span><span class="va">geom_utm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/g_transform.html">g_transform</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">geom</span>,</span>
<span>                        srs_from <span class="op">=</span> <span class="va">roads</span><span class="op">$</span><span class="fu">getSpatialRef</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                        srs_to <span class="op">=</span> <span class="st">"EPSG:26912"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add a column with road lengths in meters</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">rdlength</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/g_measures.html">g_length</a></span><span class="op">(</span><span class="va">geom_utm</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 rdname opentopubl</span></span>
<span><span class="co">#&gt; 1          Park Street        Yes</span></span>
<span><span class="co">#&gt; 2   North Entrance Rd.        Yes</span></span>
<span><span class="co">#&gt; 3 Robert Reamer Avenue        Yes</span></span>
<span><span class="co">#&gt; 4          Park Street        Yes</span></span>
<span><span class="co">#&gt; 5                 &lt;NA&gt;        Yes</span></span>
<span><span class="co">#&gt; 6 Robert Reamer Avenue        Yes</span></span>
<span><span class="co">#&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 geom</span></span>
<span><span class="co">#&gt; 1 01, 02, 00, 00, 00, 10, 00, 00, 00, 4c, 4c, 4c, 54, 45, ad, 5b, c0, 60, c7, eb, d3, c7, 83, 46, 40, 44, 6e, 01, 2c, 48, ad, 5b, c0, d8, f7, 4d, 73, c8, 83, 46, 40, 88, 98, a0, f3, 4b, ad, 5b, c0, 88, e3, 19, d1, c9, 83, 46, 40, 90, 37, 4e, 77, 4f, ad, 5b, c0, 60, 2b, 0d, 0e, cc, 83, 46, 40, 28, 7b, 10, d7, 51, ad, 5b, c0, 68, 5d, c5, aa, cd, 83, 46, 40, b8, 88, 48, 7d, 54, ad, 5b, c0, 28, 20, 48, a6, cf, 83, 46, 40, 74, 7c, 79, d6, 55, ad, 5b, c0, 90, 8d, 60, 80, d0, 83, 46, 40, c8, 5d, 93, 54, 57, ad, 5b, c0, d0, ec, 7f, c2, d1, 83, 46, 40, a8, df, ef, 91, 59, ad, 5b, c0, 40, 9d, 3a, e2, d2, 83, 46, 40, c4, 39, e4, 78, 5b, ad, 5b, c0, b8, a4, 79, 53, d3, 83, 46, 40, d4, ca, 49, fd, 5c, ad, 5b, c0, a0, d8, 74, eb, d2, 83, 46, 40, 00, d1, 91, 31, 5e, ad, 5b, c0, d0, fc, 20, ee, d1, 83, 46, 40, 30, 26, e6, 21, 5f, ad, 5b, c0, 90, 8d, 60, 80, d0, 83, 46, 40, 4c, 53, fe, c7, 5f, ad, 5b, c0, 90, 19, 03, b3, ce, 83, 46, 40, 44, 04, f2, 0b, 60, ad, 5b, c0, b8, b8, 8d, 73, cc, 83, 46, 40, 08, 03, 4a, ce, 5f, ad, 5b, c0, 88, 6d, 50, 3d, ca, 83, 46, 40</span></span>
<span><span class="co">#&gt; 2                                                                                                                                                                                                                                                                                                                                 01, 02, 00, 00, 00, 0b, 00, 00, 00, 08, 03, 4a, ce, 5f, ad, 5b, c0, 88, 6d, 50, 3d, ca, 83, 46, 40, c8, 47, 06, 44, 5e, ad, 5b, c0, 88, 3b, 72, 6c, c9, 83, 46, 40, 88, a3, cb, cb, 5c, ad, 5b, c0, 48, cc, b1, fe, c7, 83, 46, 40, 64, a8, aa, 00, 5a, ad, 5b, c0, e8, fd, fa, 19, c5, 83, 46, 40, 1c, 41, 13, 29, 59, ad, 5b, c0, f8, 21, 7e, 51, c4, 83, 46, 40, 28, 55, fb, a4, 55, ad, 5b, c0, 70, d0, 4d, be, c0, 83, 46, 40, 20, 8d, 3d, 8d, 51, ad, 5b, c0, 90, b8, d8, 6b, bc, 83, 46, 40, 24, e7, 89, bc, 4c, ad, 5b, c0, 88, da, 47, 25, b7, 83, 46, 40, b4, 96, d8, 9b, 49, ad, 5b, c0, 00, ee, 1c, b1, b3, 83, 46, 40, f8, b9, b0, 54, 48, ad, 5b, c0, 68, 62, 90, 47, b2, 83, 46, 40, 4c, 4c, 4c, 54, 45, ad, 5b, c0, 40, 37, 0a, 9c, ae, 83, 46, 40</span></span>
<span><span class="co">#&gt; 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 01, 02, 00, 00, 00, 03, 00, 00, 00, 18, ae, f9, e4, ed, ac, 5b, c0, d0, f7, 53, 50, 82, 83, 46, 40, b4, 78, f7, 4e, ec, ac, 5b, c0, d0, f8, 37, 35, 7e, 83, 46, 40, a0, ad, c9, a1, e5, ac, 5b, c0, 40, 59, 8c, 82, 6c, 83, 46, 40</span></span>
<span><span class="co">#&gt; 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 01, 02, 00, 00, 00, 06, 00, 00, 00, 4c, 4c, 4c, 54, 45, ad, 5b, c0, 60, c7, eb, d3, c7, 83, 46, 40, cc, 2a, 31, a4, 2a, ad, 5b, c0, e8, f1, 8a, 33, c8, 83, 46, 40, b0, 76, 7e, cb, 28, ad, 5b, c0, 48, b2, 0c, b3, c8, 83, 46, 40, 24, 7d, a0, 63, 27, ad, 5b, c0, d0, 33, bb, 30, ca, 83, 46, 40, 5c, af, 09, 99, 26, ad, 5b, c0, 20, b6, 14, 2d, cc, 83, 46, 40, 9c, 9c, 31, 64, 26, ad, 5b, c0, 50, 48, e6, 89, ce, 83, 46, 40</span></span>
<span><span class="co">#&gt; 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 01, 02, 00, 00, 00, 02, 00, 00, 00, 4c, 4c, 4c, 54, 45, ad, 5b, c0, 60, c7, eb, d3, c7, 83, 46, 40, 4c, 4c, 4c, 54, 45, ad, 5b, c0, 40, 37, 0a, 9c, ae, 83, 46, 40</span></span>
<span><span class="co">#&gt; 6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 01, 02, 00, 00, 00, 03, 00, 00, 00, a0, ad, c9, a1, e5, ac, 5b, c0, 40, 59, 8c, 82, 6c, 83, 46, 40, 3c, a6, d9, 2f, e4, ac, 5b, c0, c0, be, f6, 69, 68, 83, 46, 40, 80, 42, 17, b6, e1, ac, 5b, c0, 78, b7, fc, 3e, 5e, 83, 46, 40</span></span>
<span><span class="co">#&gt;    rdlength</span></span>
<span><span class="co">#&gt; 1 157.21119</span></span>
<span><span class="co">#&gt; 2 158.43944</span></span>
<span><span class="co">#&gt; 3  83.91872</span></span>
<span><span class="co">#&gt; 4 161.60393</span></span>
<span><span class="co">#&gt; 5  85.49391</span></span>
<span><span class="co">#&gt; 6  51.99568</span></span>
<span></span>
<span><span class="va">roads</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="reproject-vector-layers">Reproject vector layers<a class="anchor" aria-label="anchor" href="#reproject-vector-layers"></a>
</h3>
<p>The following example introduces another sample dataset which
contains fire perimeters for Yellowstone National Park from the
Monitoring Trends in Burn Severity (MTBS) project. Here we set up a
temporary, writable copy of the dataset ynp_fires_1984_2022.gpkg (in
memory), and use it as a data source to perform further processing.</p>
<p>The MTBS layer uses a projected coordinate system, while layers of
the “YNP features” dataset used in the examples above are in geographic
coordinates. The <code><a href="../reference/ogr_reproject.html">ogr_reproject()</a></code> function is used to
project layers in geographic coordinates from ynp_features.gpkg to match
the coordinate system of the MTBS layer.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># MTBS fire perimeters in Yellowstone National Park 1984-2022</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/ynp_fires_1984_2022.gpkg"</span>, package <span class="op">=</span> <span class="st">"gdalraster"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># copy to a temporary writable file</span></span>
<span><span class="va">mtbs_dsn</span> <span class="op">&lt;-</span> <span class="st">"/vsimem/tmp/ynp_fires_1984_2022.gpkg"</span></span>
<span><span class="fu"><a href="../reference/ogr2ogr.html">ogr2ogr</a></span><span class="op">(</span><span class="va">f</span>, <span class="va">mtbs_dsn</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">fires</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALVector</span>, <span class="va">mtbs_dsn</span>, <span class="st">"mtbs_perims"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; C++ object of class GDALVector</span></span>
<span><span class="co">#&gt;  Driver : GeoPackage (GPKG)</span></span>
<span><span class="co">#&gt;  DSN    : /vsimem/tmp/ynp_fires_1984_2022.gpkg</span></span>
<span><span class="co">#&gt;  Layer  : mtbs_perims</span></span>
<span><span class="co">#&gt;  CRS    : NAD83 / Montana (EPSG:32100)</span></span>
<span><span class="co">#&gt;  Geom   : MULTIPOLYGON</span></span>
<span></span>
<span><span class="va">srs_mtsp</span> <span class="op">&lt;-</span> <span class="va">fires</span><span class="op">$</span><span class="fu">getSpatialRef</span><span class="op">(</span><span class="op">)</span>  <span class="co"># Montana state plane metric definition</span></span>
<span></span>
<span><span class="co"># reproject the boundary in ynp_features.gpkg to match the MTBS layer,</span></span>
<span><span class="co"># returning a GDALVector object on the output layer by default</span></span>
<span><span class="op">(</span><span class="va">bnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ogr_reproject.html">ogr_reproject</a></span><span class="op">(</span>src_dsn <span class="op">=</span> <span class="va">ynp_dsn</span>, src_layer <span class="op">=</span> <span class="st">"ynp_bnd"</span>,</span>
<span>                      out_dsn <span class="op">=</span> <span class="va">mtbs_dsn</span>, out_srs <span class="op">=</span> <span class="va">srs_mtsp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; C++ object of class GDALVector</span></span>
<span><span class="co">#&gt;  Driver : GeoPackage (GPKG)</span></span>
<span><span class="co">#&gt;  DSN    : /vsimem/tmp/ynp_fires_1984_2022.gpkg</span></span>
<span><span class="co">#&gt;  Layer  : ynp_bnd</span></span>
<span><span class="co">#&gt;  CRS    : NAD83 / Montana (EPSG:32100)</span></span>
<span><span class="co">#&gt;  Geom   : POLYGON</span></span>
<span></span>
<span><span class="op">(</span><span class="va">bnd_feat</span> <span class="op">&lt;-</span> <span class="va">bnd</span><span class="op">$</span><span class="fu">getNextFeature</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; OGR feature</span></span>
<span><span class="co">#&gt; $FID</span></span>
<span><span class="co">#&gt; integer64</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $admn_type</span></span>
<span><span class="co">#&gt; [1] Park, monument, etc.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $state_fips</span></span>
<span><span class="co">#&gt; [1] 56</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $state_name</span></span>
<span><span class="co">#&gt; [1] Wyoming</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sub_region</span></span>
<span><span class="co">#&gt; [1] Mtn</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $geom</span></span>
<span><span class="co">#&gt; [1] WKB POLYGON: raw 01 03 00 00 ...</span></span>
<span></span>
<span><span class="va">bnd</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># reproject points_of_interest</span></span>
<span><span class="va">poi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ogr_reproject.html">ogr_reproject</a></span><span class="op">(</span><span class="va">ynp_dsn</span>, <span class="st">"points_of_interest"</span>, <span class="va">mtbs_dsn</span>, <span class="va">srs_mtsp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set an attribute filter to select the Maple Fire</span></span>
<span><span class="va">fires</span><span class="op">$</span><span class="fu">setAttributeFilter</span><span class="op">(</span><span class="st">"incid_name = 'MAPLE'"</span><span class="op">)</span></span>
<span><span class="va">fires</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="va">maple_fire</span> <span class="op">&lt;-</span> <span class="va">fires</span><span class="op">$</span><span class="fu">getNextFeature</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use the fire polygon as a spatial filter for points_of_interest</span></span>
<span><span class="co"># setSpatialFilter() expects WKT input, so convert the WKB geometry</span></span>
<span><span class="fu"><a href="../reference/g_wk2wk.html">g_wk2wk</a></span><span class="op">(</span><span class="va">maple_fire</span><span class="op">$</span><span class="va">geom</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="va">poi</span><span class="op">$</span><span class="fu">setSpatialFilter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">poi</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span></span>
<span><span class="va">poi</span><span class="op">$</span><span class="fu">setSelectedFields</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poiname"</span>, <span class="st">"poitype"</span>, <span class="st">"geom"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">maple_pois</span> <span class="op">&lt;-</span> <span class="va">poi</span><span class="op">$</span><span class="fu">fetch</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; OGR feature set</span></span>
<span><span class="co">#&gt;     FID                         poiname     poitype</span></span>
<span><span class="co">#&gt; 1  6745                             WA1    Campsite</span></span>
<span><span class="co">#&gt; 2  7777 Madison River Seismograph (YMR) Information</span></span>
<span><span class="co">#&gt; 3 22669  Madison River Access Parking E Parking Lot</span></span>
<span><span class="co">#&gt;                             geom</span></span>
<span><span class="co">#&gt; 1 WKB POINT: raw 01 01 00 00 ...</span></span>
<span><span class="co">#&gt; 2 WKB POINT: raw 01 01 00 00 ...</span></span>
<span><span class="co">#&gt; 3 WKB POINT: raw 01 01 00 00 ...</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bnd_feat</span>, col <span class="op">=</span> <span class="st">"wheat"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">maple_fire</span>, col <span class="op">=</span> <span class="st">"orangered"</span>, border <span class="op">=</span> <span class="cn">NA</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">maple_pois</span>, pch <span class="op">=</span> <span class="fl">15</span>, col <span class="op">=</span> <span class="st">"royalblue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="vector-api-overview_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">fires</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">poi</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="write-a-new-feature-in-an-existing-layer">Write a new feature in an existing layer<a class="anchor" aria-label="anchor" href="#write-a-new-feature-in-an-existing-layer"></a>
</h3>
<p>The <code>$createFeature()</code> method of <code>GDALVector</code>
object creates and writes a new feature within the layer. The
<code>feature</code> argument is a named list of fields and their values
(which could be be one row of a data frame). The passed feature is
written to the layer as a new feature, rather than overwriting an
existing one.</p>
<p>Here we add the centroid of the YNP boundary as a point of
interest.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a feature object for the YNP centroid as a point of interest</span></span>
<span><span class="op">(</span><span class="va">bnd_centroid_xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/g_measures.html">g_centroid</a></span><span class="op">(</span><span class="va">bnd_feat</span><span class="op">$</span><span class="va">geom</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         x         y </span></span>
<span><span class="co">#&gt; 516788.22  39216.35</span></span>
<span></span>
<span><span class="va">feat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">feat</span><span class="op">$</span><span class="va">poiname</span> <span class="op">&lt;-</span> <span class="st">"YNP centroid"</span></span>
<span><span class="va">feat</span><span class="op">$</span><span class="va">poitype</span> <span class="op">&lt;-</span> <span class="st">"Information"</span></span>
<span><span class="va">feat</span><span class="op">$</span><span class="va">createdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">feat</span><span class="op">$</span><span class="va">editdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">feat</span><span class="op">$</span><span class="va">geom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/g_factory.html">g_create</a></span><span class="op">(</span><span class="st">"POINT"</span>, <span class="va">bnd_centroid_xy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># re-open the "points_of_interest" layer with update access</span></span>
<span><span class="va">poi</span><span class="op">$</span><span class="fu">open</span><span class="op">(</span>read_only <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">poi</span><span class="op">$</span><span class="fu">testCapability</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">SequentialWrite</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># create and write the new feature on the layer</span></span>
<span><span class="va">poi</span><span class="op">$</span><span class="fu">createFeature</span><span class="op">(</span><span class="va">feat</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># be sure pending writes are flushed</span></span>
<span><span class="va">poi</span><span class="op">$</span><span class="fu">syncToDisk</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># read back</span></span>
<span><span class="va">fid</span> <span class="op">&lt;-</span> <span class="va">poi</span><span class="op">$</span><span class="fu">getLastWriteFID</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">ynp_centroid</span> <span class="op">&lt;-</span> <span class="va">poi</span><span class="op">$</span><span class="fu">getFeature</span><span class="op">(</span><span class="va">fid</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; OGR feature</span></span>
<span><span class="co">#&gt; $FID</span></span>
<span><span class="co">#&gt; integer64</span></span>
<span><span class="co">#&gt; [1] 27770</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $poiname</span></span>
<span><span class="co">#&gt; [1] YNP centroid</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $poitype</span></span>
<span><span class="co">#&gt; [1] Information</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $createdate</span></span>
<span><span class="co">#&gt; [1] 2025-05-04</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $editdate</span></span>
<span><span class="co">#&gt; [1] 2025-05-04</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $geom</span></span>
<span><span class="co">#&gt; [1] WKB POINT: raw 01 01 00 00 ...</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bnd_feat</span>, col <span class="op">=</span> <span class="st">"wheat"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ynp_centroid</span>, pch <span class="op">=</span> <span class="fl">10</span>, cex <span class="op">=</span> <span class="fl">1.5</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="vector-api-overview_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="rewritereplace-an-existing-feature">Rewrite/replace an existing feature<a class="anchor" aria-label="anchor" href="#rewritereplace-an-existing-feature"></a>
</h3>
<p>The <code>$setFeature()</code> method of a <code>GDALVector</code>
object writes a feature based on the feature id (FID) specified in the
input. As with <code>$createFeature()</code>, the <code>feature</code>
argument is a named list of fields and their values, and must include a
<code>$FID</code> element referencing the existing feature to rewrite.
Note that if any fields are omitted in the passed <code>feature</code>
the write behavior is driver-dependent:</p>
<ul>
<li>SQL-based drivers which implement set feature through SQL UPDATE
will skip unset fields, and thus the content of the existing feature
will be preserved.</li>
<li>The shapefile driver will write a NULL value in the DBF file.</li>
<li>The GeoJSON driver will take into account unset fields to remove the
corresponding JSON member.</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># rewrite a feature in the "point_of_interest" layer updating the feature name</span></span>
<span><span class="co"># verify the layer has random write capability</span></span>
<span><span class="va">poi</span><span class="op">$</span><span class="fu">testCapability</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">RandomWrite</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># FID 3809 is missing the trailhead name</span></span>
<span><span class="op">(</span><span class="va">feat</span> <span class="op">&lt;-</span> <span class="va">poi</span><span class="op">$</span><span class="fu">getFeature</span><span class="op">(</span><span class="fl">3809</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; OGR feature</span></span>
<span><span class="co">#&gt; $FID</span></span>
<span><span class="co">#&gt; integer64</span></span>
<span><span class="co">#&gt; [1] 3809</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $poiname</span></span>
<span><span class="co">#&gt; [1] &lt;NA&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $poitype</span></span>
<span><span class="co">#&gt; [1] Trailhead</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $createdate</span></span>
<span><span class="co">#&gt; [1] 2016-02-03</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $editdate</span></span>
<span><span class="co">#&gt; [1] 2018-06-13</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $geom</span></span>
<span><span class="co">#&gt; [1] WKB POINT: raw 01 01 00 00 ...</span></span>
<span></span>
<span><span class="co"># update the name field and the date of the edit</span></span>
<span><span class="va">feat</span><span class="op">$</span><span class="va">poiname</span> <span class="op">&lt;-</span> <span class="st">"Ice Lake Trailhead"</span></span>
<span><span class="va">feat</span><span class="op">$</span><span class="va">editdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># rewrite the feature</span></span>
<span><span class="va">poi</span><span class="op">$</span><span class="fu">setFeature</span><span class="op">(</span><span class="va">feat</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">poi</span><span class="op">$</span><span class="fu">syncToDisk</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="op">(</span><span class="va">feat</span> <span class="op">&lt;-</span> <span class="va">poi</span><span class="op">$</span><span class="fu">getFeature</span><span class="op">(</span><span class="fl">3809</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; OGR feature</span></span>
<span><span class="co">#&gt; $FID</span></span>
<span><span class="co">#&gt; integer64</span></span>
<span><span class="co">#&gt; [1] 3809</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $poiname</span></span>
<span><span class="co">#&gt; [1] Ice Lake Trailhead</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $poitype</span></span>
<span><span class="co">#&gt; [1] Trailhead</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $createdate</span></span>
<span><span class="co">#&gt; [1] 2016-02-03</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $editdate</span></span>
<span><span class="co">#&gt; [1] 2025-05-04</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $geom</span></span>
<span><span class="co">#&gt; [1] WKB POINT: raw 01 01 00 00 ...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="delete-a-feature">Delete a feature<a class="anchor" aria-label="anchor" href="#delete-a-feature"></a>
</h3>
<p>The <code>$deleteFeature()</code> method of a <code>GDALVector</code>
object deletes the feature with the indicated feature ID if supported by
the format driver. The value of <code>fid</code> must be a single
numeric value, optionally carrying the <code><a href="https://rdrr.io/pkg/bit64/man/bit64-package.html" class="external-link">bit64::integer64</a></code>
class attribute.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># delete the "YNP centroid" feature that was created above</span></span>
<span><span class="co"># verify the layer has delete feature capability</span></span>
<span><span class="va">poi</span><span class="op">$</span><span class="fu">testCapability</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">DeleteFeature</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># the feature ID was obtained above as: fid &lt;- poi$getLastWriteFID()</span></span>
<span><span class="va">poi</span><span class="op">$</span><span class="fu">getFeature</span><span class="op">(</span><span class="va">fid</span><span class="op">)</span></span>
<span><span class="co">#&gt; OGR feature</span></span>
<span><span class="co">#&gt; $FID</span></span>
<span><span class="co">#&gt; integer64</span></span>
<span><span class="co">#&gt; [1] 27770</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $poiname</span></span>
<span><span class="co">#&gt; [1] YNP centroid</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $poitype</span></span>
<span><span class="co">#&gt; [1] Information</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $createdate</span></span>
<span><span class="co">#&gt; [1] 2025-05-04</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $editdate</span></span>
<span><span class="co">#&gt; [1] 2025-05-04</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $geom</span></span>
<span><span class="co">#&gt; [1] WKB POINT: raw 01 01 00 00 ...</span></span>
<span></span>
<span><span class="va">poi</span><span class="op">$</span><span class="fu">deleteFeature</span><span class="op">(</span><span class="va">fid</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">poi</span><span class="op">$</span><span class="fu">syncToDisk</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="va">poi</span><span class="op">$</span><span class="fu">getFeature</span><span class="op">(</span><span class="va">fid</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span></span>
<span><span class="va">poi</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="batch-write-features-from-data-frame-input">Batch write features from data frame input<a class="anchor" aria-label="anchor" href="#batch-write-features-from-data-frame-input"></a>
</h3>
<p>The <code>$batchCreateFeature()</code>method of a
<code>GDALVector</code> object is batch version of
<code>$createFeature()</code>. It creates and writes a batch of new
features within the layer from input given as a data frame. Column names
in the data frame must match field names of the layer and have
compatible data types.</p>
<p>Operations that write batches of features should use transactions for
better performance when writing into RDBMS drivers that have native
transaction support (e.g., PostgreSQL / PostGIS, GPKG, SQLite). Grouping
many features per transaction (e.g., 100,000 or more) can improve
performance substatially. Using transactions also provides a mechanism
to rollback a group of data modifications that fails to complete or
generates errors.</p>
<p>The example below compares the relative performance of writing a
batch of features to a GeoPackage layer with and without a transaction.
We create a new POINT layer in the existing GPKG
(<code>mtbs_dsn</code>), and write batches of features at random point
locations within the YNP bounding box.</p>
<p>By default, the GeoPackage driver automatically creates a column
named <code>fid</code> to use for the OGR feature ID (primary key in the
SQLite database). This can be configured with the <code>FID=value</code>
layer creation option. Note that the FID is a special property of a
feature and not treated as an attribute of a feature, so it is not
specified in the layer definition.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a layer definition for random_points</span></span>
<span><span class="co"># the spatial ref was obtained above as: srs_mtsp &lt;- fires$getSpatialRef()</span></span>
<span><span class="va">defn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ogr_define.html">ogr_def_layer</a></span><span class="op">(</span><span class="st">"POINT"</span>, srs <span class="op">=</span> <span class="va">srs_mtsp</span><span class="op">)</span></span>
<span><span class="va">defn</span><span class="op">$</span><span class="va">pt_desc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ogr_define.html">ogr_def_field</a></span><span class="op">(</span><span class="st">"OFTString"</span><span class="op">)</span></span>
<span><span class="va">defn</span><span class="op">$</span><span class="va">create_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ogr_define.html">ogr_def_field</a></span><span class="op">(</span><span class="st">"OFTDateTime"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ogr_manage.html">ogr_layer_create</a></span><span class="op">(</span><span class="va">mtbs_dsn</span>, <span class="st">"random_points"</span>, layer_defn <span class="op">=</span> <span class="va">defn</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="va">lyr</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALVector</span>, <span class="va">mtbs_dsn</span>, <span class="st">"random_points"</span>, read_only <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/g_wk2wk.html">g_wk2wk</a></span><span class="op">(</span><span class="va">bnd_feat</span><span class="op">$</span><span class="va">geom</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/bbox_from_wkt.html">bbox_from_wkt</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Next we create the first batch of features and write them without
grouping in a transaction, measuring time elapsed.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">batch_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">1e5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a batch of features</span></span>
<span><span class="va">rndX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="op">(</span><span class="va">bb</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">bb</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">batch_size</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">rndY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="op">(</span><span class="va">bb</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">bb</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">batch_size</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">rndX</span>, <span class="va">rndY</span><span class="op">)</span></span>
<span><span class="va">pts_geom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/g_factory.html">g_create</a></span><span class="op">(</span><span class="st">"POINT"</span>, <span class="va">pts</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pt_desc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"random points batch 1"</span>, <span class="va">batch_size</span><span class="op">)</span>,</span>
<span>                create_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">batch_size</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">geom</span> <span class="op">&lt;-</span> <span class="va">pts_geom</span></span>
<span></span>
<span><span class="co"># write the batch (no transaction)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">res</span> <span class="op">&lt;-</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">batchCreateFeature</span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 0...10...20...30...40...50...60...70...80...90...100 - done.</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   2.257   0.008   2.265</span></span>
<span></span>
<span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">syncToDisk</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>A second batch of features is grouped in a transaction for writing,
and the layer is checked for the expected output.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rndX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="op">(</span><span class="va">bb</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">bb</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">batch_size</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">rndY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="op">(</span><span class="va">bb</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">bb</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">batch_size</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">rndX</span>, <span class="va">rndY</span><span class="op">)</span></span>
<span><span class="va">pts_geom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/g_factory.html">g_create</a></span><span class="op">(</span><span class="st">"POINT"</span>, <span class="va">pts</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pt_desc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"random points batch 2"</span>, <span class="va">batch_size</span><span class="op">)</span>,</span>
<span>                create_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">batch_size</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">geom</span> <span class="op">&lt;-</span> <span class="va">pts_geom</span></span>
<span></span>
<span><span class="co"># write the batch using a transaction</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">lyr</span><span class="op">$</span><span class="fu">startTransaction</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">res2</span> <span class="op">&lt;-</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">batchCreateFeature</span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">res2</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">lyr</span><span class="op">$</span><span class="fu">commitTransaction</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">else</span></span>
<span>    <span class="va">lyr</span><span class="op">$</span><span class="fu">rollbackTransaction</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; 0...10...20...30...40...50...60...70...80...90...100 - done.</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   1.031   0.010   1.042</span></span>
<span></span>
<span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">res2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># check the output data</span></span>
<span><span class="va">d_out</span> <span class="op">&lt;-</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">fetch</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">d_out</span><span class="op">)</span> <span class="op">==</span> <span class="va">batch_size</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d_out</span><span class="op">)</span></span>
<span><span class="co">#&gt; OGR feature set</span></span>
<span><span class="co">#&gt;   FID               pt_desc         create_time                           geom</span></span>
<span><span class="co">#&gt; 1   1 random points batch 1 2025-05-04 05:45:20 WKB POINT: raw 01 01 00 00 ...</span></span>
<span><span class="co">#&gt; 2   2 random points batch 1 2025-05-04 05:45:20 WKB POINT: raw 01 01 00 00 ...</span></span>
<span><span class="co">#&gt; 3   3 random points batch 1 2025-05-04 05:45:20 WKB POINT: raw 01 01 00 00 ...</span></span>
<span><span class="co">#&gt; 4   4 random points batch 1 2025-05-04 05:45:20 WKB POINT: raw 01 01 00 00 ...</span></span>
<span><span class="co">#&gt; 5   5 random points batch 1 2025-05-04 05:45:20 WKB POINT: raw 01 01 00 00 ...</span></span>
<span><span class="co">#&gt; 6   6 random points batch 1 2025-05-04 05:45:20 WKB POINT: raw 01 01 00 00 ...</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">d_out</span><span class="op">)</span></span>
<span><span class="co">#&gt; OGR feature set</span></span>
<span><span class="co">#&gt;           FID               pt_desc         create_time</span></span>
<span><span class="co">#&gt; 199995 199995 random points batch 2 2025-05-04 05:45:23</span></span>
<span><span class="co">#&gt; 199996 199996 random points batch 2 2025-05-04 05:45:23</span></span>
<span><span class="co">#&gt; 199997 199997 random points batch 2 2025-05-04 05:45:23</span></span>
<span><span class="co">#&gt; 199998 199998 random points batch 2 2025-05-04 05:45:23</span></span>
<span><span class="co">#&gt; 199999 199999 random points batch 2 2025-05-04 05:45:23</span></span>
<span><span class="co">#&gt; 200000 200000 random points batch 2 2025-05-04 05:45:23</span></span>
<span><span class="co">#&gt;                                  geom</span></span>
<span><span class="co">#&gt; 199995 WKB POINT: raw 01 01 00 00 ...</span></span>
<span><span class="co">#&gt; 199996 WKB POINT: raw 01 01 00 00 ...</span></span>
<span><span class="co">#&gt; 199997 WKB POINT: raw 01 01 00 00 ...</span></span>
<span><span class="co">#&gt; 199998 WKB POINT: raw 01 01 00 00 ...</span></span>
<span><span class="co">#&gt; 199999 WKB POINT: raw 01 01 00 00 ...</span></span>
<span><span class="co">#&gt; 200000 WKB POINT: raw 01 01 00 00 ...</span></span>
<span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="write-to-geojson">Write to GeoJSON<a class="anchor" aria-label="anchor" href="#write-to-geojson"></a>
</h3>
<p>Single-layer vector file formats (e.g., ESRI shapefile, FlatGeoBuf,
GeoJSON) can be created from scratch with a call to
<code><a href="../reference/ogr_manage.html">ogr_ds_create()</a></code>. This function provides optional arguments
to add a single attribute field on the layer when it is created. More
attribute fields could be added after layer creation with calls to
<code><a href="../reference/ogr_manage.html">ogr_field_create()</a></code> (for vector formats that have the
<code>CreateField</code> layer capability). Alternatively, a layer
definition (as list object) can be passed to
<code><a href="../reference/ogr_manage.html">ogr_ds_create()</a></code> to specify multiple attribute fields and
their properties (see <code><a href="../reference/ogr_define.html">?ogr_def_layer</a></code>).</p>
<p>GeoJSON does not support schema definition prior to creating
features. Only the <em>Feature</em> object has a member with name
<em>properties</em>. The specification does not require all
<em>Feature</em> objects in a collection to have the same schema of
properties, nor does it require all <em>Feature</em> objects in a
collection to have geometry of the same type (<a href="https://geojson.org/" class="external-link uri">https://geojson.org/</a>). Note
that we set <code>return_obj = TRUE</code> in the call to
<code><a href="../reference/ogr_manage.html">ogr_ds_create()</a></code>. This returns a live dataset object open
for write access on the layer (i.e., an object of class
<code>GDALVector</code>). A valid GeoJSON file will be generated once
one or more features have been written to the layer.</p>
<p>Here we generate a GeoJSON string containing a single polygon feature
that defines a rectangular area of interest around the Maple Fire
boundary. This GeoJSON format is supported for input by some data
distribution systems to define a download box (e.g., <a href="https://www.mrlc.gov/viewer/" class="external-link">NLCD</a> and <a href="https://www.landfire.gov/viewer/" class="external-link">LANDFIRE</a>). For this case we
need coordinates in Web Mercator projection (EPSG 3857).</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># write the Maple Fire AOI bounding box as GeoJSON in EPSG 3857</span></span>
<span><span class="va">json_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"maple_fire_aoi.geojson"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lyr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ogr_manage.html">ogr_ds_create</a></span><span class="op">(</span><span class="st">"GeoJSON"</span>, <span class="va">json_file</span>, layer <span class="op">=</span> <span class="st">"maple_fire_aoi"</span>,</span>
<span>                     geom_type <span class="op">=</span> <span class="st">"POLYGON"</span>, srs <span class="op">=</span> <span class="st">"EPSG:3857"</span>,</span>
<span>                     fld_name <span class="op">=</span> <span class="st">"id"</span>, fld_type <span class="op">=</span> <span class="st">"OFTString"</span>,</span>
<span>                     overwrite <span class="op">=</span> <span class="cn">TRUE</span>, return_obj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The Maple Fire feature object and spatial reference were obtained above in</span></span>
<span><span class="co"># the section on "Reproject vector layers".</span></span>
<span><span class="co"># Here we extend the minimum bounding box by 500 m in each direction.</span></span>
<span><span class="va">feat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">feat</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="st">"dataDownloadBox"</span></span>
<span><span class="va">feat</span><span class="op">$</span><span class="va">geom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/g_transform.html">g_transform</a></span><span class="op">(</span><span class="va">maple_fire</span><span class="op">$</span><span class="va">geom</span>, srs_from <span class="op">=</span> <span class="va">srs_mtsp</span>,</span>
<span>                         srs_to <span class="op">=</span> <span class="st">"EPSG:3857"</span>, as_wkb <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>               <span class="fu"><a href="../reference/bbox_from_wkt.html">bbox_from_wkt</a></span><span class="op">(</span>extend_x <span class="op">=</span> <span class="fl">500</span>, extend_y <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>               <span class="fu"><a href="../reference/bbox_to_wkt.html">bbox_to_wkt</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">createFeature</span><span class="op">(</span><span class="va">feat</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">json_file</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt; "type": "FeatureCollection",</span></span>
<span><span class="co">#&gt; "name": "maple_fire_aoi",</span></span>
<span><span class="co">#&gt; "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:EPSG::3857" } },</span></span>
<span><span class="co">#&gt; "features": [</span></span>
<span><span class="co">#&gt; { "type": "Feature", "properties": { "id": "dataDownloadBox" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -12367918.731928100809455, 5565677.54002314992249 ], [ -12341067.943306, 5565677.54002314992249 ], [ -12341067.943306, 5592957.016774149611592 ], [ -12367918.731928100809455, 5592957.016774149611592 ], [ -12367918.731928100809455, 5565677.54002314992249 ] ] ] } }</span></span>
<span><span class="co">#&gt; ]</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="ogr-facilities-for-vector-geoprocessing">OGR facilities for vector geoprocessing<a class="anchor" aria-label="anchor" href="#ogr-facilities-for-vector-geoprocessing"></a>
</h3>
<p><code><a href="../reference/ogr_proc.html">ogr_proc()</a></code> performs GIS overlay operations on vector
layers. It provides an interface to GDAL API methods for the following
operations: <a href="https://gdal.org/en/stable/api/vector_c_api.html#_CPPv418OGR_L_Intersection9OGRLayerH9OGRLayerH9OGRLayerHPPc16GDALProgressFuncPv" class="external-link">Intersection</a>,
<a href="https://gdal.org/en/stable/api/vector_c_api.html#_CPPv411OGR_L_Union9OGRLayerH9OGRLayerH9OGRLayerHPPc16GDALProgressFuncPv" class="external-link">Union</a>,
<a href="https://gdal.org/en/stable/api/vector_c_api.html#_CPPv419OGR_L_SymDifference9OGRLayerH9OGRLayerH9OGRLayerHPPc16GDALProgressFuncPv" class="external-link">SymDifference</a>,
<a href="https://gdal.org/en/stable/api/vector_c_api.html#_CPPv414OGR_L_Identity9OGRLayerH9OGRLayerH9OGRLayerHPPc16GDALProgressFuncPv" class="external-link">Identity</a>,
<a href="https://gdal.org/en/stable/api/vector_c_api.html#_CPPv412OGR_L_Update9OGRLayerH9OGRLayerH9OGRLayerHPPc16GDALProgressFuncPv" class="external-link">Update</a>,
<a href="https://gdal.org/en/stable/api/vector_c_api.html#_CPPv410OGR_L_Clip9OGRLayerH9OGRLayerH9OGRLayerHPPc16GDALProgressFuncPv" class="external-link">Clip</a>
and <a href="https://gdal.org/en/stable/api/vector_c_api.html#_CPPv411OGR_L_Erase9OGRLayerH9OGRLayerH9OGRLayerHPPc16GDALProgressFuncPv" class="external-link">Erase</a>.</p>
<p>Inputs are given as objects of class <code>GDALVector</code>, which
may have spatial and/or attribute filters applied. The output layer will
be created if it does not exist, but output can also be appended to an
existing layer, or written to an existing empty layer that has a custom
schema defined.</p>
<p>Here we generate a layer of areas within the 1988 North Fork fire
perimeter that have subsequently re-burned (as of 2022). The output
layer contains features whose geometries represent areas that are common
between features in the input layer and in the method layer. The
features in the output layer have attributes from both the input and
method layers.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># layer filtered to fires after 1988</span></span>
<span><span class="va">lyr1</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALVector</span>, <span class="va">mtbs_dsn</span>, <span class="st">"mtbs_perims"</span><span class="op">)</span></span>
<span><span class="va">lyr1</span><span class="op">$</span><span class="fu">setAttributeFilter</span><span class="op">(</span><span class="st">"ig_year &gt; 1988"</span><span class="op">)</span></span>
<span><span class="va">lyr1</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 46</span></span>
<span></span>
<span><span class="co"># second layer for the 1988 North Fork fire perimeter</span></span>
<span><span class="va">sql</span> <span class="op">&lt;-</span> <span class="st">"SELECT incid_name, ig_year, geom FROM mtbs_perims</span></span>
<span><span class="st">        WHERE incid_name = 'NORTH FORK'"</span></span>
<span><span class="va">lyr2</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALVector</span>, <span class="va">mtbs_dsn</span>, <span class="va">sql</span><span class="op">)</span></span>
<span><span class="va">lyr2</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="va">north_fork_feat</span> <span class="op">&lt;-</span> <span class="va">lyr2</span><span class="op">$</span><span class="fu">getNextFeature</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set mode options for the intersection</span></span>
<span><span class="va">opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"INPUT_PREFIX=layer1_"</span>,</span>
<span>         <span class="st">"METHOD_PREFIX=layer2_"</span>,</span>
<span>         <span class="st">"PROMOTE_TO_MULTI=YES"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># intersect to obtain areas re-burned since 2000</span></span>
<span><span class="va">lyr_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ogr_proc.html">ogr_proc</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"Intersection"</span>,</span>
<span>                    input_lyr <span class="op">=</span> <span class="va">lyr1</span>,</span>
<span>                    method_lyr <span class="op">=</span> <span class="va">lyr2</span>,</span>
<span>                    out_dsn <span class="op">=</span> <span class="va">mtbs_dsn</span>,</span>
<span>                    out_lyr_name <span class="op">=</span> <span class="st">"north_fork_reburned"</span>,</span>
<span>                    out_geom_type <span class="op">=</span> <span class="st">"MULTIPOLYGON"</span>,</span>
<span>                    mode_opt <span class="op">=</span> <span class="va">opt</span><span class="op">)</span></span>
<span><span class="co">#&gt; 0...10...20...30...40...50...60...70...80...90...100 - done.</span></span>
<span></span>
<span><span class="co"># the output layer has attributes of both the input and method layers</span></span>
<span><span class="op">(</span><span class="va">reburn_feat_set</span> <span class="op">&lt;-</span> <span class="va">lyr_out</span><span class="op">$</span><span class="fu">fetch</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; OGR feature set</span></span>
<span><span class="co">#&gt;   FID       layer1_event_id layer1_incid_name layer1_incid_type layer1_map_id</span></span>
<span><span class="co">#&gt; 1   1 WY4484611038620100914          ANTELOPE          Wildfire      10013735</span></span>
<span><span class="co">#&gt; 2   2 WY4466711063920120810            CYGNET          Wildfire          1961</span></span>
<span><span class="co">#&gt; 3   3 WY4474311097820160809             MAPLE          Wildfire      10005020</span></span>
<span><span class="co">#&gt; 4   4 WY4492611093820160805              FAWN          Wildfire      10005117</span></span>
<span><span class="co">#&gt; 5   5 WY4457911058620160826           CENTRAL          Wildfire      10014143</span></span>
<span><span class="co">#&gt;   layer1_burn_bnd_ac layer1_burn_bnd_lat layer1_burn_bnd_lon layer1_ig_date</span></span>
<span><span class="co">#&gt; 1               4888              44.839            -110.368     2010-09-14</span></span>
<span><span class="co">#&gt; 2               3188              44.682            -110.622     2012-08-10</span></span>
<span><span class="co">#&gt; 3             103193              44.731            -110.982     2016-08-09</span></span>
<span><span class="co">#&gt; 4               3161              44.936            -110.913     2016-08-05</span></span>
<span><span class="co">#&gt; 5               2340              44.595            -110.574     2016-08-26</span></span>
<span><span class="co">#&gt;   layer1_ig_year layer2_incid_name layer2_ig_year</span></span>
<span><span class="co">#&gt; 1           2010        NORTH FORK           1988</span></span>
<span><span class="co">#&gt; 2           2012        NORTH FORK           1988</span></span>
<span><span class="co">#&gt; 3           2016        NORTH FORK           1988</span></span>
<span><span class="co">#&gt; 4           2016        NORTH FORK           1988</span></span>
<span><span class="co">#&gt; 5           2016        NORTH FORK           1988</span></span>
<span><span class="co">#&gt;                                    geom</span></span>
<span><span class="co">#&gt; 1 WKB MULTIPOLYGON: raw 01 06 00 00 ...</span></span>
<span><span class="co">#&gt; 2 WKB MULTIPOLYGON: raw 01 06 00 00 ...</span></span>
<span><span class="co">#&gt; 3 WKB MULTIPOLYGON: raw 01 06 00 00 ...</span></span>
<span><span class="co">#&gt; 4 WKB MULTIPOLYGON: raw 01 06 00 00 ...</span></span>
<span><span class="co">#&gt; 5 WKB MULTIPOLYGON: raw 01 06 00 00 ...</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">north_fork_feat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">reburn_feat_set</span>, col <span class="op">=</span> <span class="st">"orangered"</span>, border <span class="op">=</span> <span class="cn">NA</span>, add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"1988 North Fork fire perimeter showing re-burned areas in red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vector-api-overview_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># clean up</span></span>
<span><span class="va">lyr1</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lyr2</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lyr_out</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/ctoney" class="external-link">Chris Toney</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
