<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="gdalraster">
<title>Raster API Tutorial • gdalraster</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Raster API Tutorial">
<meta property="og:description" content="gdalraster">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gdalraster</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/gdal-block-cache.html">GDAL Block Cache</a>
    <a class="dropdown-item" href="../articles/raster-display.html">Raster Display</a>
    <a class="dropdown-item" href="../articles/raster-api-tutorial.html">Raster API Tutorial</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/USDAForestService/gdalraster/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Raster API Tutorial</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/USDAForestService/gdalraster/blob/HEAD/vignettes/raster-api-tutorial.Rmd" class="external-link"><code>vignettes/raster-api-tutorial.Rmd</code></a></small>
      <div class="d-none name"><code>raster-api-tutorial.Rmd</code></div>
    </div>

    
    
<p><strong>gdalraster</strong> provides bindings to the Raster API of
the Geospatial Data Abstraction Library (<a href="https://gdal.org/" class="external-link">GDAL</a>). Using the API natively enables fast
and scalable raster I/O from R. This vignette is an R port of the <a href="https://gdal.org/tutorials/raster_api_tut.html" class="external-link">GDAL Raster API
tutorial</a> for C++, C and Python, (c) 1998-2023 <a href="https://github.com/warmerdam" class="external-link">Frank Warmerdam</a>, <a href="https://github.com/rouault" class="external-link">Even Rouault</a>, and <a href="https://github.com/OSGeo/gdal/graphs/contributors" class="external-link">others</a> (<a href="https://gdal.org/license.html" class="external-link">MIT license</a>).</p>
<div class="section level2">
<h2 id="opening-the-file">Opening the file<a class="anchor" aria-label="anchor" href="#opening-the-file"></a>
</h2>
<p>Before opening a GDAL-supported data store it is necessary to
register drivers. There is a driver for each supported raster format.
<strong>gdalraster</strong> automatically registers drivers when the
package is loaded. A raster dataset is opened by creating a new instance
of class <code>GDALRaster</code> passing the name of the file and the
access desired (<code>read_only = TRUE</code>, or
<code>read_only = FALSE</code> to open with update access):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usdaforestservice.github.io/gdalraster/">gdalraster</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; GDAL 3.4.1, released 2021/12/27, PROJ 8.2.1</span></span>
<span></span>
<span><span class="va">tcc_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/storml_tcc.tif"</span>, package<span class="op">=</span><span class="st">"gdalraster"</span><span class="op">)</span></span>
<span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALRaster</span>, <span class="va">tcc_file</span>, read_only<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>An error is returned if the dataset cannot be opened (and creation of
the <code>GDALRaster</code> object fails). Also, note that
<code>filename</code> may not actually be the name of a physical file
(though it usually is). Its interpretation is driver dependent, and it
might be a URL, a database connection string, a filename with additional
parameters, etc.</p>
<p><code>GDALRaster</code> is a C++ class exposed directly to R (via
<code>RCPP_EXPOSED_CLASS</code>) that encapsulates a GDAL dataset object
and its associated raster band objects. Methods of the class are
accessed in R using the <code>$</code> operator.</p>
</div>
<div class="section level2">
<h2 id="getting-dataset-information">Getting dataset information<a class="anchor" aria-label="anchor" href="#getting-dataset-information"></a>
</h2>
<p>As described in the GDAL <a href="https://gdal.org/user/raster_data_model.html" class="external-link">Raster Data
Model</a>, a GDAL dataset contains a list of raster bands, all
pertaining to the same area and having the same resolution. It also has
metadata, a coordinate system, a georeferencing transform, size of
raster and various other information.</p>
<p>In the particular but common case of a “north up” raster without any
rotation or shearing, the georeferencing transform (see <a href="https://gdal.org/tutorials/geotransforms_tut.html" class="external-link">Geotransform
Tutorial</a>) takes the following form with <em>1-based indexing in
R</em>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gt</span> <span class="op">&lt;-</span> <span class="va">ds</span><span class="op">$</span><span class="fu">getGeoTransform</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">gt</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>  <span class="co"># x-coordinate of upper-left corner of the upper-left pixel</span></span>
<span><span class="co">#&gt; [1] 323476.1</span></span>
<span><span class="va">gt</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>  <span class="co"># pixel width (w-e resolution)</span></span>
<span><span class="co">#&gt; [1] 30</span></span>
<span><span class="va">gt</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>  <span class="co"># 0 for north-up</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="va">gt</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>  <span class="co"># y-coordinate of upper-left corner of the upper-left pixel</span></span>
<span><span class="co">#&gt; [1] 5105082</span></span>
<span><span class="va">gt</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>  <span class="co"># 0 for north-up</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="va">gt</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span>  <span class="co"># pixel height (n-s resolution, negative value)</span></span>
<span><span class="co">#&gt; [1] -30</span></span></code></pre></div>
<p>In the general case, this is an affine transform. Class
<code>GDALRaster</code> also provides convenience methods for the case
of a north-up raster:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds</span><span class="op">$</span><span class="fu">bbox</span><span class="op">(</span><span class="op">)</span>  <span class="co"># xmin, ymin, xmax, ymax</span></span>
<span><span class="co">#&gt; [1]  323476.1 5101872.0  327766.1 5105082.0</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">res</span><span class="op">(</span><span class="op">)</span>   <span class="co"># pixel width, pixel height as positive values</span></span>
<span><span class="co">#&gt; [1] 30 30</span></span></code></pre></div>
<p>The following code retrieves some additional information about the
dataset:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># GDAL format driver</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">getDriverShortName</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "GTiff"</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">getDriverLongName</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "GeoTIFF"</span></span>
<span></span>
<span><span class="co"># raster size in pixels, number of bands</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">getRasterXSize</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 143</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">getRasterYSize</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 107</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">getRasterCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">dim</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 143 107   1</span></span>
<span></span>
<span><span class="co"># coordinate reference system as WKT string</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">getProjectionRef</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "PROJCS[\"NAD83 / UTM zone 12N\",GEOGCS[\"NAD83\",DATUM[\"North_American_Datum_1983\",SPHEROID[\"GRS 1980\",6378137,298.257222101,AUTHORITY[\"EPSG\",\"7019\"]],AUTHORITY[\"EPSG\",\"6269\"]],PRIMEM[\"Greenwich\",0,AUTHORITY[\"EPSG\",\"8901\"]],UNIT[\"degree\",0.0174532925199433,AUTHORITY[\"EPSG\",\"9122\"]],AUTHORITY[\"EPSG\",\"4269\"]],PROJECTION[\"Transverse_Mercator\"],PARAMETER[\"latitude_of_origin\",0],PARAMETER[\"central_meridian\",-111],PARAMETER[\"scale_factor\",0.9996],PARAMETER[\"false_easting\",500000],PARAMETER[\"false_northing\",0],UNIT[\"metre\",1,AUTHORITY[\"EPSG\",\"9001\"]],AXIS[\"Easting\",EAST],AXIS[\"Northing\",NORTH],AUTHORITY[\"EPSG\",\"26912\"]]"</span></span>
<span></span>
<span><span class="co"># origin and pixel size from the geotransform</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Origin:"</span>, <span class="va">gt</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">gt</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Origin: 323476.1 5105082"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Pixel size:"</span>, <span class="va">gt</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">gt</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Pixel size: 30 -30"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fetching-a-raster-band">Fetching a raster band<a class="anchor" aria-label="anchor" href="#fetching-a-raster-band"></a>
</h2>
<p>At this time access to raster data via GDAL is done one band at a
time. Also, metadata, block sizes, nodata values and various other
information are available on a per-band basis. Class
<code>GDALRaster</code> provides methods to access raster band objects
from the dataset (numbered 1 through <code>ds$getRasterCount()</code>),
by specifying a <code>band</code> number as the first argument:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># block size</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">getBlockSize</span><span class="op">(</span>band<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 143  57</span></span>
<span></span>
<span><span class="co"># data type</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">getDataTypeName</span><span class="op">(</span>band<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Byte"</span></span>
<span></span>
<span><span class="co"># nodata value</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">getNoDataValue</span><span class="op">(</span>band<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 255</span></span>
<span></span>
<span><span class="co"># min, max, mean, sd of pixel values in the band</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">getStatistics</span><span class="op">(</span>band<span class="op">=</span><span class="fl">1</span>, approx_ok <span class="op">=</span> <span class="cn">FALSE</span>, force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; 0...10...20...30...40...50...60...70...80...90...100 - done.</span></span>
<span><span class="co">#&gt; [1]  0.00000 71.00000 23.69950 23.17744</span></span>
<span></span>
<span><span class="co"># does this band have overviews? (aka "pyramids")</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">getOverviewCount</span><span class="op">(</span>band<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="co"># does this band have a color table?</span></span>
<span><span class="va">col_tbl</span> <span class="op">&lt;-</span> <span class="va">ds</span><span class="op">$</span><span class="fu">getColorTable</span><span class="op">(</span>band<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">col_tbl</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">col_tbl</span><span class="op">)</span></span>
<span><span class="co">#&gt;      value red green blue alpha</span></span>
<span><span class="co">#&gt; [1,]     0 255   255  255   255</span></span>
<span><span class="co">#&gt; [2,]     1 252   254  252   255</span></span>
<span><span class="co">#&gt; [3,]     2 250   253  250   255</span></span>
<span><span class="co">#&gt; [4,]     3 248   252  247   255</span></span>
<span><span class="co">#&gt; [5,]     4 245   251  245   255</span></span>
<span><span class="co">#&gt; [6,]     5 243   250  242   255</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reading-raster-data">Reading raster data<a class="anchor" aria-label="anchor" href="#reading-raster-data"></a>
</h2>
<p><code>GDALRaster$read()</code> is a wrapper for the
<code>GDALRasterBand::RasterIO()</code> method in the underlying API.
This method will automatically take care of data type conversion,
up/down sampling and windowing. The following code will read the first
row of data into a similarly sized vector.
<code>GDALRaster$read()</code> will return data as R
<code>integer</code> type if possible for the raster data type (Byte,
Int8, Int16, UInt16, Int32), otherwise the returned vector will be of
type <code>double</code> (UInt32, Float32, Float64) or
<code>complex</code> (CInt16, CInt32, CFloat32, CFloat64). The returned
data are organized in left to right, top to bottom pixel order.
<code>NA</code> will be returned in place of the nodata value if the
raster dataset has a nodata value defined for the band:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read the first row of pixel values</span></span>
<span><span class="va">ncols</span> <span class="op">&lt;-</span> <span class="va">ds</span><span class="op">$</span><span class="fu">getRasterXSize</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rowdata</span> <span class="op">&lt;-</span> <span class="va">ds</span><span class="op">$</span><span class="fu">read</span><span class="op">(</span>band <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                   xoff <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                   yoff <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                   xsize <span class="op">=</span> <span class="va">ncols</span>,</span>
<span>                   ysize <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                   out_xsize <span class="op">=</span> <span class="va">ncols</span>,</span>
<span>                   out_ysize <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rowdata</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 143</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/typeof.html" class="external-link">typeof</a></span><span class="op">(</span><span class="va">rowdata</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "integer"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rowdata</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 59 63 64 51 25 20</span></span></code></pre></div>
<p>Writing data with <code>GDALRaster$write()</code> is similar to
<code>$read()</code> with an additional argument specifying a vector of
pixel data to write (arranged in left to right, top to bottom pixel
order). The <code>xoff</code>, <code>yoff</code>, <code>xsize</code>,
<code>ysize</code> arguments describe the window of raster data on disk
to read (or write). It doesn’t have to fall on tile boundaries, though
access may be more efficient in some cases if it does. Note that GDAL
uses memory caching algorithms during raster I/O to improve performance.
The operation of the caching mechanism and configuration of cache memory
size might be considered when scaling I/O to large datasets (see <a href="https://usdaforestservice.github.io/gdalraster/articles/gdal-block-cache.html">GDAL
Block Cache</a>).</p>
<p>The values for <code>out_xsize</code> and <code>out_ysize</code>
describe the size of the output buffer (an R vector of length
<code>out_xsize * out_ysize</code> that data will be read into). When
reading data at full resolution this would be the same as the window
size (<code>xsize</code>, <code>ysize</code>). However, to load a
reduced resolution overview, <code>out_xsize</code>,
<code>out_ysize</code> could be set to smaller than the window on disk.
The <code>$read()</code> method will perform automatic resampling as
necessary if the specified output size
(<code>out_xsize * out_ysize</code>) is different than the size of the
region being read (<code>xsize * ysize</code>). In this case, overviews
(a.k.a. “pyramids”) will be utilized to do the I/O more efficiently if
overviews are available at suitable resolution.</p>
<p><code><a href="../reference/plot_raster.html">gdalraster::plot_raster()</a></code> uses base R
<code>graphics</code> to display raster data read from an open dataset
(with options to display a subwindow, to read a reduced resolution
overview, or read from multiple bands for RGB data):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_raster.html">plot_raster</a></span><span class="op">(</span><span class="va">ds</span>, legend<span class="op">=</span><span class="cn">TRUE</span>, main<span class="op">=</span><span class="st">"Storm Lake Tree Canopy Cover (%)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="raster-api-tutorial_files/figure-html/unnamed-chunk-8-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="closing-the-dataset">Closing the dataset<a class="anchor" aria-label="anchor" href="#closing-the-dataset"></a>
</h2>
<p>Calling <code>GDALRaster$close()</code> will result in proper
cleanup, and flushing of any pending writes. Forgetting to close a
dataset opened in update mode in a popular format like GTiff will likely
result in being unable to open it afterwards.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># close the dataset for proper cleanup</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="techniques-for-creating-files">Techniques for creating files<a class="anchor" aria-label="anchor" href="#techniques-for-creating-files"></a>
</h2>
<p>New files in GDAL-supported formats may be created if the format
driver supports creation. There are two general techniques for creating
files in the GDAL API, using CreateCopy() and Create(). The CreateCopy
method in R involves calling <code><a href="../reference/createCopy.html">gdalraster::createCopy()</a></code>,
passing in a source raster file that should be copied. The Create method
involves calling <code><a href="../reference/create.html">gdalraster::create()</a></code>, and then explicitly
writing all the metadata and raster data with separate calls. All
drivers that support creating new files support the CreateCopy method,
but only a few support the Create method.</p>
<p>Consult the table of <a href="https://gdal.org/drivers/raster/index.html" class="external-link">GDAL raster format
drivers</a> to determine if a particular driver supports Create or
CreateCopy. Note that a number of drivers are read-only and won’t
support either creation method.</p>
</div>
<div class="section level2">
<h2 id="using-createcopy">Using createCopy()<a class="anchor" aria-label="anchor" href="#using-createcopy"></a>
</h2>
<p><code><a href="../reference/createCopy.html">gdalraster::createCopy()</a></code> is simple to use as most
information is collected from the source file. It includes an argument
for passing a list of format specific creation options. It can be used
to copy a raster to a different format, and/or change options such as
the block size and arrangement, compression, various metadata, etc. The
following code copies a multi-band raster in FARSITE v.4 LCP format
(basically a raw format without support for compression or nodata
values) to LZW-compressed GeoTiff:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lcp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/storm_lake.lcp"</span>, package<span class="op">=</span><span class="st">"gdalraster"</span><span class="op">)</span></span>
<span><span class="va">tif_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/"</span>, <span class="st">"storml_lndscp.tif"</span><span class="op">)</span></span>
<span><span class="va">opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/createCopy.html">createCopy</a></span><span class="op">(</span>format <span class="op">=</span> <span class="st">"GTiff"</span>,</span>
<span>           dst_filename <span class="op">=</span> <span class="va">tif_file</span>,</span>
<span>           src_filename <span class="op">=</span> <span class="va">lcp_file</span>, </span>
<span>           options <span class="op">=</span> <span class="va">opt</span><span class="op">)</span></span>
<span><span class="co">#&gt; 0...10...20...30...40...50...60...70...80...90...100 - done.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.size</a></span><span class="op">(</span><span class="va">lcp_file</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 252132</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.size</a></span><span class="op">(</span><span class="va">tif_file</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 108510</span></span>
<span></span>
<span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALRaster</span>, <span class="va">tif_file</span>, read_only<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># band=0 for dataset-level metadata:</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">getMetadata</span><span class="op">(</span>band<span class="op">=</span><span class="fl">0</span>, domain<span class="op">=</span><span class="st">"IMAGE_STRUCTURE"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "COMPRESSION=LZW"  "INTERLEAVE=PIXEL"</span></span>
<span></span>
<span><span class="co"># set nodata value for all bands</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">band</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">ds</span><span class="op">$</span><span class="fu">getRasterCount</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ds</span><span class="op">$</span><span class="fu">setNoDataValue</span><span class="op">(</span><span class="va">band</span>, <span class="op">-</span><span class="fl">9999</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># band 2 of an LCP file is slope degrees</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">getStatistics</span><span class="op">(</span>band<span class="op">=</span><span class="fl">2</span>, approx_ok<span class="op">=</span><span class="cn">FALSE</span>, force<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; 0...10...20...30...40...50...60...70...80...90...100 - done.</span></span>
<span><span class="co">#&gt; [1]  0.00000 54.00000 22.93012 12.51330</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="using-create">Using create()<a class="anchor" aria-label="anchor" href="#using-create"></a>
</h2>
<p><code><a href="../reference/create.html">gdalraster::create()</a></code> can be used to create a new raster
dataset manually. This function takes a list of creation options like
<code><a href="../reference/createCopy.html">createCopy()</a></code>, but the raster size, number of bands and band
type must be provided explicitly:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/"</span>, <span class="st">"newdata.tif"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/create.html">create</a></span><span class="op">(</span>format <span class="op">=</span> <span class="st">"GTiff"</span>,</span>
<span>       dst_filename <span class="op">=</span> <span class="va">new_file</span>,</span>
<span>       xsize <span class="op">=</span> <span class="fl">143</span>,</span>
<span>       ysize <span class="op">=</span> <span class="fl">107</span>,</span>
<span>       nbands <span class="op">=</span> <span class="fl">1</span>, </span>
<span>       dataType <span class="op">=</span> <span class="st">"Int16"</span><span class="op">)</span></span></code></pre></div>
<p>Once the dataset is successfully created, all appropriate metadata
and raster data must be written to the file. What this includes will
vary according to usage, but a simple case with a projection,
geotransform and raster data is covered here:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALRaster</span>, <span class="va">new_file</span>, read_only<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># EPSG:26912 - NAD83 / UTM zone 12N</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">setProjection</span><span class="op">(</span><span class="fu"><a href="../reference/epsg_to_wkt.html">epsg_to_wkt</a></span><span class="op">(</span><span class="fl">26912</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="va">gt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">323476.1</span>, <span class="fl">30</span>, <span class="fl">0</span>, <span class="fl">5105082.0</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">setGeoTransform</span><span class="op">(</span><span class="va">gt</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">setNoDataValue</span><span class="op">(</span>band<span class="op">=</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">9999</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">fillRaster</span><span class="op">(</span>band<span class="op">=</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">9999</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ...</span></span>
<span></span>
<span><span class="co"># close the dataset when done</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a>
</h2>
<p><strong>gdalraster</strong> provides two additional functions for
creating raster datasets:</p>
<ul>
<li><p><code><a href="../reference/rasterFromRaster.html">rasterFromRaster()</a></code> creates a new raster with spatial
reference, extent and resolution taken from a template raster, without
copying data. It optionally changes the format, number of bands, data
type and nodata value, sets driver-specific dataset creation options,
and initializes to a value.</p></li>
<li><p><code><a href="../reference/rasterToVRT.html">rasterToVRT()</a></code> creates a virtual raster dataset (VRT)
derived from a source raster with options for virtual subsetting,
virtually resampling the source data at a different pixel resolution, or
applying a virtual kernel filter.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="data-sources">Data sources<a class="anchor" aria-label="anchor" href="#data-sources"></a>
</h2>
<p>The example datasets are National Land Cover Database (NLCD) Tree
Canopy Cover (TCC v2021.4) from the USDA Forest Service (<a href="https://data.fs.usda.gov/geodata/rastergateway/treecanopycover/" class="external-link uri">https://data.fs.usda.gov/geodata/rastergateway/treecanopycover/</a>),
and a multi-band FARSITE landscape file describing terrain, vegetation
and wildland fuels from the LANDFIRE Program (LF 2020 version, <a href="https://landfire.gov/" class="external-link uri">https://landfire.gov/</a>).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://github.com/ctoney" class="external-link">Chris Toney</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
