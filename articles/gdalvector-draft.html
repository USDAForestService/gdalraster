<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Draft Bindings to the GDAL/OGR Vector API • gdalraster</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Draft Bindings to the GDAL/OGR Vector API">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gdalraster</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.12.0.9110</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/gdal-block-cache.html">GDAL Block Cache</a></li>
    <li><a class="dropdown-item" href="../articles/gdal-config-quick-ref.html">GDAL Config Quick Reference</a></li>
    <li><a class="dropdown-item" href="../articles/gdalvector-draft.html">Draft Bindings to the GDAL/OGR Vector API</a></li>
    <li><a class="dropdown-item" href="../articles/raster-api-tutorial.html">Raster API Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/raster-attribute-tables.html">Raster Attribute Tables</a></li>
    <li><a class="dropdown-item" href="../articles/raster-display.html">Raster Display</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/USDAForestService/gdalraster/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Draft Bindings to the GDAL/OGR Vector API</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/USDAForestService/gdalraster/blob/main/vignettes/articles/gdalvector-draft.Rmd" class="external-link"><code>vignettes/articles/gdalvector-draft.Rmd</code></a></small>
      <div class="d-none name"><code>gdalvector-draft.Rmd</code></div>
    </div>

    
    
<p>Chris Toney (chris.toney at usda.gov)</p>
<p>Last modified: 2024-09-14</p>
<p>Comment/discussion: <a href="https://github.com/USDAForestService/gdalraster/issues/241" class="external-link uri">https://github.com/USDAForestService/gdalraster/issues/241</a></p>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>This document describes R bindings to the GDAL/OGR Vector API
proposed for inclusion in package <strong>gdalraster</strong>, analogous
to its existing raster support. A package providing low-level access to
both the raster and vector APIs in GDAL should be of interest to
developers creating higher level interfaces. For example, custom
workflows that are I/O intensive may benefit from direct access to
GDAL’s I/O capabilities. R bindings to the vector API would support
persistent connections to the data store, cursors with attribute and
spatial filtering, transactions, feature-level insert/delete, update of
attributes and geometries, and OGR facilities for geoprocessing. Calling
signatures of a class-based interface will resemble the C++ and Python
APIs provided by the GDAL project. It is intended that bindings in
<strong>gdalraster</strong> should provide long-term API stability while
tracking changes in GDAL.</p>
<p>A proposed interface is described in terms of the <a href="https://gdal.org/en/stable/user/vector_data_model.html" class="external-link">GDAL
Vector Data Model</a>, along with a draft class definition for
implementation via <code>RCPP_EXPOSED_CLASS</code>.</p>
<p>An initial implemetation supporting read access has been merged into
the <strong>gdalraster</strong> main branch (as of v. 1.11.1.9100,
2024-07-23), with online documentation available at: <a href="https://usdaforestservice.github.io/gdalraster/reference/GDALVector-class.html" class="uri">https://usdaforestservice.github.io/gdalraster/reference/GDALVector-class.html</a></p>
</div>
<div class="section level2">
<h2 id="description-of-the-interface">Description of the interface<a class="anchor" aria-label="anchor" href="#description-of-the-interface"></a>
</h2>
<p>Bindings will be implemented with <strong>Rcpp</strong> modules
including <code>RCPP_EXPOSED_CLASS</code>. Exposing C++ classes directly
in R provides a natural interface to the underlying object model.</p>
<div class="section level3">
<h3 id="vector-dataset">Vector dataset<a class="anchor" aria-label="anchor" href="#vector-dataset"></a>
</h3>
<p>A GDAL Dataset for vector is a file or database containing one or
more OGR layers. A vector dataset is represented in R as a data source
name (DSN), a character string that may be a filename, database
connection string, URL, virtual file, etc. Management of datasets and
their vector schemas will be done with:</p>
<ul>
<li>existing management functions in <strong>gdalraster</strong> that
operate on vector datasets: <code><a href="../reference/copyDatasetFiles.html">copyDatasetFiles()</a></code>,
<code><a href="../reference/deleteDataset.html">deleteDataset()</a></code>, <code><a href="../reference/renameDataset.html">renameDataset()</a></code> and
<code><a href="../reference/addFilesInZip.html">addFilesInZip()</a></code> (supports SOZip)</li>
<li>existing utility functions for managing vector data sources (as of
<strong>gdalraster</strong> 1.11.0): <a href="https://usdaforestservice.github.io/gdalraster/reference/ogr_manage.html">ogr_manage</a>
and <a href="https://usdaforestservice.github.io/gdalraster/reference/ogr_define.html">ogr_define</a>
</li>
<li>existing wrappers <code><a href="../reference/ogr2ogr.html">ogr2ogr()</a></code> and <code><a href="../reference/ogrinfo.html">ogrinfo()</a></code>
from the GDAL Utils API (as of <strong>gdalraster</strong> 1.10.0)</li>
<li>
<code><a href="../reference/ogr_manage.html">ogr_execute_sql()</a></code>: execute an SQL statement against the
data store to edit data (a SQL <code>SELECT</code> statement can be used
in the constructor for class <code>GDALVector</code> described below, to
open a layer of features)</li>
</ul>
</div>
<div class="section level3">
<h3 id="vector-layer">Vector layer<a class="anchor" aria-label="anchor" href="#vector-layer"></a>
</h3>
<p>The OGR Layer class represents a layer of features within a data
source. It will be modeled in R as class <code>GDALVector</code>, an
exposed C++ class encapsulating an OGR Layer and the GDAL Dataset that
owns it. A <code>GDALVector</code> object will persist an open
connection to the dataset, and expose methods for retrieving layer
information, setting attribute and spatial filters, reading/writing
features, and layer geoprocessing. A draft definition for class
<code>GDALVector</code> is given below.</p>
</div>
<div class="section level3">
<h3 id="feature-class-field-definitions">Feature class / field definitions<a class="anchor" aria-label="anchor" href="#feature-class-field-definitions"></a>
</h3>
<p>All features in an OGR Layer share a common schema (feature class)
modeled in GDAL as OGR Feature Definition. A feature class definition
includes the set of attribute fields and their data types, the geometry
field(s), and a feature class name (normally used as a layer name). The
feature class definition is represented as a list in R, having as names
the attribute/geometry field names, with each list element holding a
field definition.</p>
<p>An attribute field definition is a list with named elements:</p>
<pre><code>$type       : OGR Field Type ("OFTString", "OFTInteger", ...)
$subtype    : optional ("OFSTBoolean", ...)
$width      : optional max number of characters
$precision  : optional number of digits after the decimal point
$is_nullable: optional NOT NULL constraint (logical scalar)
$is_unique  : optional UNIQUE constraint (logical scalar)
$default    : optional field default value as character string
$domain     : optional domain name
$is_geom    : FALSE for attribute fields</code></pre>
<p>A geometry field definition is a list with named elements:</p>
<pre><code>$type       : geom type ("Point", "Polygon", etc.)
$srs        : optional spatial reference as WKT string
$is_nullable: optional NOT NULL constraint (logical scalar)
$is_geom    : TRUE for geometry fields</code></pre>
</div>
<div class="section level3">
<h3 id="feature-retrieval">Feature retrieval<a class="anchor" aria-label="anchor" href="#feature-retrieval"></a>
</h3>
<p>An OGR Feature – as read by <code>GDALVector::getNextFeature()</code>
or <code>GDALVector::getFeature()</code>, or as passed to write methods
– is a list with the unique feature identifier (FID), the attribute and
geometry field names, and their values.</p>
<p><code>GDALVector::fetch()</code> fetches the next <code>n</code>
features from the layer and returns them as a data frame (analog of <a href="https://dbi.r-dbi.org/reference/dbFetch.html" class="external-link"><code>DBI::dbFetch()</code></a>).
This allows retrieving the entire feature set (potentially with an
attribute and/or spatial filter applied), one page of features at a
time, or the remaining features. <code>fetch()</code> can be called
multiple times (forward paging). Fetching zero features is also possible
to retrieve the structure of the result set as a data frame.</p>
<p>OGR field types are returned as the corresponding native R types
(<code>NA</code> for OGR NULL values):</p>
<ul>
<li>
<code>OFTInteger</code>: <code>integer</code> (subtype
<code>OFSTBoolean</code> as <code>logical</code>)</li>
<li>
<code>OFTIntegerList</code>: vector of <code>integer</code> (list
column in data frames)</li>
<li>
<code>OFTInteger64</code>: <code><a href="https://rdrr.io/pkg/bit64/man/bit64-package.html" class="external-link">bit64::integer64</a></code> (subtype
<code>OFSTBoolean</code> as <code>logical</code>)</li>
<li>
<code>OFTInteger64List</code>: vector of
<code><a href="https://rdrr.io/pkg/bit64/man/bit64-package.html" class="external-link">bit64::integer64</a></code> (list column in data frames)</li>
<li>
<code>OFTReal</code>: <code>numeric</code>
</li>
<li>
<code>OFTRealList</code>: vector of <code>numeric</code> (list
column in data frames)</li>
<li>
<code>OFTString</code>: <code>character</code> string</li>
<li>
<code>OFTStringList</code>: vector of <code>character</code> strings
(list column in data frames)</li>
<li>
<code>OFTDate</code>: <code>Date</code>
</li>
<li>
<code>OFTDateTime</code>: <code>POSIXct</code> (millisecond
accuracy, adjustment for time zone flag if present)</li>
<li>
<code>OFTBinary</code>: <code>raw</code> vector (list column in data
frames)</li>
</ul>
</div>
<div class="section level3">
<h3 id="geometry">Geometry<a class="anchor" aria-label="anchor" href="#geometry"></a>
</h3>
<p>An OGR Geometry can be represented in R as either a character string
containing OGC Well Known Text (WKT), or a raw vector of bytes
containing Well Known Binary (WKB). An OGR Spatial Reference, which
encapsulates the definition of a projection and datum, is represented in
R as WKT. <strong>gdalraster</strong> has existing functions for working
with spatial reference systems as WKT (<code><a href="../reference/srs_to_wkt.html">srs_to_wkt()</a></code>,
<code><a href="../reference/srs_is_projected.html">srs_is_projected()</a></code>, etc.), and a set of geometry
convenience functions also operating on WKT (GEOS via GDAL headers).</p>
<p>Package <a href="https://github.com/paleolimbot/wk" class="external-link">wk</a> supports
parsing WKB and WKT representation of geometries to and from R-native
formats. Interoperability with <a href="https://github.com/r-spatial/sf" class="external-link">sf</a> classes for simple
features is also straightforward (e.g., <code>sf::st_sf()</code>).</p>
<p>Returning geometries is optional when retrieving features from a data
store with <strong>gdalraster</strong>. Omitting the geometries can
improve performance and memory utilization when access only to the
attributes is needed (currently the default). When geometries are
included, they can be retrieved as either WKB or WKT (optionally as the
ISO versions). WKB is compact and fast to parse, e.g., using the high
performance functions provided by <strong>wk</strong>. The setting for
geometry retrieval is per-object for class <code>GDALvector</code>, and
can be set back and forth as needed during the lifetime of the
object.</p>
</div>
</div>
<div class="section level2">
<h2 id="class-gdalvector">class GDALVector<a class="anchor" aria-label="anchor" href="#class-gdalvector"></a>
</h2>
<p>The draft class definition below has been partially implemented
in:</p>
<p><a href="https://github.com/USDAForestService/gdalraster/blob/gdalvector/src/gdalvector.cpp" class="external-link uri">https://github.com/USDAForestService/gdalraster/blob/gdalvector/src/gdalvector.cpp</a></p>
<p>The header file can be referenced for the public class methods that
have been implemented so far in the prototype (a subset of the draft
class definition below):</p>
<p><a href="https://github.com/USDAForestService/gdalraster/blob/gdalvector/src/gdalvector.h" class="external-link uri">https://github.com/USDAForestService/gdalraster/blob/gdalvector/src/gdalvector.h</a></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="kw">class</span> GDALVector <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a> <span class="kw">public</span><span class="op">:</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    GDALVector<span class="op">();</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="kw">explicit</span> GDALVector<span class="op">(</span>Rcpp<span class="op">::</span>CharacterVector dsn<span class="op">);</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    GDALVector<span class="op">(</span>Rcpp<span class="op">::</span>CharacterVector dsn<span class="op">,</span> <span class="bu">std::</span>string layer<span class="op">);</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    GDALVector<span class="op">(</span>Rcpp<span class="op">::</span>CharacterVector dsn<span class="op">,</span> <span class="bu">std::</span>string layer<span class="op">,</span> <span class="dt">bool</span> read_only<span class="op">);</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    GDALVector<span class="op">(</span>Rcpp<span class="op">::</span>CharacterVector dsn<span class="op">,</span> <span class="bu">std::</span>string layer<span class="op">,</span> <span class="dt">bool</span> read_only<span class="op">,</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>               Rcpp<span class="op">::</span>CharacterVector open_options<span class="op">);</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    GDALVector<span class="op">(</span>Rcpp<span class="op">::</span>CharacterVector dsn<span class="op">,</span> <span class="bu">std::</span>string layer<span class="op">,</span> <span class="dt">bool</span> read_only<span class="op">,</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>               Rcpp<span class="op">::</span>Nullable<span class="op">&lt;</span>Rcpp<span class="op">::</span>CharacterVector<span class="op">&gt;</span> open_options<span class="op">,</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>               <span class="bu">std::</span>string spatial_filter<span class="op">,</span> <span class="bu">std::</span>string dialect<span class="op">);</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>    <span class="co">// undocumented, exposed read-only fields for internal use</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>    <span class="bu">std::</span>string <span class="va">m_layer_name</span> <span class="op">{</span><span class="st">""</span><span class="op">};</span>  <span class="co">// layer name or sql statement</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>    <span class="dt">bool</span> <span class="va">m_is_sql</span> <span class="op">{</span><span class="kw">false</span><span class="op">};</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>    <span class="bu">std::</span>string <span class="va">m_dialect</span> <span class="op">{</span><span class="st">""</span><span class="op">};</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>    <span class="co">// exposed read/write fields</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>    <span class="bu">std::</span>string defaultGeomFldName <span class="op">{</span><span class="st">"geometry"</span><span class="op">};</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>    <span class="dt">bool</span> promoteToMulti <span class="op">{</span><span class="kw">false</span><span class="op">};</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>    <span class="bu">std::</span>string returnGeomAs <span class="op">{</span><span class="st">"WKB"</span><span class="op">};</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>    <span class="bu">std::</span>string wkbByteOrder <span class="op">{</span><span class="st">"LSB"</span><span class="op">};</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>    <span class="co">// exposed methods</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>    <span class="dt">void</span> open<span class="op">(</span><span class="dt">bool</span> read_only<span class="op">);</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>    <span class="dt">bool</span> isOpen<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>    <span class="bu">std::</span>string getDsn<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>    Rcpp<span class="op">::</span>CharacterVector getFileList<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>    <span class="bu">std::</span>string getDriverShortName<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>    <span class="bu">std::</span>string getDriverLongName<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>    <span class="bu">std::</span>string getName<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>    Rcpp<span class="op">::</span>CharacterVector getFieldNames<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>    Rcpp<span class="op">::</span>List testCapability<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>    <span class="bu">std::</span>string getFIDColumn<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a>    <span class="bu">std::</span>string getGeomType<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a>    <span class="bu">std::</span>string getGeometryColumn<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>    <span class="bu">std::</span>string getSpatialRef<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a>    Rcpp<span class="op">::</span>NumericVector bbox<span class="op">();</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a>    Rcpp<span class="op">::</span>List getLayerDefn<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a>    <span class="dt">void</span> setAttributeFilter<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>string <span class="op">&amp;</span>query<span class="op">);</span></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a>    <span class="bu">std::</span>string getAttributeFilter<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a>    <span class="dt">void</span> setIgnoredFields<span class="op">(</span><span class="at">const</span> Rcpp<span class="op">::</span>RObject <span class="op">&amp;</span>fields<span class="op">);</span></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a>    <span class="dt">void</span> setSelectedFields<span class="op">(</span><span class="at">const</span> Rcpp<span class="op">::</span>RObject <span class="op">&amp;</span>fields<span class="op">);</span></span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a>    <span class="dt">void</span> setSpatialFilter<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>string <span class="op">&amp;</span>wkt<span class="op">);</span></span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a>    <span class="dt">void</span> setSpatialFilterRect<span class="op">(</span><span class="at">const</span> Rcpp<span class="op">::</span>RObject <span class="op">&amp;</span>bbox<span class="op">);</span></span>
<span id="cb3-49"><a href="#cb3-49" tabindex="-1"></a>    <span class="bu">std::</span>string getSpatialFilter<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-50"><a href="#cb3-50" tabindex="-1"></a>    <span class="dt">void</span> clearSpatialFilter<span class="op">();</span></span>
<span id="cb3-51"><a href="#cb3-51" tabindex="-1"></a></span>
<span id="cb3-52"><a href="#cb3-52" tabindex="-1"></a>    <span class="dt">double</span> getFeatureCount<span class="op">();</span></span>
<span id="cb3-53"><a href="#cb3-53" tabindex="-1"></a>    SEXP getNextFeature<span class="op">();</span></span>
<span id="cb3-54"><a href="#cb3-54" tabindex="-1"></a>    <span class="dt">void</span> setNextByIndex<span class="op">(</span><span class="dt">double</span> i<span class="op">);</span></span>
<span id="cb3-55"><a href="#cb3-55" tabindex="-1"></a>    <span class="co">// fid must be a length-1 numeric vector, since numeric vector can carry</span></span>
<span id="cb3-56"><a href="#cb3-56" tabindex="-1"></a>    <span class="co">// the class attribute for integer64:</span></span>
<span id="cb3-57"><a href="#cb3-57" tabindex="-1"></a>    SEXP getFeature<span class="op">(</span><span class="at">const</span> Rcpp<span class="op">::</span>RObject <span class="op">&amp;</span>fid<span class="op">);</span></span>
<span id="cb3-58"><a href="#cb3-58" tabindex="-1"></a>    <span class="dt">void</span> resetReading<span class="op">();</span></span>
<span id="cb3-59"><a href="#cb3-59" tabindex="-1"></a></span>
<span id="cb3-60"><a href="#cb3-60" tabindex="-1"></a>    Rcpp<span class="op">::</span>DataFrame fetch<span class="op">(</span><span class="dt">double</span> n<span class="op">);</span></span>
<span id="cb3-61"><a href="#cb3-61" tabindex="-1"></a></span>
<span id="cb3-62"><a href="#cb3-62" tabindex="-1"></a>    <span class="dt">bool</span> setFeature<span class="op">(</span><span class="at">const</span> Rcpp<span class="op">::</span>RObject <span class="op">&amp;</span>feature<span class="op">);</span></span>
<span id="cb3-63"><a href="#cb3-63" tabindex="-1"></a>    <span class="dt">bool</span> createFeature<span class="op">(</span><span class="at">const</span> Rcpp<span class="op">::</span>RObject <span class="op">&amp;</span>feature<span class="op">);</span></span>
<span id="cb3-64"><a href="#cb3-64" tabindex="-1"></a>    <span class="dt">bool</span> upsertFeature<span class="op">(</span><span class="at">const</span> Rcpp<span class="op">::</span>RObject <span class="op">&amp;</span>feature<span class="op">);</span></span>
<span id="cb3-65"><a href="#cb3-65" tabindex="-1"></a>    SEXP getLastWriteFID<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-66"><a href="#cb3-66" tabindex="-1"></a>    <span class="dt">bool</span> deleteFeature<span class="op">(</span><span class="at">const</span> Rcpp<span class="op">::</span>RObject <span class="op">&amp;</span>fid<span class="op">);</span></span>
<span id="cb3-67"><a href="#cb3-67" tabindex="-1"></a>    <span class="dt">bool</span> syncToDisk<span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-68"><a href="#cb3-68" tabindex="-1"></a></span>
<span id="cb3-69"><a href="#cb3-69" tabindex="-1"></a>    <span class="dt">bool</span> startTransaction<span class="op">(</span><span class="dt">bool</span> force<span class="op">);</span></span>
<span id="cb3-70"><a href="#cb3-70" tabindex="-1"></a>    <span class="dt">bool</span> commitTransaction<span class="op">();</span></span>
<span id="cb3-71"><a href="#cb3-71" tabindex="-1"></a>    <span class="dt">bool</span> rollbackTransaction<span class="op">();</span></span>
<span id="cb3-72"><a href="#cb3-72" tabindex="-1"></a></span>
<span id="cb3-73"><a href="#cb3-73" tabindex="-1"></a>    <span class="dt">bool</span> layerIntersection<span class="op">(</span></span>
<span id="cb3-74"><a href="#cb3-74" tabindex="-1"></a>            GDALVector method_layer<span class="op">,</span></span>
<span id="cb3-75"><a href="#cb3-75" tabindex="-1"></a>            GDALVector result_layer<span class="op">,</span></span>
<span id="cb3-76"><a href="#cb3-76" tabindex="-1"></a>            <span class="dt">bool</span> quiet<span class="op">,</span></span>
<span id="cb3-77"><a href="#cb3-77" tabindex="-1"></a>            <span class="at">const</span> Rcpp<span class="op">::</span>Nullable<span class="op">&lt;</span><span class="at">const</span> Rcpp<span class="op">::</span>CharacterVector<span class="op">&gt;</span> <span class="op">&amp;</span>options<span class="op">);</span></span>
<span id="cb3-78"><a href="#cb3-78" tabindex="-1"></a>    <span class="dt">bool</span> layerUnion<span class="op">(</span></span>
<span id="cb3-79"><a href="#cb3-79" tabindex="-1"></a>            GDALVector method_layer<span class="op">,</span></span>
<span id="cb3-80"><a href="#cb3-80" tabindex="-1"></a>            GDALVector result_layer<span class="op">,</span></span>
<span id="cb3-81"><a href="#cb3-81" tabindex="-1"></a>            <span class="dt">bool</span> quiet<span class="op">,</span></span>
<span id="cb3-82"><a href="#cb3-82" tabindex="-1"></a>            <span class="at">const</span> Rcpp<span class="op">::</span>Nullable<span class="op">&lt;</span><span class="at">const</span> Rcpp<span class="op">::</span>CharacterVector<span class="op">&gt;</span> <span class="op">&amp;</span>options<span class="op">);</span></span>
<span id="cb3-83"><a href="#cb3-83" tabindex="-1"></a>    <span class="dt">bool</span> layerSymDifference<span class="op">(</span></span>
<span id="cb3-84"><a href="#cb3-84" tabindex="-1"></a>            GDALVector method_layer<span class="op">,</span></span>
<span id="cb3-85"><a href="#cb3-85" tabindex="-1"></a>            GDALVector result_layer<span class="op">,</span></span>
<span id="cb3-86"><a href="#cb3-86" tabindex="-1"></a>            <span class="dt">bool</span> quiet<span class="op">,</span></span>
<span id="cb3-87"><a href="#cb3-87" tabindex="-1"></a>            <span class="at">const</span> Rcpp<span class="op">::</span>Nullable<span class="op">&lt;</span><span class="at">const</span> Rcpp<span class="op">::</span>CharacterVector<span class="op">&gt;</span> <span class="op">&amp;</span>options<span class="op">);</span></span>
<span id="cb3-88"><a href="#cb3-88" tabindex="-1"></a>    <span class="dt">bool</span> layerIdentity<span class="op">(</span></span>
<span id="cb3-89"><a href="#cb3-89" tabindex="-1"></a>            GDALVector method_layer<span class="op">,</span></span>
<span id="cb3-90"><a href="#cb3-90" tabindex="-1"></a>            GDALVector result_layer<span class="op">,</span></span>
<span id="cb3-91"><a href="#cb3-91" tabindex="-1"></a>            <span class="dt">bool</span> quiet<span class="op">,</span></span>
<span id="cb3-92"><a href="#cb3-92" tabindex="-1"></a>            <span class="at">const</span> Rcpp<span class="op">::</span>Nullable<span class="op">&lt;</span><span class="at">const</span> Rcpp<span class="op">::</span>CharacterVector<span class="op">&gt;</span> <span class="op">&amp;</span>options<span class="op">);</span></span>
<span id="cb3-93"><a href="#cb3-93" tabindex="-1"></a>    <span class="dt">bool</span> layerUpdate<span class="op">(</span></span>
<span id="cb3-94"><a href="#cb3-94" tabindex="-1"></a>            GDALVector method_layer<span class="op">,</span></span>
<span id="cb3-95"><a href="#cb3-95" tabindex="-1"></a>            GDALVector result_layer<span class="op">,</span></span>
<span id="cb3-96"><a href="#cb3-96" tabindex="-1"></a>            <span class="dt">bool</span> quiet<span class="op">,</span></span>
<span id="cb3-97"><a href="#cb3-97" tabindex="-1"></a>            <span class="at">const</span> Rcpp<span class="op">::</span>Nullable<span class="op">&lt;</span><span class="at">const</span> Rcpp<span class="op">::</span>CharacterVector<span class="op">&gt;</span> <span class="op">&amp;</span>options<span class="op">);</span></span>
<span id="cb3-98"><a href="#cb3-98" tabindex="-1"></a>    <span class="dt">bool</span> layerClip<span class="op">(</span></span>
<span id="cb3-99"><a href="#cb3-99" tabindex="-1"></a>            GDALVector method_layer<span class="op">,</span></span>
<span id="cb3-100"><a href="#cb3-100" tabindex="-1"></a>            GDALVector result_layer<span class="op">,</span></span>
<span id="cb3-101"><a href="#cb3-101" tabindex="-1"></a>            <span class="dt">bool</span> quiet<span class="op">,</span></span>
<span id="cb3-102"><a href="#cb3-102" tabindex="-1"></a>            <span class="at">const</span> Rcpp<span class="op">::</span>Nullable<span class="op">&lt;</span><span class="at">const</span> Rcpp<span class="op">::</span>CharacterVector<span class="op">&gt;</span> <span class="op">&amp;</span>options<span class="op">);</span></span>
<span id="cb3-103"><a href="#cb3-103" tabindex="-1"></a>    <span class="dt">bool</span> layerErase<span class="op">(</span></span>
<span id="cb3-104"><a href="#cb3-104" tabindex="-1"></a>            GDALVector method_layer<span class="op">,</span></span>
<span id="cb3-105"><a href="#cb3-105" tabindex="-1"></a>            GDALVector result_layer<span class="op">,</span></span>
<span id="cb3-106"><a href="#cb3-106" tabindex="-1"></a>            <span class="dt">bool</span> quiet<span class="op">,</span></span>
<span id="cb3-107"><a href="#cb3-107" tabindex="-1"></a>            <span class="at">const</span> Rcpp<span class="op">::</span>Nullable<span class="op">&lt;</span><span class="at">const</span> Rcpp<span class="op">::</span>CharacterVector<span class="op">&gt;</span> <span class="op">&amp;</span>options<span class="op">);</span></span>
<span id="cb3-108"><a href="#cb3-108" tabindex="-1"></a></span>
<span id="cb3-109"><a href="#cb3-109" tabindex="-1"></a>    <span class="dt">void</span> close<span class="op">();</span></span>
<span id="cb3-110"><a href="#cb3-110" tabindex="-1"></a></span>
<span id="cb3-111"><a href="#cb3-111" tabindex="-1"></a>    <span class="dt">void</span> OGRFeatureFromList_dumpReadble<span class="op">(</span><span class="at">const</span> Rcpp<span class="op">::</span>RObject <span class="op">&amp;</span>feat<span class="op">)</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-112"><a href="#cb3-112" tabindex="-1"></a></span>
<span id="cb3-113"><a href="#cb3-113" tabindex="-1"></a>    <span class="co">// methods for internal use not exposed to R</span></span>
<span id="cb3-114"><a href="#cb3-114" tabindex="-1"></a>    <span class="dt">void</span> <span class="va">checkAccess_</span><span class="op">(</span>GDALAccess access_needed<span class="op">)</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-115"><a href="#cb3-115" tabindex="-1"></a>    <span class="dt">void</span> <span class="va">setDsn_</span><span class="op">(</span><span class="bu">std::</span>string dsn<span class="op">);</span></span>
<span id="cb3-116"><a href="#cb3-116" tabindex="-1"></a>    GDALDatasetH <span class="va">getGDALDatasetH_</span><span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-117"><a href="#cb3-117" tabindex="-1"></a>    <span class="dt">void</span> <span class="va">setGDALDatasetH_</span><span class="op">(</span><span class="at">const</span> GDALDatasetH hDs<span class="op">,</span> <span class="dt">bool</span> with_update<span class="op">);</span></span>
<span id="cb3-118"><a href="#cb3-118" tabindex="-1"></a>    OGRLayerH <span class="va">getOGRLayerH_</span><span class="op">()</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-119"><a href="#cb3-119" tabindex="-1"></a>    <span class="dt">void</span> <span class="va">setOGRLayerH_</span><span class="op">(</span><span class="at">const</span> OGRLayerH hLyr<span class="op">,</span> <span class="at">const</span> <span class="bu">std::</span>string <span class="op">&amp;</span>lyr_name<span class="op">);</span></span>
<span id="cb3-120"><a href="#cb3-120" tabindex="-1"></a>    <span class="dt">void</span> <span class="va">setFieldNames_</span><span class="op">();</span></span>
<span id="cb3-121"><a href="#cb3-121" tabindex="-1"></a>    SEXP <span class="va">initDF_</span><span class="op">(</span><span class="dt">R_xlen_t</span> nrow<span class="op">)</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-122"><a href="#cb3-122" tabindex="-1"></a>    OGRFeatureH OGRFeatureFromList_<span class="op">(</span><span class="at">const</span> Rcpp<span class="op">::</span>RObject <span class="op">&amp;</span>feature<span class="op">)</span> <span class="at">const</span><span class="op">;</span></span>
<span id="cb3-123"><a href="#cb3-123" tabindex="-1"></a></span>
<span id="cb3-124"><a href="#cb3-124" tabindex="-1"></a> <span class="kw">private</span><span class="op">:</span></span>
<span id="cb3-125"><a href="#cb3-125" tabindex="-1"></a>    <span class="bu">std::</span>string <span class="va">m_dsn</span> <span class="op">{</span><span class="st">""</span><span class="op">};</span></span>
<span id="cb3-126"><a href="#cb3-126" tabindex="-1"></a>    Rcpp<span class="op">::</span>CharacterVector <span class="va">m_open_options</span> <span class="op">{};</span></span>
<span id="cb3-127"><a href="#cb3-127" tabindex="-1"></a>    <span class="bu">std::</span>string <span class="va">m_attr_filter</span> <span class="op">{</span><span class="st">""</span><span class="op">};</span></span>
<span id="cb3-128"><a href="#cb3-128" tabindex="-1"></a>    <span class="bu">std::</span>string <span class="va">m_spatial_filter</span> <span class="op">{</span><span class="st">""</span><span class="op">};</span></span>
<span id="cb3-129"><a href="#cb3-129" tabindex="-1"></a>    Rcpp<span class="op">::</span>CharacterVector <span class="va">m_field_names</span> <span class="op">{};</span></span>
<span id="cb3-130"><a href="#cb3-130" tabindex="-1"></a>    Rcpp<span class="op">::</span>CharacterVector <span class="va">m_ignored_fields</span> <span class="op">{};</span></span>
<span id="cb3-131"><a href="#cb3-131" tabindex="-1"></a>    GDALDatasetH <span class="va">m_hDataset</span> <span class="op">{</span><span class="kw">nullptr</span><span class="op">};</span></span>
<span id="cb3-132"><a href="#cb3-132" tabindex="-1"></a>    GDALAccess <span class="va">m_eAccess</span> <span class="op">{</span>GA_ReadOnly<span class="op">};</span></span>
<span id="cb3-133"><a href="#cb3-133" tabindex="-1"></a>    OGRLayerH <span class="va">m_hLayer</span> <span class="op">{</span><span class="kw">nullptr</span><span class="op">};</span></span>
<span id="cb3-134"><a href="#cb3-134" tabindex="-1"></a>    <span class="dt">int64_t</span> <span class="va">m_last_write_fid</span> <span class="op">{</span>NA_INTEGER64<span class="op">};</span></span>
<span id="cb3-135"><a href="#cb3-135" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb3-136"><a href="#cb3-136" tabindex="-1"></a></span>
<span id="cb3-137"><a href="#cb3-137" tabindex="-1"></a>RCPP_EXPOSED_CLASS<span class="op">(</span>GDALVector<span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-usage-for-class-gdalvector">Example: usage for class GDALVector<a class="anchor" aria-label="anchor" href="#example-usage-for-class-gdalvector"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## usage for GDALVector class</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usdaforestservice.github.io/gdalraster/">gdalraster</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; GDAL 3.8.4, released 2024/02/08, GEOS 3.12.1, PROJ 9.3.1</span></span>
<span></span>
<span><span class="co"># MTBS fires in Yellowstone National Park 1984-2022</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/ynp_fires_1984_2022.gpkg"</span>, package<span class="op">=</span><span class="st">"gdalraster"</span><span class="op">)</span></span>
<span><span class="co"># copy to a temporary in-memory file that is writeable</span></span>
<span><span class="va">dsn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"/vsimem/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/vsi_copy_file.html">vsi_copy_file</a></span><span class="op">(</span><span class="va">f</span>, <span class="va">dsn</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="va">lyr</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALVector</span>, <span class="va">dsn</span>, <span class="st">"mtbs_perims"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># object of class GDALVector</span></span>
<span><span class="va">lyr</span></span>
<span><span class="co">#&gt; C++ object &lt;0x58bb870345b0&gt; of class 'GDALVector' &lt;0x58bb8825b400&gt;</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">lyr</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reference class 'Rcpp_GDALVector' [package "gdalraster"] with 3 fields</span></span>
<span><span class="co">#&gt;  $ defaultGeomFldName: chr "geometry"</span></span>
<span><span class="co">#&gt;  $ returnGeomAs      : chr "NONE"</span></span>
<span><span class="co">#&gt;  $ wkbByteOrder      : chr "LSB"</span></span>
<span><span class="co">#&gt;  and 46 methods, of which 32 are  possibly relevant:</span></span>
<span><span class="co">#&gt;    bbox, clearSpatialFilter, close, fetch, finalize, getDriverLongName,</span></span>
<span><span class="co">#&gt;    getDriverShortName, getDsn, getFeature, getFeatureCount, getFIDColumn,</span></span>
<span><span class="co">#&gt;    getFileList, getGeometryColumn, getGeomType, getLayerDefn, getName,</span></span>
<span><span class="co">#&gt;    getNextFeature, getSpatialRef, initialize, isOpen, layerClip, layerErase,</span></span>
<span><span class="co">#&gt;    layerIdentity, layerIntersection, layerSymDifference, layerUnion,</span></span>
<span><span class="co">#&gt;    layerUpdate, open, resetReading, setAttributeFilter, setSpatialFilterRect,</span></span>
<span><span class="co">#&gt;    testCapability</span></span>
<span></span>
<span><span class="co"># dataset info</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">getDriverShortName</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "GPKG"</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">getDriverLongName</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "GeoPackage"</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">getFileList</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/vsimem/ynp_fires_1984_2022.gpkg"</span></span>
<span></span>
<span><span class="co"># layer info</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">getName</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "mtbs_perims"</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">getGeomType</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "MULTIPOLYGON"</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">getGeometryColumn</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "geom"</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">getFIDColumn</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "fid"</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">getSpatialRef</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "PROJCS[\"NAD83 / Montana\",GEOGCS[\"NAD83\",DATUM[\"North_American_Datum_1983\",SPHEROID[\"GRS 1980\",6378137,298.257222101,AUTHORITY[\"EPSG\",\"7019\"]],AUTHORITY[\"EPSG\",\"6269\"]],PRIMEM[\"Greenwich\",0,AUTHORITY[\"EPSG\",\"8901\"]],UNIT[\"degree\",0.0174532925199433,AUTHORITY[\"EPSG\",\"9122\"]],AUTHORITY[\"EPSG\",\"4269\"]],PROJECTION[\"Lambert_Conformal_Conic_2SP\"],PARAMETER[\"latitude_of_origin\",44.25],PARAMETER[\"central_meridian\",-109.5],PARAMETER[\"standard_parallel_1\",49],PARAMETER[\"standard_parallel_2\",45],PARAMETER[\"false_easting\",600000],PARAMETER[\"false_northing\",0],UNIT[\"metre\",1,AUTHORITY[\"EPSG\",\"9001\"]],AXIS[\"Easting\",EAST],AXIS[\"Northing\",NORTH],AUTHORITY[\"EPSG\",\"32100\"]]"</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">bbox</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 469685.73 -12917.76 573531.72  96577.34</span></span>
<span></span>
<span><span class="co"># layer capabilities</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">testCapability</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $RandomRead</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $SequentialWrite</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $RandomWrite</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $UpsertFeature</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $FastSpatialFilter</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $FastFeatureCount</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $FastGetExtent</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $FastSetNextByIndex</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $CreateField</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $CreateGeomField</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $DeleteField</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ReorderFields</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $AlterFieldDefn</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $AlterGeomFieldDefn</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $DeleteFeature</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $StringsAsUTF8</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Transactions</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $CurveGeometries</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># re-open with write access</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">open</span><span class="op">(</span>read_only <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">testCapability</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">SequentialWrite</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">testCapability</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">RandomWrite</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># feature class definition - a list of fields and their definitions</span></span>
<span><span class="va">defn</span> <span class="op">&lt;-</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">getLayerDefn</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">defn</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "event_id"     "incid_name"   "incid_type"   "map_id"       "burn_bnd_ac" </span></span>
<span><span class="co">#&gt;  [6] "burn_bnd_lat" "burn_bnd_lon" "ig_date"      "ig_year"      "geom"</span></span>
<span></span>
<span><span class="co"># each list element holds a field definition list</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">defn</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 10</span></span>
<span><span class="co">#&gt;  $ event_id    :List of 9</span></span>
<span><span class="co">#&gt;   ..$ type       : chr "OFTString"</span></span>
<span><span class="co">#&gt;   ..$ subtype    : chr "OFSTNone"</span></span>
<span><span class="co">#&gt;   ..$ width      : int 254</span></span>
<span><span class="co">#&gt;   ..$ precision  : int 0</span></span>
<span><span class="co">#&gt;   ..$ is_nullable: logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ is_unique  : logi FALSE</span></span>
<span><span class="co">#&gt;   ..$ default    : chr ""</span></span>
<span><span class="co">#&gt;   ..$ is_geom    : logi FALSE</span></span>
<span><span class="co">#&gt;  $ incid_name  :List of 9</span></span>
<span><span class="co">#&gt;   ..$ type       : chr "OFTString"</span></span>
<span><span class="co">#&gt;   ..$ subtype    : chr "OFSTNone"</span></span>
<span><span class="co">#&gt;   ..$ width      : int 254</span></span>
<span><span class="co">#&gt;   ..$ precision  : int 0</span></span>
<span><span class="co">#&gt;   ..$ is_nullable: logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ is_unique  : logi FALSE</span></span>
<span><span class="co">#&gt;   ..$ default    : chr ""</span></span>
<span><span class="co">#&gt;   ..$ is_geom    : logi FALSE</span></span>
<span><span class="co">#&gt;  $ incid_type  :List of 9</span></span>
<span><span class="co">#&gt;   ..$ type       : chr "OFTString"</span></span>
<span><span class="co">#&gt;   ..$ subtype    : chr "OFSTNone"</span></span>
<span><span class="co">#&gt;   ..$ width      : int 254</span></span>
<span><span class="co">#&gt;   ..$ precision  : int 0</span></span>
<span><span class="co">#&gt;   ..$ is_nullable: logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ is_unique  : logi FALSE</span></span>
<span><span class="co">#&gt;   ..$ default    : chr ""</span></span>
<span><span class="co">#&gt;   ..$ is_geom    : logi FALSE</span></span>
<span><span class="co">#&gt;  $ map_id      :List of 9</span></span>
<span><span class="co">#&gt;   ..$ type       : chr "OFTInteger64"</span></span>
<span><span class="co">#&gt;   ..$ subtype    : chr "OFSTNone"</span></span>
<span><span class="co">#&gt;   ..$ width      : int 0</span></span>
<span><span class="co">#&gt;   ..$ precision  : int 0</span></span>
<span><span class="co">#&gt;   ..$ is_nullable: logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ is_unique  : logi FALSE</span></span>
<span><span class="co">#&gt;   ..$ default    : chr ""</span></span>
<span><span class="co">#&gt;   ..$ is_geom    : logi FALSE</span></span>
<span><span class="co">#&gt;  $ burn_bnd_ac :List of 9</span></span>
<span><span class="co">#&gt;   ..$ type       : chr "OFTInteger64"</span></span>
<span><span class="co">#&gt;   ..$ subtype    : chr "OFSTNone"</span></span>
<span><span class="co">#&gt;   ..$ width      : int 0</span></span>
<span><span class="co">#&gt;   ..$ precision  : int 0</span></span>
<span><span class="co">#&gt;   ..$ is_nullable: logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ is_unique  : logi FALSE</span></span>
<span><span class="co">#&gt;   ..$ default    : chr ""</span></span>
<span><span class="co">#&gt;   ..$ is_geom    : logi FALSE</span></span>
<span><span class="co">#&gt;  $ burn_bnd_lat:List of 9</span></span>
<span><span class="co">#&gt;   ..$ type       : chr "OFTString"</span></span>
<span><span class="co">#&gt;   ..$ subtype    : chr "OFSTNone"</span></span>
<span><span class="co">#&gt;   ..$ width      : int 10</span></span>
<span><span class="co">#&gt;   ..$ precision  : int 0</span></span>
<span><span class="co">#&gt;   ..$ is_nullable: logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ is_unique  : logi FALSE</span></span>
<span><span class="co">#&gt;   ..$ default    : chr ""</span></span>
<span><span class="co">#&gt;   ..$ is_geom    : logi FALSE</span></span>
<span><span class="co">#&gt;  $ burn_bnd_lon:List of 9</span></span>
<span><span class="co">#&gt;   ..$ type       : chr "OFTString"</span></span>
<span><span class="co">#&gt;   ..$ subtype    : chr "OFSTNone"</span></span>
<span><span class="co">#&gt;   ..$ width      : int 10</span></span>
<span><span class="co">#&gt;   ..$ precision  : int 0</span></span>
<span><span class="co">#&gt;   ..$ is_nullable: logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ is_unique  : logi FALSE</span></span>
<span><span class="co">#&gt;   ..$ default    : chr ""</span></span>
<span><span class="co">#&gt;   ..$ is_geom    : logi FALSE</span></span>
<span><span class="co">#&gt;  $ ig_date     :List of 9</span></span>
<span><span class="co">#&gt;   ..$ type       : chr "OFTDate"</span></span>
<span><span class="co">#&gt;   ..$ subtype    : chr "OFSTNone"</span></span>
<span><span class="co">#&gt;   ..$ width      : int 0</span></span>
<span><span class="co">#&gt;   ..$ precision  : int 0</span></span>
<span><span class="co">#&gt;   ..$ is_nullable: logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ is_unique  : logi FALSE</span></span>
<span><span class="co">#&gt;   ..$ default    : chr ""</span></span>
<span><span class="co">#&gt;   ..$ is_geom    : logi FALSE</span></span>
<span><span class="co">#&gt;  $ ig_year     :List of 9</span></span>
<span><span class="co">#&gt;   ..$ type       : chr "OFTInteger"</span></span>
<span><span class="co">#&gt;   ..$ subtype    : chr "OFSTNone"</span></span>
<span><span class="co">#&gt;   ..$ width      : int 0</span></span>
<span><span class="co">#&gt;   ..$ precision  : int 0</span></span>
<span><span class="co">#&gt;   ..$ is_nullable: logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ is_unique  : logi FALSE</span></span>
<span><span class="co">#&gt;   ..$ default    : chr ""</span></span>
<span><span class="co">#&gt;   ..$ is_geom    : logi FALSE</span></span>
<span><span class="co">#&gt;  $ geom        :List of 5</span></span>
<span><span class="co">#&gt;   ..$ type       : chr "MULTIPOLYGON"</span></span>
<span><span class="co">#&gt;   ..$ srs        : chr "PROJCS[\"NAD83 / Montana\",GEOGCS[\"NAD83\",DATUM[\"North_American_Datum_1983\",SPHEROID[\"GRS 1980\",6378137,2"| __truncated__</span></span>
<span><span class="co">#&gt;   ..$ is_nullable: logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ is_geom    : logi TRUE</span></span>
<span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 61</span></span>
<span></span>
<span><span class="co"># cursor</span></span>
<span><span class="va">feat</span> <span class="op">&lt;-</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">getNextFeature</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># a list of field names and their values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">feat</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 10</span></span>
<span><span class="co">#&gt;  $ FID         :integer64 1 </span></span>
<span><span class="co">#&gt;  $ event_id    : chr "WY4413411069519870807"</span></span>
<span><span class="co">#&gt;  $ incid_name  : chr "POLECAT"</span></span>
<span><span class="co">#&gt;  $ incid_type  : chr "Wildfire"</span></span>
<span><span class="co">#&gt;  $ map_id      :integer64 10015934 </span></span>
<span><span class="co">#&gt;  $ burn_bnd_ac :integer64 1093 </span></span>
<span><span class="co">#&gt;  $ burn_bnd_lat: chr "44.132"</span></span>
<span><span class="co">#&gt;  $ burn_bnd_lon: chr "-110.696"</span></span>
<span><span class="co">#&gt;  $ ig_date     : Date[1:1], format: "1987-08-07"</span></span>
<span><span class="co">#&gt;  $ ig_year     : int 1987</span></span>
<span></span>
<span><span class="co"># attribute filter</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">setAttributeFilter</span><span class="op">(</span><span class="st">"ig_year = 2020"</span><span class="op">)</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="co"># default value of read/write field 'returnGeomAs'</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="va">returnGeomAs</span></span>
<span><span class="co">#&gt; [1] "NONE"</span></span>
<span></span>
<span><span class="va">feat</span> <span class="op">&lt;-</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">getNextFeature</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">feat</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 10</span></span>
<span><span class="co">#&gt;  $ FID         :integer64 61 </span></span>
<span><span class="co">#&gt;  $ event_id    : chr "WY4438911082120200822"</span></span>
<span><span class="co">#&gt;  $ incid_name  : chr "LONE STAR"</span></span>
<span><span class="co">#&gt;  $ incid_type  : chr "Wildfire"</span></span>
<span><span class="co">#&gt;  $ map_id      :integer64 10020495 </span></span>
<span><span class="co">#&gt;  $ burn_bnd_ac :integer64 3348 </span></span>
<span><span class="co">#&gt;  $ burn_bnd_lat: chr "44.4"</span></span>
<span><span class="co">#&gt;  $ burn_bnd_lon: chr "-110.782"</span></span>
<span><span class="co">#&gt;  $ ig_date     : Date[1:1], format: "2020-08-22"</span></span>
<span><span class="co">#&gt;  $ ig_year     : int 2020</span></span>
<span></span>
<span><span class="co"># NULL if no more features are available</span></span>
<span><span class="va">feat</span> <span class="op">&lt;-</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">getNextFeature</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">feat</span><span class="op">)</span></span>
<span><span class="co">#&gt;  NULL</span></span>
<span></span>
<span><span class="co"># reset reading to the start and return geometry as WKT</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">resetReading</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="va">returnGeomAs</span> <span class="op">&lt;-</span> <span class="st">"WKT"</span></span>
<span><span class="va">feat</span> <span class="op">&lt;-</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">getNextFeature</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">feat</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 11</span></span>
<span><span class="co">#&gt;  $ FID         :integer64 61 </span></span>
<span><span class="co">#&gt;  $ event_id    : chr "WY4438911082120200822"</span></span>
<span><span class="co">#&gt;  $ incid_name  : chr "LONE STAR"</span></span>
<span><span class="co">#&gt;  $ incid_type  : chr "Wildfire"</span></span>
<span><span class="co">#&gt;  $ map_id      :integer64 10020495 </span></span>
<span><span class="co">#&gt;  $ burn_bnd_ac :integer64 3348 </span></span>
<span><span class="co">#&gt;  $ burn_bnd_lat: chr "44.4"</span></span>
<span><span class="co">#&gt;  $ burn_bnd_lon: chr "-110.782"</span></span>
<span><span class="co">#&gt;  $ ig_date     : Date[1:1], format: "2020-08-22"</span></span>
<span><span class="co">#&gt;  $ ig_year     : int 2020</span></span>
<span><span class="co">#&gt;  $ geom        : chr "MULTIPOLYGON (((496593.122306971 15506.8828590633,496491.761299067 15605.3612548792,496290.812130161 15388.0465"| __truncated__</span></span>
<span></span>
<span><span class="co"># clear attribute filter</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">setAttributeFilter</span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 61</span></span>
<span></span>
<span><span class="co"># spatial filter</span></span>
<span><span class="co"># get the bounding box of the largest 1988 fire and use as spatial filter</span></span>
<span><span class="co"># first set a temporary attribute filter to do the lookup</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">setAttributeFilter</span><span class="op">(</span><span class="st">"ig_year = 1988 ORDER BY burn_bnd_ac DESC"</span><span class="op">)</span></span>
<span><span class="va">feat</span> <span class="op">&lt;-</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">getNextFeature</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">feat</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 11</span></span>
<span><span class="co">#&gt;  $ FID         :integer64 7 </span></span>
<span><span class="co">#&gt;  $ event_id    : chr "WY4470811082119880722"</span></span>
<span><span class="co">#&gt;  $ incid_name  : chr "NORTH FORK"</span></span>
<span><span class="co">#&gt;  $ incid_type  : chr "Wildfire"</span></span>
<span><span class="co">#&gt;  $ map_id      :integer64 10014217 </span></span>
<span><span class="co">#&gt;  $ burn_bnd_ac :integer64 563527 </span></span>
<span><span class="co">#&gt;  $ burn_bnd_lat: chr "44.678"</span></span>
<span><span class="co">#&gt;  $ burn_bnd_lon: chr "-110.716"</span></span>
<span><span class="co">#&gt;  $ ig_date     : Date[1:1], format: "1988-07-22"</span></span>
<span><span class="co">#&gt;  $ ig_year     : int 1988</span></span>
<span><span class="co">#&gt;  $ geom        : chr "MULTIPOLYGON (((469685.969312071 29526.2354109807,469918.933844832 29654.3220754602,470030.299119989 29518.7441"| __truncated__</span></span>
<span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbox_from_wkt.html">bbox_from_wkt</a></span><span class="op">(</span><span class="va">feat</span><span class="op">$</span><span class="va">geom</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 469685.97  11442.45 544069.63  85508.15</span></span>
<span></span>
<span><span class="co"># set spatial filter on the full layer</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">setAttributeFilter</span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">setSpatialFilterRect</span><span class="op">(</span><span class="va">bbox</span><span class="op">)</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 40</span></span>
<span></span>
<span><span class="co"># fetch n features at a time and return as a data frame</span></span>
<span><span class="co"># analog of DBI::dbFetch() where the lyr object is a result set</span></span>
<span><span class="co"># geometry can optionally be returned as NONE, WKT or WKB</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">fetch</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    20 obs. of  11 variables:</span></span>
<span><span class="co">#&gt;  $ FID         :integer64 38 7 32 25 6 40 36 8 ... </span></span>
<span><span class="co">#&gt;  $ event_id    : chr  "MT4471311115120070627" "WY4470811082119880722" "MT4491211108020030820" "WY4433011103020000816" ...</span></span>
<span><span class="co">#&gt;  $ incid_name  : chr  "MADISON ARM" "NORTH FORK" "RATHBONE" "SPRUCE COMPLEX (PLATEAU)" ...</span></span>
<span><span class="co">#&gt;  $ incid_type  : chr  "Wildfire" "Wildfire" "Wildfire" "Wildfire" ...</span></span>
<span><span class="co">#&gt;  $ map_id      :integer64 16113 10014217 13014 10014141 10014215 16428 15432 10014218 ... </span></span>
<span><span class="co">#&gt;  $ burn_bnd_ac :integer64 3564 563527 2701 2808 20422 2175 3745 95233 ... </span></span>
<span><span class="co">#&gt;  $ burn_bnd_lat: chr  "44.713" "44.678" "44.912" "44.329" ...</span></span>
<span><span class="co">#&gt;  $ burn_bnd_lon: chr  "-111.151" "-110.716" "-111.080" "-111.027" ...</span></span>
<span><span class="co">#&gt;  $ ig_date     : Date, format: "2007-06-27" "1988-07-22" ...</span></span>
<span><span class="co">#&gt;  $ ig_year     : int  2007 1988 2003 2000 1988 2007 2006 1988 1988 1988 ...</span></span>
<span><span class="co">#&gt;  $ geom        : chr  "MULTIPOLYGON (((469685.969631834 54506.9481370259,470235.509134591 54383.4837249131,470939.42854159 53898.69574"| __truncated__ "MULTIPOLYGON (((469685.969312071 29526.2354109807,469918.933844832 29654.3220754602,470030.299119989 29518.7441"| __truncated__ "MULTIPOLYGON (((475136.766856355 74053.2153491452,475188.847231864 74366.3342955356,475341.959781024 74368.4856"| __truncated__ "MULTIPOLYGON (((477992.723214764 8483.08443989834,477312.456870818 7630.95433906866,477088.305832492 6955.09786"| __truncated__ ...</span></span>
<span></span>
<span><span class="co"># the next 20 features</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">fetch</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 20</span></span>
<span></span>
<span><span class="co"># no features remaining</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">fetch</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>  <span class="co"># 0-row data frame with columns typed</span></span>
<span><span class="co">#&gt; 'data.frame':    0 obs. of  11 variables:</span></span>
<span><span class="co">#&gt;  $ FID         :integer64  </span></span>
<span><span class="co">#&gt;  $ event_id    : chr </span></span>
<span><span class="co">#&gt;  $ incid_name  : chr </span></span>
<span><span class="co">#&gt;  $ incid_type  : chr </span></span>
<span><span class="co">#&gt;  $ map_id      :integer64  </span></span>
<span><span class="co">#&gt;  $ burn_bnd_ac :integer64  </span></span>
<span><span class="co">#&gt;  $ burn_bnd_lat: chr </span></span>
<span><span class="co">#&gt;  $ burn_bnd_lon: chr </span></span>
<span><span class="co">#&gt;  $ ig_date     : 'Date' num(0) </span></span>
<span><span class="co">#&gt;  $ ig_year     : int </span></span>
<span><span class="co">#&gt;  $ geom        : chr</span></span>
<span></span>
<span><span class="co"># fetch all available features by passing n = -1, resets to first feature</span></span>
<span><span class="co"># return geom as a list column of WKB raw vectors</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="va">returnGeomAs</span> <span class="op">&lt;-</span> <span class="st">"WKB"</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">fetch</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    40 obs. of  11 variables:</span></span>
<span><span class="co">#&gt;  $ FID         :integer64 38 7 32 25 6 40 36 8 ... </span></span>
<span><span class="co">#&gt;  $ event_id    : chr  "MT4471311115120070627" "WY4470811082119880722" "MT4491211108020030820" "WY4433011103020000816" ...</span></span>
<span><span class="co">#&gt;  $ incid_name  : chr  "MADISON ARM" "NORTH FORK" "RATHBONE" "SPRUCE COMPLEX (PLATEAU)" ...</span></span>
<span><span class="co">#&gt;  $ incid_type  : chr  "Wildfire" "Wildfire" "Wildfire" "Wildfire" ...</span></span>
<span><span class="co">#&gt;  $ map_id      :integer64 16113 10014217 13014 10014141 10014215 16428 15432 10014218 ... </span></span>
<span><span class="co">#&gt;  $ burn_bnd_ac :integer64 3564 563527 2701 2808 20422 2175 3745 95233 ... </span></span>
<span><span class="co">#&gt;  $ burn_bnd_lat: chr  "44.713" "44.678" "44.912" "44.329" ...</span></span>
<span><span class="co">#&gt;  $ burn_bnd_lon: chr  "-111.151" "-110.716" "-111.080" "-111.027" ...</span></span>
<span><span class="co">#&gt;  $ ig_date     : Date, format: "2007-06-27" "1988-07-22" ...</span></span>
<span><span class="co">#&gt;  $ ig_year     : int  2007 1988 2003 2000 1988 2007 2006 1988 1988 1988 ...</span></span>
<span><span class="co">#&gt;  $ geom        :List of 40</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span><span class="co">#&gt;   ..$ : raw  01 06 00 00 ...</span></span>
<span></span>
<span><span class="co"># parse WKB using the wk package</span></span>
<span><span class="va">wk_obj</span> <span class="op">&lt;-</span> <span class="fu">wk</span><span class="fu">::</span><span class="fu"><a href="https://paleolimbot.github.io/wk/reference/wkb.html" class="external-link">wkb</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">geom</span>, crs <span class="op">=</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">getSpatialRef</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">wk_obj</span><span class="op">)</span></span></code></pre></div>
<p><img src="img%2Fynp_mtbs_wkb_plot_ex.png"><!-- --></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">clearSpatialFilter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 61</span></span>
<span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/vsi_unlink.html">vsi_unlink</a></span><span class="op">(</span><span class="va">dsn</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p><sup>Created on 2024-07-21 with <a href="https://reprex.tidyverse.org" class="external-link">reprex v2.1.1</a></sup></p>
</div>
<div class="section level2">
<h2 id="example-layer-geoprocessing">Example: layer geoprocessing<a class="anchor" aria-label="anchor" href="#example-layer-geoprocessing"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## layer intersection example</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usdaforestservice.github.io/gdalraster/">gdalraster</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; GDAL 3.8.4, released 2024/02/08, GEOS 3.12.1, PROJ 9.3.1</span></span>
<span></span>
<span><span class="co"># MTBS fires in Yellowstone National Park 1984-2022</span></span>
<span><span class="va">dsn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/ynp_fires_1984_2022.gpkg"</span>, package<span class="op">=</span><span class="st">"gdalraster"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># layer filtered to fires since year 2000</span></span>
<span><span class="va">lyr1</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALVector</span>, <span class="va">dsn</span>, <span class="st">"mtbs_perims"</span><span class="op">)</span></span>
<span><span class="va">lyr1</span><span class="op">$</span><span class="fu">setAttributeFilter</span><span class="op">(</span><span class="st">"ig_year &gt;= 2000"</span><span class="op">)</span></span>
<span><span class="va">lyr1</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 40</span></span>
<span></span>
<span><span class="co"># second layer for the 1988 North Fork fire perimeter</span></span>
<span><span class="va">sql</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"SELECT incid_name, ig_year, geom "</span>,</span>
<span>              <span class="st">"FROM mtbs_perims "</span>,</span>
<span>              <span class="st">"WHERE incid_name = 'NORTH FORK'"</span><span class="op">)</span></span>
<span><span class="va">lyr2</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALVector</span>, <span class="va">dsn</span>, <span class="va">sql</span><span class="op">)</span></span>
<span><span class="va">lyr2</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="co"># intersect to obtain areas re-burned since 2000</span></span>
<span><span class="va">tmp_dsn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".gpkg"</span><span class="op">)</span></span>
<span><span class="va">opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"INPUT_PREFIX=layer1_"</span>,</span>
<span>         <span class="st">"METHOD_PREFIX=layer2_"</span>,</span>
<span>         <span class="st">"PROMOTE_TO_MULTI=YES"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lyr_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ogr_proc.html">ogr_proc</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"Intersection"</span>, </span>
<span>                    input_lyr <span class="op">=</span> <span class="va">lyr1</span>,</span>
<span>                    method_lyr <span class="op">=</span> <span class="va">lyr2</span>, </span>
<span>                    out_dsn <span class="op">=</span> <span class="va">tmp_dsn</span>,</span>
<span>                    out_lyr_name <span class="op">=</span> <span class="st">"north_fork_reburned"</span>,</span>
<span>                    out_geom_type <span class="op">=</span> <span class="st">"MULTIPOLYGON"</span>,</span>
<span>                    mode_opt <span class="op">=</span> <span class="va">opt</span><span class="op">)</span></span>
<span><span class="co">#&gt; 0...10...20...30...40...50...60...70...80...90...100 - done.</span></span>
<span></span>
<span><span class="co"># result layer has attributes of the input and the method layers</span></span>
<span><span class="va">lyr_out</span><span class="op">$</span><span class="va">returnGeomAs</span> <span class="op">&lt;-</span> <span class="st">"TYPE_NAME"</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">lyr_out</span><span class="op">$</span><span class="fu">fetch</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt;   FID       layer1_event_id layer1_incid_name layer1_incid_type layer1_map_id</span></span>
<span><span class="co">#&gt; 1   1 WY4484611038620100914          ANTELOPE          Wildfire      10013735</span></span>
<span><span class="co">#&gt; 2   2 WY4466711063920120810            CYGNET          Wildfire          1961</span></span>
<span><span class="co">#&gt; 3   3 WY4474311097820160809             MAPLE          Wildfire      10005020</span></span>
<span><span class="co">#&gt; 4   4 WY4492611093820160805              FAWN          Wildfire      10005117</span></span>
<span><span class="co">#&gt; 5   5 WY4457911058620160826           CENTRAL          Wildfire      10014143</span></span>
<span><span class="co">#&gt;   layer1_burn_bnd_ac layer1_burn_bnd_lat layer1_burn_bnd_lon layer1_ig_date</span></span>
<span><span class="co">#&gt; 1               4888              44.839            -110.368     2010-09-14</span></span>
<span><span class="co">#&gt; 2               3188              44.682            -110.622     2012-08-10</span></span>
<span><span class="co">#&gt; 3             103193              44.731            -110.982     2016-08-09</span></span>
<span><span class="co">#&gt; 4               3161              44.936            -110.913     2016-08-05</span></span>
<span><span class="co">#&gt; 5               2340              44.595            -110.574     2016-08-26</span></span>
<span><span class="co">#&gt;   layer1_ig_year layer2_incid_name layer2_ig_year         geom</span></span>
<span><span class="co">#&gt; 1           2010        NORTH FORK           1988 MULTIPOLYGON</span></span>
<span><span class="co">#&gt; 2           2012        NORTH FORK           1988 MULTIPOLYGON</span></span>
<span><span class="co">#&gt; 3           2016        NORTH FORK           1988 MULTIPOLYGON</span></span>
<span><span class="co">#&gt; 4           2016        NORTH FORK           1988 MULTIPOLYGON</span></span>
<span><span class="co">#&gt; 5           2016        NORTH FORK           1988 MULTIPOLYGON</span></span>
<span></span>
<span><span class="co"># clean up</span></span>
<span><span class="va">lyr1</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lyr2</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lyr_out</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/deleteDataset.html">deleteDataset</a></span><span class="op">(</span><span class="va">tmp_dsn</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p><sup>Created on 2024-07-30 with <a href="https://reprex.tidyverse.org" class="external-link">reprex v2.1.1</a></sup></p>
</div>
<div class="section level2">
<h2 id="example-worldcover-sentinel-2-composites">Example: WorldCover Sentinel-2 composites<a class="anchor" aria-label="anchor" href="#example-worldcover-sentinel-2-composites"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## WorldCover Sentinel-2 annual composites</span></span>
<span><span class="co">## see: https://blog.vito.be/remotesensing/worldcover-annual-composites</span></span>
<span><span class="co">## tile index lookup on remote filesystem and obtain raster data</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usdaforestservice.github.io/gdalraster/">gdalraster</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; GDAL 3.8.4, released 2024/02/08, GEOS 3.12.1, PROJ 9.3.1</span></span>
<span></span>
<span><span class="va">fgb</span> <span class="op">=</span> <span class="st">"/vsicurl/https://esa-worldcover.s3.eu-central-1.amazonaws.com/esa_worldcover_grid_composites.fgb"</span></span>
<span><span class="va">lyr_tiles</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALVector</span>, <span class="va">fgb</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lyr_tiles</span><span class="op">$</span><span class="fu">getDriverShortName</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "FlatGeobuf"</span></span>
<span><span class="va">lyr_tiles</span><span class="op">$</span><span class="fu">getName</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "worldcover_composites_grid_aws"</span></span>
<span><span class="va">lyr_tiles</span><span class="op">$</span><span class="fu">getGeomType</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "POLYGON"</span></span>
<span><span class="va">lyr_tiles</span><span class="op">$</span><span class="fu">getSpatialRef</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "GEOGCS[\"WGS 84\",DATUM[\"WGS_1984\",SPHEROID[\"WGS 84\",6378137,298.257223563,AUTHORITY[\"EPSG\",\"7030\"]],AUTHORITY[\"EPSG\",\"6326\"]],PRIMEM[\"Greenwich\",0,AUTHORITY[\"EPSG\",\"8901\"]],UNIT[\"degree\",0.0174532925199433,AUTHORITY[\"EPSG\",\"9122\"]],AXIS[\"Latitude\",NORTH],AXIS[\"Longitude\",EAST],AUTHORITY[\"EPSG\",\"4326\"]]"</span></span>
<span></span>
<span><span class="va">lyr_tiles</span><span class="op">$</span><span class="fu">testCapability</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">RandomRead</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">lyr_tiles</span><span class="op">$</span><span class="fu">testCapability</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">FastSpatialFilter</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">lyr_tiles</span><span class="op">$</span><span class="fu">testCapability</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">FastFeatureCount</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">lyr_tiles</span><span class="op">$</span><span class="fu">testCapability</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">FastGetExtent</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="va">lyr_tiles</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 19363</span></span>
<span><span class="va">lyr_tiles</span><span class="op">$</span><span class="fu">bbox</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -180  -60  180   83</span></span>
<span></span>
<span><span class="va">defn</span> <span class="op">&lt;-</span> <span class="va">lyr_tiles</span><span class="op">$</span><span class="fu">getLayerDefn</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">defn</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "tile"              "s1_vvvhratio_2020" "s1_vvvhratio_2021"</span></span>
<span><span class="co">#&gt;  [4] "s2_rgbnir_2020"    "s2_rgbnir_2021"    "s2_ndvi_2020"     </span></span>
<span><span class="co">#&gt;  [7] "s2_ndvi_2021"      "s2_swir_2020"      "s2_swir_2021"     </span></span>
<span><span class="co">#&gt; [10] "geometry"</span></span>
<span></span>
<span><span class="co"># AOI for the Fishhawk fire</span></span>
<span><span class="va">dsn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/ynp_fires_1984_2022.gpkg"</span>, package<span class="op">=</span><span class="st">"gdalraster"</span><span class="op">)</span></span>
<span><span class="va">lyr_ynp</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALVector</span>, <span class="va">dsn</span>, <span class="st">"mtbs_perims"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lyr_ynp</span><span class="op">$</span><span class="fu">setAttributeFilter</span><span class="op">(</span><span class="st">"incid_name = 'FISHHAWK'"</span><span class="op">)</span></span>
<span><span class="va">lyr_ynp</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="va">lyr_ynp</span><span class="op">$</span><span class="va">returnGeomAs</span> <span class="op">&lt;-</span> <span class="st">"WKT"</span></span>
<span><span class="va">feat</span> <span class="op">&lt;-</span> <span class="va">lyr_ynp</span><span class="op">$</span><span class="fu">getNextFeature</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">feat</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 11</span></span>
<span><span class="co">#&gt;  $ FID         :integer64 60 </span></span>
<span><span class="co">#&gt;  $ event_id    : chr "WY4437710988020190902"</span></span>
<span><span class="co">#&gt;  $ incid_name  : chr "FISHHAWK"</span></span>
<span><span class="co">#&gt;  $ incid_type  : chr "Wildfire"</span></span>
<span><span class="co">#&gt;  $ map_id      :integer64 10016957 </span></span>
<span><span class="co">#&gt;  $ burn_bnd_ac :integer64 10775 </span></span>
<span><span class="co">#&gt;  $ burn_bnd_lat: chr "44.384"</span></span>
<span><span class="co">#&gt;  $ burn_bnd_lon: chr "-109.85"</span></span>
<span><span class="co">#&gt;  $ ig_date     : Date[1:1], format: "2019-09-02"</span></span>
<span><span class="co">#&gt;  $ ig_year     : int 2019</span></span>
<span><span class="co">#&gt;  $ geom        : chr "MULTIPOLYGON (((573530.585472236 9160.22088906913,573266.183153384 9415.42216938034,573137.427110327 9285.44517"| __truncated__</span></span>
<span></span>
<span><span class="co"># get the feature bbox in WGS84</span></span>
<span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/g_transform.html">g_transform</a></span><span class="op">(</span><span class="va">feat</span><span class="op">$</span><span class="va">geom</span>, <span class="va">lyr_ynp</span><span class="op">$</span><span class="fu">getSpatialRef</span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="../reference/epsg_to_wkt.html">epsg_to_wkt</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/bbox_from_wkt.html">bbox_from_wkt</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">bb</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -109.89753   44.32714 -109.83172   44.44030</span></span>
<span></span>
<span><span class="co"># tile index lookup</span></span>
<span><span class="va">lyr_tiles</span><span class="op">$</span><span class="fu">setSpatialFilterRect</span><span class="op">(</span><span class="va">bb</span><span class="op">)</span></span>
<span><span class="va">lyr_tiles</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="va">feat</span> <span class="op">&lt;-</span> <span class="va">lyr_tiles</span><span class="op">$</span><span class="fu">getNextFeature</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">feat</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 10</span></span>
<span><span class="co">#&gt;  $ FID              :integer64 16615 </span></span>
<span><span class="co">#&gt;  $ tile             : chr "N44W110"</span></span>
<span><span class="co">#&gt;  $ s1_vvvhratio_2020: chr "s3://esa-worldcover-s1/vvvhratio/2020/N44/ESA_WorldCover_10m_2020_v100_N44W110_S1VVVHratio.tif"</span></span>
<span><span class="co">#&gt;  $ s1_vvvhratio_2021: chr "s3://esa-worldcover-s1/vvvhratio/2021/N44/ESA_WorldCover_10m_2021_v200_N44W110_S1VVVHratio.tif"</span></span>
<span><span class="co">#&gt;  $ s2_rgbnir_2020   : chr "s3://esa-worldcover-s2/rgbnir/2020/N44/ESA_WorldCover_10m_2020_v100_N44W110_S2RGBNIR.tif"</span></span>
<span><span class="co">#&gt;  $ s2_rgbnir_2021   : chr "s3://esa-worldcover-s2/rgbnir/2021/N44/ESA_WorldCover_10m_2021_v200_N44W110_S2RGBNIR.tif"</span></span>
<span><span class="co">#&gt;  $ s2_ndvi_2020     : chr "s3://esa-worldcover-s2/ndvi/2020/N44/ESA_WorldCover_10m_2020_v100_N44W110_NDVI.tif"</span></span>
<span><span class="co">#&gt;  $ s2_ndvi_2021     : chr "s3://esa-worldcover-s2/ndvi/2021/N44/ESA_WorldCover_10m_2021_v200_N44W110_NDVI.tif"</span></span>
<span><span class="co">#&gt;  $ s2_swir_2020     : chr "s3://esa-worldcover-s2/swir/2020/N44/ESA_WorldCover_10m_2020_v100_N44W110_SWIR.tif"</span></span>
<span><span class="co">#&gt;  $ s2_swir_2021     : chr "s3://esa-worldcover-s2/swir/2021/N44/ESA_WorldCover_10m_2021_v200_N44W110_SWIR.tif"</span></span>
<span></span>
<span><span class="co"># get the Sentinel-2 RGBNIR composite for this AOI</span></span>
<span><span class="va">tif_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"s3://"</span>, <span class="st">"/vsis3/"</span>, <span class="va">feat</span><span class="op">$</span><span class="va">s2_rgbnir_2021</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tif_file</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/vsis3/esa-worldcover-s2/rgbnir/2021/N44/ESA_WorldCover_10m_2021_v200_N44W110_S2RGBNIR.tif"</span></span>
<span></span>
<span><span class="co"># public bucket so disable request signing</span></span>
<span><span class="fu"><a href="../reference/set_config_option.html">set_config_option</a></span><span class="op">(</span><span class="st">"AWS_NO_SIGN_REQUEST"</span>, <span class="st">"YES"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check if file exists and get size in MB</span></span>
<span><span class="fu"><a href="../reference/vsi_stat.html">vsi_stat</a></span><span class="op">(</span><span class="va">tif_file</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/vsi_stat.html">vsi_stat</a></span><span class="op">(</span><span class="va">tif_file</span>, <span class="st">"size"</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1000</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 562.039</span></span>
<span></span>
<span><span class="co"># copy to a local or remote filesystem, e.g.,</span></span>
<span><span class="co"># tif_copy &lt;- file.path(tempdir(), basename(tif_file))</span></span>
<span><span class="co"># vsi_copy_file(tif_file, tif_copy, show_progress = TRUE)</span></span>
<span></span>
<span><span class="co"># or open the dataset for reading</span></span>
<span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALRaster</span>, <span class="va">tif_file</span><span class="op">)</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">dim</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 12000 12000     4</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">getMetadata</span><span class="op">(</span>band<span class="op">=</span><span class="fl">0</span>, domain<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "algorithm_version=V2.0.0"                                                                                                                                            </span></span>
<span><span class="co">#&gt;  [2] "AREA_OR_POINT=Area"                                                                                                                                                  </span></span>
<span><span class="co">#&gt;  [3] "bands=Band 1: B04 (Red), Band 2: B03 (Green), Band 3: B02 (Blue), Band 4: B08 (Infrared)"                                                                            </span></span>
<span><span class="co">#&gt;  [4] "copyright=ESA WorldCover project 2021 / Contains modified Copernicus Sentinel data (2021) processed by ESA WorldCover consortium"                                    </span></span>
<span><span class="co">#&gt;  [5] "creation_time=2022-12-09 17:08:25.881589"                                                                                                                            </span></span>
<span><span class="co">#&gt;  [6] "description=The ESA WorldCover Sentinel-2 median L2A (RGBNIR) composite is a color image made from images in Blue (B02), Green (B03), Red (B04) and Infrared (B08). "</span></span>
<span><span class="co">#&gt;  [7] "license=CC-BY 4.0 - https://creativecommons.org/licenses/by/4.0/"                                                                                                    </span></span>
<span><span class="co">#&gt;  [8] "product_crs=EPSG:4326"                                                                                                                                               </span></span>
<span><span class="co">#&gt;  [9] "product_grid=1x1 degree tiling grid"                                                                                                                                 </span></span>
<span><span class="co">#&gt; [10] "product_tile=N44W110"                                                                                                                                                </span></span>
<span><span class="co">#&gt; [11] "product_type=Sentinel-2 median L2A (RGBNIR) composite"                                                                                                               </span></span>
<span><span class="co">#&gt; [12] "product_version=V2.0.0"                                                                                                                                              </span></span>
<span><span class="co">#&gt; [13] "reference=https://esa-worldcover.org"                                                                                                                                </span></span>
<span><span class="co">#&gt; [14] "time_end=2021-12-31T23:59:59Z"                                                                                                                                       </span></span>
<span><span class="co">#&gt; [15] "time_start=2021-01-01T00:00:00Z"                                                                                                                                     </span></span>
<span><span class="co">#&gt; [16] "title=ESA WorldCover Sentinel-2 median L2A (RGBNIR) composite at 10m resolution for year 2021"</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">getMetadata</span><span class="op">(</span>band<span class="op">=</span><span class="fl">0</span>, domain<span class="op">=</span><span class="st">"IMAGE_STRUCTURE"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "COMPRESSION=DEFLATE" "INTERLEAVE=PIXEL"    "LAYOUT=COG"         </span></span>
<span><span class="co">#&gt; [4] "PREDICTOR=2"</span></span>
<span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ds.html">read_ds</a></span><span class="op">(</span><span class="va">ds</span>, bands<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, out_xsize <span class="op">=</span> <span class="fl">800</span>, out_ysize <span class="op">=</span> <span class="fl">800</span><span class="op">)</span></span>
<span><span class="va">txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html" class="external-link">file_path_sans_ext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">tif_file</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              <span class="st">"\n(color infrared B8-B4-B3)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_raster.html">plot_raster</a></span><span class="op">(</span><span class="va">r</span>,</span>
<span>            minmax_pct_cut <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">98</span><span class="op">)</span>,</span>
<span>            xlab <span class="op">=</span> <span class="st">"longitude"</span>,</span>
<span>            ylab <span class="op">=</span> <span class="st">"latitude"</span>,</span>
<span>            main <span class="op">=</span> <span class="va">txt</span><span class="op">)</span></span></code></pre></div>
<p><img src="img%2Fworldcov2021_N44W110_S2RGBNIR_ex.png"><!-- --></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lyr_ynp</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lyr_tiles</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><sup>Created on 2024-07-21 with <a href="https://reprex.tidyverse.org" class="external-link">reprex v2.1.1</a></sup></p>
</div>
<div class="section level2">
<h2 id="further-consideration-tbd">Further consideration / TBD<a class="anchor" aria-label="anchor" href="#further-consideration-tbd"></a>
</h2>
<p>This is a working list of potential issues and design questions that
need further consideration, to be determined:</p>
<ul>
<li>OGR’s Arrow C interface: Implement
<code>GDALVector::getArrowStream()</code> (GDAL &gt;= 3.6) and
<code>GDALVector::writeArrowBatch()</code> (GDAL &gt;= 3.8), supported
on the R side with package <strong>nanoarrow</strong>.</li>
<li>OGR layer geoprocessing expected to be moved to stand-alone
functions instead of class methods in <code>GDALVector</code>, to be
implemented in an <code><a href="../reference/ogr_proc.html">ogr_proc()</a></code> interface.</li>
</ul>
</div>
<div class="section level2">
<h2 id="document-changelog">Document changelog<a class="anchor" aria-label="anchor" href="#document-changelog"></a>
</h2>
<ul>
<li>add <code>GDALVector::setSpatialFilter()</code> to the draft class
definition - set spatial filter from WKT geometry (2024-03-02)</li>
<li>add comment in the layer intersection example re: feature retrieval
by FID (2024-03-02)</li>
<li>add arguments <code>fields</code> and <code>geom_column</code> in
<code>GDALVector::getFeatureSet()</code> - optionally retrieve a subset
of attribute fields, and specify whether to include geometry column(s)
in the returned data frame (2024-03-02)</li>
<li>the return value of feature writing methods should be the FID of the
newly created/set/deleted feature upon successful write, or
<code>OGRNullFID</code> on failure (2024-03-02)</li>
<li>add a note above <code>class GDALVector</code> re: handling of
64-bit integer types to be determined (2024-03-02)</li>
<li>add <code>GDALVector::setIgnoredFields()</code>: set which fields
can be omitted when retrieving features from the layer. If the driver
supports this functionality (testable using OLCIgnoreFields capability),
it will not fetch the specified fields in subsequent calls to
<code>getFeature()</code> / <code>getNextFeature()</code> thus save some
processing time and/or bandwidth. (2024-03-02)</li>
<li>add <code><a href="../reference/ogr_manage.html">ogr_execute_sql()</a></code> for dataset/schema management
(2024-03-02)</li>
<li>add <code>GDALVector::setNextByIndex()</code> for cursor positioning
(2024-03-03)</li>
<li>add <code>GDALVector::getSpatialFilter()</code>: get the WKT
geometry currently in use as the spatial filter, or <code>""</code>
(2024-03-03)</li>
<li>add section “Further consideration / TBD” (2024-03-03)</li>
<li>
<code><a href="../reference/ogr2ogr.html">ogr2ogr()</a></code> and <code><a href="../reference/ogrinfo.html">ogrinfo()</a></code> are available in
1.9.0.9080 dev (2024-03-04)</li>
<li>add potential output vectors of geos or ogr pointers, or wkb/wkt
with support by {wk} (<span class="citation">@mdsumner</span>,
2024-03-04)</li>
<li>add section “Contributors” (2024-03-04)</li>
<li>add link to issue 241 for discussion thread (2024-03-05)</li>
<li>OGR layer geoprocessing may be stand-alone functions instead of
class methods TBD (2024-03-10)</li>
<li>add link to the header file to reference the class methods that have
been implemented so far in the prototype (2024-03-10)</li>
<li>
<code><a href="../reference/ogr2ogr.html">ogr2ogr()</a></code> and <code><a href="../reference/ogrinfo.html">ogrinfo()</a></code> are available in
<strong>gdalraster</strong> 1.10.0 on CRAN (2024-03-26)</li>
<li>initial int64 support; now linking to <strong>RcppInt64</strong>,
and importing <strong>bit64</strong>; <code>FID</code> and
<code>OFTInteger64</code> fields are now returned in R as
<code>integer64</code>; updated the examples (2024-04-06)</li>
<li>add <code>GDALVector::getFeature()</code>: fetch a feature from its
FID (2024-04-06)</li>
<li>add a <code>GDALVector</code> class constructor with
<code>spatial_filter</code> and SQL <code>dialect</code> arguments
(2024-04-28)</li>
<li>
<a href="https://usdaforestservice.github.io/gdalraster/reference/ogr_manage.html">ogr_manage</a>
and <a href="https://usdaforestservice.github.io/gdalraster/reference/ogr_define.html">ogr_define</a>
added in <strong>gdalraster</strong> dev; examples updated
(2024-05-14)</li>
<li>update the draft class definition: Add read/write fields for
per-object settings (<code>defaultGeomFldName</code>,
<code>returnGeomAs</code> and <code>wkbByteOrder</code>). Rename method
<code>getFeatureSet()</code> to <code>fetch()</code>, analog of
<code>DBI::dbFetch()</code>, fetch the next n features from the layer
and return them as a data frame. (2024-07-11)</li>
<li>update usage example for recent changes in gdalvector branch:
<code>defaultGeomFldName</code>,
<code>returnGeomAs = NONE|WKT|WKT_ISO|WKB|WKB_ISO</code>,
<code>GDALVector::fetch()</code>, all OGR attribute field types now
supported (2024-07-12)</li>
<li>add sub-headings under the heading “Description of the interface”,
and add specifications under “Feature retrieval” and “Geometry”
(2024-07-13)</li>
<li>
<code>GDALVector::testCapability()</code> returns a list of named
capabilities with <code>TRUE</code>|<code>FALSE</code>, class method
version of <code><a href="../reference/ogr_manage.html">ogr_layer_test_cap()</a></code> (2024-07-21)</li>
<li>branch gdalvector was merged into main (2024-07-23)</li>
<li>added <code><a href="../reference/ogr_proc.html">ogr_proc()</a></code>, interface to GDAL OGR facilities for
vector geoprocessing; updated “Example: layer geoprocessing”
(2024-07-30)</li>
<li>removed <code>is_ignored</code> from feature class defintion, not
needed for feature class / field creation (2024-09-11)</li>
<li>feature write methods were implemented in <a href="https://github.com/USDAForestService/gdalraster/pull/504" class="external-link">#504</a>:
<code>$createFeature()</code>, <code>$setFeature()</code>,
<code>$upsertFeature()</code>; documentation and examples in the (online
reference)[<a href="https://usdaforestservice.github.io/gdalraster/reference/GDALVector-class.html" class="uri">https://usdaforestservice.github.io/gdalraster/reference/GDALVector-class.html</a>]
(2024-09-11)</li>
<li>updated the <code>GDALVector</code> class declaration in the draft
document (2024-09-11)</li>
<li>remove the read-only field <code>GDALVector::featureTemplate</code>
as not needed / not useful (2024-09-14)</li>
</ul>
</div>
<div class="section level2">
<h2 id="contributors">Contributors<a class="anchor" aria-label="anchor" href="#contributors"></a>
</h2>
<ul>
<li>
<a href="https://github.com/goergen95" class="external-link"><span class="citation">@goergen95</span></a> (<a href="https://github.com/USDAForestService/gdalraster/issues/205" class="external-link">#205</a>)</li>
<li><a href="https://github.com/mdsumner" class="external-link"><span class="citation">@mdsumner</span></a></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/ctoney" class="external-link">Chris Toney</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
